const rs="modulepreload",ls=function(e){return"/extensions/ComfyUI-Mape-Helpers/tweak/"+e},Ci={},_t=function(t,n,i){let o=Promise.resolve();if(n&&n.length>0){const s=document.getElementsByTagName("link");o=Promise.all(n.map(r=>{if(r=ls(r),r in Ci)return;Ci[r]=!0;const l=r.endsWith(".css"),a=l?'[rel="stylesheet"]':"";if(!!i)for(let f=s.length-1;f>=0;f--){const h=s[f];if(h.href===r&&(!l||h.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${r}"]${a}`))return;const c=document.createElement("link");if(c.rel=l?"stylesheet":rs,l||(c.as="script",c.crossOrigin=""),c.href=r,document.head.appendChild(c),l)return new Promise((f,h)=>{c.addEventListener("load",f),c.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${r}`)))})}))}return o.then(()=>t()).catch(s=>{const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=s,window.dispatchEvent(r),!r.defaultPrevented)throw s})},as=(e,t)=>e===t,rt=Symbol("solid-proxy"),ei=Symbol("solid-track"),pn={equals:as};let lo=fo;const qe=1,hn=2,ao={owned:null,cleanups:null,context:null,owner:null};var ue=null;let Mn=null,cs=null,ve=null,xe=null,De=null,En=0;function rn(e,t){const n=ve,i=ue,o=e.length===0,s=t===void 0?i:t,r=o?ao:{owned:null,cleanups:null,context:s?s.context:null,owner:s},l=o?e:()=>e(()=>Ue(()=>Cn(r)));ue=r,ve=null;try{return At(l,!0)}finally{ve=n,ue=i}}function se(e,t){t=t?Object.assign({},pn,t):pn;const n={value:e,observers:null,observerSlots:null,comparator:t.equals||void 0},i=o=>(typeof o=="function"&&(o=o(n.value)),uo(n,o));return[co.bind(n),i]}function W(e,t,n){const i=$i(e,t,!1,qe);Yt(i)}function Ce(e,t,n){lo=gs;const i=$i(e,t,!1,qe),o=Pi&&fs(Pi);o&&(i.suspense=o),(!n||!n.render)&&(i.user=!0),De?De.push(i):Yt(i)}function ce(e,t,n){n=n?Object.assign({},pn,n):pn;const i=$i(e,t,!0,0);return i.observers=null,i.observerSlots=null,i.comparator=n.equals||void 0,Yt(i),co.bind(i)}function us(e){return At(e,!1)}function Ue(e){if(ve===null)return e();const t=ve;ve=null;try{return e()}finally{ve=t}}function Ke(e){Ce(()=>Ue(e))}function Bt(e){return ue===null||(ue.cleanups===null?ue.cleanups=[e]:ue.cleanups.push(e)),e}function ti(){return ve}function ds(){return ue}function fs(e){return ue&&ue.context&&ue.context[e.id]!==void 0?ue.context[e.id]:e.defaultValue}function ps(e){const t=ce(e),n=ce(()=>ni(t()));return n.toArray=()=>{const i=n();return Array.isArray(i)?i:i!=null?[i]:[]},n}let Pi;function co(){if(this.sources&&this.state)if(this.state===qe)Yt(this);else{const e=xe;xe=null,At(()=>gn(this),!1),xe=e}if(ve){const e=this.observers?this.observers.length:0;ve.sources?(ve.sources.push(this),ve.sourceSlots.push(e)):(ve.sources=[this],ve.sourceSlots=[e]),this.observers?(this.observers.push(ve),this.observerSlots.push(ve.sources.length-1)):(this.observers=[ve],this.observerSlots=[ve.sources.length-1])}return this.value}function uo(e,t,n){let i=e.value;return(!e.comparator||!e.comparator(i,t))&&(e.value=t,e.observers&&e.observers.length&&At(()=>{for(let o=0;o<e.observers.length;o+=1){const s=e.observers[o],r=Mn&&Mn.running;r&&Mn.disposed.has(s),(r?!s.tState:!s.state)&&(s.pure?xe.push(s):De.push(s),s.observers&&po(s)),r||(s.state=qe)}if(xe.length>1e6)throw xe=[],new Error},!1)),t}function Yt(e){if(!e.fn)return;Cn(e);const t=En;hs(e,e.value,t)}function hs(e,t,n){let i;const o=ue,s=ve;ve=ue=e;try{i=e.fn(t)}catch(r){return e.pure&&(e.state=qe,e.owned&&e.owned.forEach(Cn),e.owned=null),e.updatedAt=n+1,ho(r)}finally{ve=s,ue=o}(!e.updatedAt||e.updatedAt<=n)&&(e.updatedAt!=null&&"observers"in e?uo(e,i):e.value=i,e.updatedAt=n)}function $i(e,t,n,i=qe,o){const s={fn:e,state:i,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:ue,context:ue?ue.context:null,pure:n};return ue===null||ue!==ao&&(ue.owned?ue.owned.push(s):ue.owned=[s]),s}function mn(e){if(e.state===0)return;if(e.state===hn)return gn(e);if(e.suspense&&Ue(e.suspense.inFallback))return e.suspense.effects.push(e);const t=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<En);)e.state&&t.push(e);for(let n=t.length-1;n>=0;n--)if(e=t[n],e.state===qe)Yt(e);else if(e.state===hn){const i=xe;xe=null,At(()=>gn(e,t[0]),!1),xe=i}}function At(e,t){if(xe)return e();let n=!1;t||(xe=[]),De?n=!0:De=[],En++;try{const i=e();return ms(n),i}catch(i){n||(De=null),xe=null,ho(i)}}function ms(e){if(xe&&(fo(xe),xe=null),e)return;const t=De;De=null,t.length&&At(()=>lo(t),!1)}function fo(e){for(let t=0;t<e.length;t++)mn(e[t])}function gs(e){let t,n=0;for(t=0;t<e.length;t++){const i=e[t];i.user?e[n++]=i:mn(i)}for(t=0;t<n;t++)mn(e[t])}function gn(e,t){e.state=0;for(let n=0;n<e.sources.length;n+=1){const i=e.sources[n];if(i.sources){const o=i.state;o===qe?i!==t&&(!i.updatedAt||i.updatedAt<En)&&mn(i):o===hn&&gn(i,t)}}}function po(e){for(let t=0;t<e.observers.length;t+=1){const n=e.observers[t];n.state||(n.state=hn,n.pure?xe.push(n):De.push(n),n.observers&&po(n))}}function Cn(e){let t;if(e.sources)for(;e.sources.length;){const n=e.sources.pop(),i=e.sourceSlots.pop(),o=n.observers;if(o&&o.length){const s=o.pop(),r=n.observerSlots.pop();i<o.length&&(s.sourceSlots[r]=i,o[i]=s,n.observerSlots[i]=r)}}if(e.owned){for(t=e.owned.length-1;t>=0;t--)Cn(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}e.state=0}function vs(e){return e instanceof Error?e:new Error(typeof e=="string"?e:"Unknown error",{cause:e})}function ho(e,t=ue){throw vs(e)}function ni(e){if(typeof e=="function"&&!e.length)return ni(e());if(Array.isArray(e)){const t=[];for(let n=0;n<e.length;n++){const i=ni(e[n]);Array.isArray(i)?t.push.apply(t,i):t.push(i)}return t}return e}const ys=Symbol("fallback");function Oi(e){for(let t=0;t<e.length;t++)e[t]()}function _s(e,t,n={}){let i=[],o=[],s=[],r=0,l=t.length>1?[]:null;return Bt(()=>Oi(s)),()=>{let a=e()||[],u,c;return a[ei],Ue(()=>{let h=a.length,d,p,m,_,w,$,y,k,S;if(h===0)r!==0&&(Oi(s),s=[],i=[],o=[],r=0,l&&(l=[])),n.fallback&&(i=[ys],o[0]=rn(j=>(s[0]=j,n.fallback())),r=1);else if(r===0){for(o=new Array(h),c=0;c<h;c++)i[c]=a[c],o[c]=rn(f);r=h}else{for(m=new Array(h),_=new Array(h),l&&(w=new Array(h)),$=0,y=Math.min(r,h);$<y&&i[$]===a[$];$++);for(y=r-1,k=h-1;y>=$&&k>=$&&i[y]===a[k];y--,k--)m[k]=o[y],_[k]=s[y],l&&(w[k]=l[y]);for(d=new Map,p=new Array(k+1),c=k;c>=$;c--)S=a[c],u=d.get(S),p[c]=u===void 0?-1:u,d.set(S,c);for(u=$;u<=y;u++)S=i[u],c=d.get(S),c!==void 0&&c!==-1?(m[c]=o[u],_[c]=s[u],l&&(w[c]=l[u]),c=p[c],d.set(S,c)):s[u]();for(c=$;c<h;c++)c in m?(o[c]=m[c],s[c]=_[c],l&&(l[c]=w[c],l[c](c))):o[c]=rn(f);o=o.slice(0,r=h),i=a.slice(0)}return o});function f(h){if(s[c]=h,l){const[d,p]=se(c);return l[c]=p,t(a[c],d)}return t(a[c])}}}let $s=!1;function $e(e,t){return Ue(()=>e(t||{}))}const ws=e=>`Stale read from <${e}>.`;function mo(e){const t="fallback"in e&&{fallback:()=>e.fallback};return ce(_s(()=>e.each,e.children,t||void 0))}function go(e){let t=!1;const n=(s,r)=>(t?s[1]===r[1]:!s[1]==!r[1])&&s[2]===r[2],i=ps(()=>e.children),o=ce(()=>{let s=i();Array.isArray(s)||(s=[s]);for(let r=0;r<s.length;r++){const l=s[r].when;if(l)return t=!!s[r].keyed,[r,l,s[r]]}return[-1]},void 0,{equals:n});return ce(()=>{const[s,r,l]=o();if(s<0)return e.fallback;const a=l.children;return typeof a=="function"&&a.length>0?Ue(()=>a(t?r:()=>{if(Ue(o)[0]!==s)throw ws("Match");return l.when})):a},void 0,void 0)}function it(e){return e}function bs(e,t,n){let i=n.length,o=t.length,s=i,r=0,l=0,a=t[o-1].nextSibling,u=null;for(;r<o||l<s;){if(t[r]===n[l]){r++,l++;continue}for(;t[o-1]===n[s-1];)o--,s--;if(o===r){const c=s<i?l?n[l-1].nextSibling:n[s-l]:a;for(;l<s;)e.insertBefore(n[l++],c)}else if(s===l)for(;r<o;)(!u||!u.has(t[r]))&&t[r].remove(),r++;else if(t[r]===n[s-1]&&n[l]===t[o-1]){const c=t[--o].nextSibling;e.insertBefore(n[l++],t[r++].nextSibling),e.insertBefore(n[--s],c),t[o]=n[s]}else{if(!u){u=new Map;let f=l;for(;f<s;)u.set(n[f],f++)}const c=u.get(t[r]);if(c!=null)if(l<c&&c<s){let f=r,h=1,d;for(;++f<o&&f<s&&!((d=u.get(t[f]))==null||d!==c+h);)h++;if(h>c-l){const p=t[r];for(;l<c;)e.insertBefore(n[l++],p)}else e.replaceChild(n[l++],t[r++])}else r++;else t[r++].remove()}}}const ji="_$DX_DELEGATE";function vo(e,t,n,i={}){let o;return rn(s=>{o=s,t===document?e():z(t,e(),t.firstChild?null:void 0,n)},i.owner),()=>{o(),t.textContent=""}}function C(e,t,n){let i;const o=()=>{const r=document.createElement("template");return r.innerHTML=e,n?r.content.firstChild.firstChild:r.content.firstChild},s=t?()=>Ue(()=>document.importNode(i||(i=o()),!0)):()=>(i||(i=o())).cloneNode(!0);return s.cloneNode=s,s}function ut(e,t=window.document){const n=t[ji]||(t[ji]=new Set);for(let i=0,o=e.length;i<o;i++){const s=e[i];n.has(s)||(n.add(s),t.addEventListener(s,xs))}}function de(e,t,n){n==null?e.removeAttribute(t):e.setAttribute(t,n)}function ks(e,t){t==null?e.removeAttribute("class"):e.className=t}function wi(e,t,n,i){if(i)Array.isArray(n)?(e[`$$${t}`]=n[0],e[`$$${t}Data`]=n[1]):e[`$$${t}`]=n;else if(Array.isArray(n)){const o=n[0];e.addEventListener(t,n[0]=s=>o.call(e,n[1],s))}else e.addEventListener(t,n)}function Ii(e,t,n){if(!t)return n?de(e,"style"):t;const i=e.style;if(typeof t=="string")return i.cssText=t;typeof n=="string"&&(i.cssText=n=void 0),n||(n={}),t||(t={});let o,s;for(s in n)t[s]==null&&i.removeProperty(s),delete n[s];for(s in t)o=t[s],o!==n[s]&&(i.setProperty(s,o),n[s]=o);return n}function $t(e,t,n){return Ue(()=>e(t,n))}function z(e,t,n,i){if(n!==void 0&&!i&&(i=[]),typeof t!="function")return vn(e,t,i,n);W(o=>vn(e,t(),o,n),i)}function xs(e){const t=`$$${e.type}`;let n=e.composedPath&&e.composedPath()[0]||e.target;for(e.target!==n&&Object.defineProperty(e,"target",{configurable:!0,value:n}),Object.defineProperty(e,"currentTarget",{configurable:!0,get(){return n||document}});n;){const i=n[t];if(i&&!n.disabled){const o=n[`${t}Data`];if(o!==void 0?i.call(n,o,e):i.call(n,e),e.cancelBubble)return}n=n._$host||n.parentNode||n.host}}function vn(e,t,n,i,o){for(;typeof n=="function";)n=n();if(t===n)return n;const s=typeof t,r=i!==void 0;if(e=r&&n[0]&&n[0].parentNode||e,s==="string"||s==="number")if(s==="number"&&(t=t.toString()),r){let l=n[0];l&&l.nodeType===3?l.data!==t&&(l.data=t):l=document.createTextNode(t),n=ht(e,n,i,l)}else n!==""&&typeof n=="string"?n=e.firstChild.data=t:n=e.textContent=t;else if(t==null||s==="boolean")n=ht(e,n,i);else{if(s==="function")return W(()=>{let l=t();for(;typeof l=="function";)l=l();n=vn(e,l,n,i)}),()=>n;if(Array.isArray(t)){const l=[],a=n&&Array.isArray(n);if(ii(l,t,n,o))return W(()=>n=vn(e,l,n,i,!0)),()=>n;if(l.length===0){if(n=ht(e,n,i),r)return n}else a?n.length===0?Ni(e,l,i):bs(e,n,l):(n&&ht(e),Ni(e,l));n=l}else if(t.nodeType){if(Array.isArray(n)){if(r)return n=ht(e,n,i,t);ht(e,n,null,t)}else n==null||n===""||!e.firstChild?e.appendChild(t):e.replaceChild(t,e.firstChild);n=t}}return n}function ii(e,t,n,i){let o=!1;for(let s=0,r=t.length;s<r;s++){let l=t[s],a=n&&n[s],u;if(!(l==null||l===!0||l===!1))if((u=typeof l)=="object"&&l.nodeType)e.push(l);else if(Array.isArray(l))o=ii(e,l,a)||o;else if(u==="function")if(i){for(;typeof l=="function";)l=l();o=ii(e,Array.isArray(l)?l:[l],Array.isArray(a)?a:[a])||o}else e.push(l),o=!0;else{const c=String(l);a&&a.nodeType===3&&a.data===c?e.push(a):e.push(document.createTextNode(c))}}return o}function Ni(e,t,n=null){for(let i=0,o=t.length;i<o;i++)e.insertBefore(t[i],n)}function ht(e,t,n,i){if(n===void 0)return e.textContent="";const o=i||document.createTextNode("");if(t.length){let s=!1;for(let r=t.length-1;r>=0;r--){const l=t[r];if(o!==l){const a=l.parentNode===e;!s&&!r?a?e.replaceChild(o,l):e.insertBefore(o,n):a&&l.remove()}else s=!0}}else e.insertBefore(o,n);return[o]}const Ss=async()=>{const{ImagePreviews:e}=await _t(()=>Promise.resolve().then(()=>Bs),void 0),t=document.createElement("div");document.body.appendChild(t),vo(()=>$e(e,{}),t)},As=async()=>{const{registerPlugin:e}=await _t(()=>Promise.resolve().then(()=>Cr),void 0);e(),async function t(){if(typeof app>"u"){setTimeout(t);return}const{MapeTweak:n}=await _t(()=>Promise.resolve().then(()=>Ea),void 0),i=document.createElement("div");document.body.appendChild(i),vo(()=>$e(n,{}),i)}()};window.standaloneImagePreview?Ss():As();function ae(e){let t=e.type;return e.IS_MAPE_VARIABLE?!0:(t===void 0&&(t=e.comfyClass),t?t.startsWith(Be):!1)}const st=e=>{var t,n,i;return!!(ae(e)&&((i=(n=(t=e.outputs)==null?void 0:t[0])==null?void 0:n.links)!=null&&i.length))},Se=e=>{var t,n;return!!(ae(e)&&((n=(t=e.inputs)==null?void 0:t[0])!=null&&n.link))},on="mape_tweak_",Es="mape_imagepreview_",Ve="mape_tweak_pos_",Be="mape Variable",Cs="*",Oe=()=>graph._nodes,re=(e,t)=>t?t.find(n=>n.id===e):graph.getNodeById(e),Jt=(e=Oe())=>e.filter(ae),yo=(e=Oe())=>Jt(e).filter(Se),_o=()=>graph._groups,Ps=()=>{var e;return(e=tt())==null?void 0:e[0]},tt=()=>Object.values(graph.list_of_graphcanvas[0].selected_nodes),We=e=>e?`/view?filename=${e.filename}&subfolder=${e.subfolder}&type=${e.type}&rand=42`:void 0,oi=(e,t,n,i)=>{const o=n-e,s=i-t;return Math.sqrt(o**2+s**2)},$o=e=>{const t=Object.fromEntries(Object.values(e).map(s=>[s.name,s.pos??[0,0]])),n=Math.min(...Object.values(t).map(([s,r])=>s)),i=Math.min(...Object.values(t).map(([s,r])=>r)),o=Object.fromEntries(Object.entries(t).map(([s,[r,l]])=>[s,oi(n,i,r,l)]));return(s,r)=>o[s.name]-o[r.name]},Os=(e,t,n=.35)=>{let i=1,o=1,s=1,r=1,l=1,a=1,u=1;const c=e[0],f=e[1],h=f/c;for(let d=1;d<=t;d++){const p=d,m=Math.ceil(t/p);m/p*n>h?(u=Math.floor(f/m),a=Math.floor(u/n)):(a=Math.floor(c/p),u=Math.floor(a*n));const _=a*u*t;(i===void 0||_>i)&&(i=_,r=u,l=a,o=p,s=m)}return{targetCols:o,targetRows:s,targetHeight:r,targetWidth:l}};var js=C("<div class=imagePreviews>"),Is=C("<div class=imagePreviewTweaks><label>Image Previews</label><label>Display type"),Ti=C("<img class=fullImage>"),Ns=C("<div class=mosaicGrid><div class=inner>"),Ts=C('<div class=flipbookFps><label for="">FPS</label><input type=number step=1 min=1 max=120><label for=flipflop title="Reverse at end of clip instead of restarting">Flip Flop</label><input id=flipflop type=checkbox>'),Ls=C("<div class=content><div class=bigPreview><div class=zoom>x"),Li=C("<div class=button>"),Ms=C("<div class=thumbnails>"),Hs=C("<div class=thumb><img class=smallImage>"),Rs=C("<div class=mosaicImage><img class=smallImage>"),zs=C("<div class=imagePreviewHelp><p>Shift + Click a link and enable tweak to have it show up in the images preview window.</p><video src=https://comfyui.ma.pe/help/imagePreview.mp4>");const Lt="mape_image_previews",Hn=`${Es}FPS`,Ds=()=>{const[e,t]=se(1),[n,i]=se([0,0]),[o,s]=se(0),[r,l]=se("images"),[a,u]=se({}),[c,f]=se(localStorage.mapeImageDisplayType??"single");let h;Ce(()=>{r(),p(0)});const[d,p]=se(0),[m,_]=se(localStorage[Hn]?JSON.parse(localStorage[Hn]):{}),[w,$]=se(!!localStorage.mape_tweak_flipflop);Ce(()=>{localStorage[Hn]=JSON.stringify(m())}),Ce(()=>{w()?localStorage.mape_tweak_flipflop=!0:delete localStorage.mape_tweak_flipflop});let y=1;const k=()=>{if(clearTimeout(h),c()==="flipbook"){if(h=setTimeout(k,1e3/(m()[r()]??12)),!j()||!j().value){p(0);return}const R=j().value.length;if(R===1){p(0);return}if(w()){const ne=d()+y;(ne<0||ne>=R)&&(y=-y);const ee=d()+y;p(ee)}else{let ne=d()+1;ne>=R&&(ne=0),p(ne)}}};Bt(()=>{clearTimeout(h)}),Ce(()=>{localStorage.mapeImageDisplayType=c(),p(0),y=1,c()==="flipbook"&&(p(0),setTimeout(k))}),localStorage[Lt]&&u(JSON.parse(localStorage[Lt]));function S(R){const{key:ne,newValue:ee}=R;ne===Lt&&ee&&(u(JSON.parse(ee)),j()||l(Object.keys(a())[0]??""),j()&&j().value&&j().value.length<=o()&&s(0))}window.addEventListener("storage",S);const j=()=>a()[r()],L=()=>`scale(${G()}) translate(calc(-50% + ${n()[0]}px), calc(-50% + ${n()[1]}px))`;let D;const[B,X]=se([100,100]);Ce(()=>{c(),D&&X([D.clientWidth,D.clientHeight])}),window.addEventListener("resize",()=>{D&&X([D.clientWidth,D.clientHeight])});const[v,N]=se(1),[U,K]=se([1,1]);Ce(()=>{const R=q()[0];if(!R)return;const ne=We(R),ee=new Image;ee.addEventListener("load",()=>{N(ee.height/ee.width),K([ee.width,ee.height])}),ee.src=ne});const A=()=>{const R=Os(B(),q().length,v()),ne=R.targetHeight*R.targetRows,ee=R.targetWidth*R.targetCols;return{imageWidth:Math.min(U()[0],R.targetWidth),imageHeight:Math.min(U()[1],R.targetHeight),containerHeight:ne,containerWidth:ee,ratio:Math.min(1,Math.max(R.targetWidth,R.targetHeight)/Math.max(...U()))}},Q=(R=!1)=>{s(0),R&&(i([0,0]),t(1))},q=()=>(j()??{}).value??[],V=R=>Math.pow(R,2.5),G=()=>V(e());return(()=>{var R=js();return z(R,(()=>{var ne=ce(()=>!!j());return()=>ne()?[(()=>{var ee=Is(),g=ee.firstChild,b=g.nextSibling;return z(ee,()=>Object.values(a()).sort($o(a())).map(I=>(()=>{var x=Li();return x.$$click=()=>{Q(),s(0),l(I.name)},z(x,()=>I.name),W(()=>x.classList.toggle("active",I.name===r())),x})()),b),z(ee,()=>[{id:"single",text:"Single image"},{id:"mosaic",text:"Grid view"},{id:"flipbook",text:"Flipbook"}].map(I=>(()=>{var x=Li();return x.$$click=()=>{Q(),f(I.id)},z(x,()=>I.text),W(()=>x.classList.toggle("active",c()===I.id)),x})()),null),ee})(),(()=>{var ee=Ls(),g=ee.firstChild,b=g.firstChild,I=b.firstChild;return z(ee,(()=>{var x=ce(()=>c()==="single"&&q().length>1);return()=>x()?(()=>{var P=Ms();return z(P,()=>q().map((O,E)=>(()=>{var H=Hs(),Z=H.firstChild;return H.$$click=()=>{s(E)},W(te=>{var M=E===o(),Y=We(O);return M!==te.e&&H.classList.toggle("active",te.e=M),Y!==te.t&&de(Z,"src",te.t=Y),te},{e:void 0,t:void 0}),H})())),P})():null})(),g),g.addEventListener("wheel",x=>{const P=D.getClientRects()[0],[O,E]=[x.clientX,x.clientY],{x:H,y:Z,width:te,height:M}=P,Y=(O-H)/te,F=(E-Z)/M;t(Math.max(.1,e()-(x.deltaY>0?.075:-.075))),(()=>{i([0,0]);const T=D.getClientRects()[0],{x:oe,y:ge,width:we,height:Ne}=T,Me=(O-oe)/we,ft=(E-ge)/Ne,pt=Me-Y,Ct=ft-F,tn=pt*we/G(),Ln=Ct*Ne/G();i([n()[0]+tn,n()[1]+Ln])})()}),g.$$mousedown=x=>{const P=x.clientX,O=x.clientY,[E,H]=n(),Z=M=>{M.preventDefault();const Y=M.clientX,F=M.clientY,T=P-Y,oe=O-F;i([E-T/G(),H-oe/G()])},te=()=>{document.removeEventListener("mousemove",Z),document.removeEventListener("mouseup",te)};document.addEventListener("mousemove",Z),document.addEventListener("mouseup",te)},g.$$dblclick=()=>{Q(!0)},z(g,$e(go,{get children(){return[$e(it,{get when(){return c()==="single"},get children(){var x=Ti(),P=D;return typeof P=="function"?$t(P,x):D=x,W(O=>{var E=L(),H=We((j().value??[])[o()]);return E!==O.e&&((O.e=E)!=null?x.style.setProperty("transform",E):x.style.removeProperty("transform")),H!==O.t&&de(x,"src",O.t=H),O},{e:void 0,t:void 0}),x}}),$e(it,{get when(){return c()==="mosaic"},get children(){var x=Ns(),P=x.firstChild;x.$$dblclick=()=>{Q(!0)};var O=D;return typeof O=="function"?$t(O,x):D=x,z(P,()=>q().map((E,H)=>(()=>{var Z=Rs(),te=Z.firstChild;return Z.$$click=()=>{s(H)},W(M=>{var Y=`${A().imageWidth}px`,F=`${A().imageHeight}px`,T=We(E);return Y!==M.e&&((M.e=Y)!=null?Z.style.setProperty("width",Y):Z.style.removeProperty("width")),F!==M.t&&((M.t=F)!=null?Z.style.setProperty("height",F):Z.style.removeProperty("height")),T!==M.a&&de(te,"src",M.a=T),M},{e:void 0,t:void 0,a:void 0}),Z})())),W(E=>{var H=L(),Z=`${A().containerWidth}px`,te=`${A().containerHeight}px`;return H!==E.e&&((E.e=H)!=null?x.style.setProperty("transform",H):x.style.removeProperty("transform")),Z!==E.t&&((E.t=Z)!=null?P.style.setProperty("width",Z):P.style.removeProperty("width")),te!==E.a&&((E.a=te)!=null?P.style.setProperty("height",te):P.style.removeProperty("height")),E},{e:void 0,t:void 0,a:void 0}),x}}),$e(it,{get when(){return c()==="flipbook"},get children(){return[(()=>{var x=Ts(),P=x.firstChild,O=P.nextSibling,E=O.nextSibling,H=E.nextSibling;return O.$$input=Z=>{_({...m(),[r()]:Math.max(1,parseInt(Z.currentTarget.value,10))})},H.addEventListener("change",()=>{$(!w())}),W(()=>O.value=m()[r()]??12),W(()=>H.checked=w()),x})(),(()=>{var x=Ti(),P=D;return typeof P=="function"?$t(P,x):D=x,W(O=>{var E=L(),H=We((j().value??[])[d()]);return E!==O.e&&((O.e=E)!=null?x.style.setProperty("transform",E):x.style.removeProperty("transform")),H!==O.t&&de(x,"src",O.t=H),O},{e:void 0,t:void 0}),x})()]}})]}}),b),b.$$click=()=>{Q(!0)},z(b,(()=>{var x=ce(()=>c()==="mosaic");return()=>x()?parseFloat((A().ratio*G()).toFixed(2)):parseFloat(G().toFixed(2))})(),I),ee})()]:null})(),null),z(R,(()=>{var ne=ce(()=>!j());return()=>ne()?(()=>{var ee=zs(),g=ee.firstChild,b=g.nextSibling;return b.muted=!0,b.autoplay=!0,b.loop=!0,ee})():null})(),null),W(()=>{var ne,ee;return R.classList.toggle("hasMultiple",((ee=(ne=j())==null?void 0:ne.value)==null?void 0:ee.length)>0)}),R})()};ut(["dblclick","mousedown","input","click"]);const Bs=Object.freeze(Object.defineProperty({__proto__:null,ImagePreviews:Ds,localStoragePreviewImagesKey:Lt},Symbol.toStringTag,{value:"Module"})),si=Symbol("store-raw"),wt=Symbol("store-node"),Re=Symbol("store-has"),wo=Symbol("store-self");function bo(e){let t=e[rt];if(!t&&(Object.defineProperty(e,rt,{value:t=new Proxy(e,Gs)}),!Array.isArray(e))){const n=Object.keys(e),i=Object.getOwnPropertyDescriptors(e);for(let o=0,s=n.length;o<s;o++){const r=n[o];i[r].get&&Object.defineProperty(e,r,{enumerable:i[r].enumerable,get:i[r].get.bind(t)})}}return t}function Xe(e){let t;return e!=null&&typeof e=="object"&&(e[rt]||!(t=Object.getPrototypeOf(e))||t===Object.prototype||Array.isArray(e))}function kt(e,t=new Set){let n,i,o,s;if(n=e!=null&&e[si])return n;if(!Xe(e)||t.has(e))return e;if(Array.isArray(e)){Object.isFrozen(e)?e=e.slice(0):t.add(e);for(let r=0,l=e.length;r<l;r++)o=e[r],(i=kt(o,t))!==o&&(e[r]=i)}else{Object.isFrozen(e)?e=Object.assign({},e):t.add(e);const r=Object.keys(e),l=Object.getOwnPropertyDescriptors(e);for(let a=0,u=r.length;a<u;a++)s=r[a],!l[s].get&&(o=e[s],(i=kt(o,t))!==o&&(e[s]=i))}return e}function yn(e,t){let n=e[t];return n||Object.defineProperty(e,t,{value:n=Object.create(null)}),n}function Ft(e,t,n){if(e[t])return e[t];const[i,o]=se(n,{equals:!1,internal:!0});return i.$=o,e[t]=i}function Fs(e,t){const n=Reflect.getOwnPropertyDescriptor(e,t);return!n||n.get||!n.configurable||t===rt||t===wt||(delete n.value,delete n.writable,n.get=()=>e[rt][t]),n}function ko(e){ti()&&Ft(yn(e,wt),wo)()}function Us(e){return ko(e),Reflect.ownKeys(e)}const Gs={get(e,t,n){if(t===si)return e;if(t===rt)return n;if(t===ei)return ko(e),n;const i=yn(e,wt),o=i[t];let s=o?o():e[t];if(t===wt||t===Re||t==="__proto__")return s;if(!o){const r=Object.getOwnPropertyDescriptor(e,t);ti()&&(typeof s!="function"||e.hasOwnProperty(t))&&!(r&&r.get)&&(s=Ft(i,t,s)())}return Xe(s)?bo(s):s},has(e,t){return t===si||t===rt||t===ei||t===wt||t===Re||t==="__proto__"?!0:(ti()&&Ft(yn(e,Re),t)(),t in e)},set(){return!0},deleteProperty(){return!0},ownKeys:Us,getOwnPropertyDescriptor:Fs};function Ie(e,t,n,i=!1){if(!i&&e[t]===n)return;const o=e[t],s=e.length;n===void 0?(delete e[t],e[Re]&&e[Re][t]&&o!==void 0&&e[Re][t].$()):(e[t]=n,e[Re]&&e[Re][t]&&o===void 0&&e[Re][t].$());let r=yn(e,wt),l;if((l=Ft(r,t,o))&&l.$(()=>n),Array.isArray(e)&&e.length!==s){for(let a=e.length;a<s;a++)(l=r[a])&&l.$();(l=Ft(r,"length",s))&&l.$(e.length)}(l=r[wo])&&l.$()}function xo(e,t){const n=Object.keys(t);for(let i=0;i<n.length;i+=1){const o=n[i];Ie(e,o,t[o])}}function Ks(e,t){if(typeof t=="function"&&(t=t(e)),t=kt(t),Array.isArray(t)){if(e===t)return;let n=0,i=t.length;for(;n<i;n++){const o=t[n];e[n]!==o&&Ie(e,n,o)}Ie(e,"length",i)}else xo(e,t)}function Nt(e,t,n=[]){let i,o=e;if(t.length>1){i=t.shift();const r=typeof i,l=Array.isArray(e);if(Array.isArray(i)){for(let a=0;a<i.length;a++)Nt(e,[i[a]].concat(t),n);return}else if(l&&r==="function"){for(let a=0;a<e.length;a++)i(e[a],a)&&Nt(e,[a].concat(t),n);return}else if(l&&r==="object"){const{from:a=0,to:u=e.length-1,by:c=1}=i;for(let f=a;f<=u;f+=c)Nt(e,[f].concat(t),n);return}else if(t.length>1){Nt(e[i],t,[i].concat(n));return}o=e[i],n=[i].concat(n)}let s=t[0];typeof s=="function"&&(s=s(o,n),s===o)||i===void 0&&s==null||(s=kt(s),i===void 0||Xe(o)&&Xe(s)&&!Array.isArray(s)?xo(o,s):Ie(e,i,s))}function Mt(...[e,t]){const n=kt(e||{}),i=Array.isArray(n),o=bo(n);function s(...r){us(()=>{i&&r.length===1?Ks(n,r[0]):Nt(n,r)})}return[o,s]}const ri=Symbol("store-root");function mt(e,t,n,i,o){const s=t[n];if(e===s)return;const r=Array.isArray(e);if(n!==ri&&(!Xe(e)||!Xe(s)||r!==Array.isArray(s)||o&&e[o]!==s[o])){Ie(t,n,e);return}if(r){if(e.length&&s.length&&(!i||o&&e[0]&&e[0][o]!=null)){let u,c,f,h,d,p,m,_;for(f=0,h=Math.min(s.length,e.length);f<h&&(s[f]===e[f]||o&&s[f]&&e[f]&&s[f][o]===e[f][o]);f++)mt(e[f],s,f,i,o);const w=new Array(e.length),$=new Map;for(h=s.length-1,d=e.length-1;h>=f&&d>=f&&(s[h]===e[d]||o&&s[f]&&e[f]&&s[h][o]===e[d][o]);h--,d--)w[d]=s[h];if(f>d||f>h){for(c=f;c<=d;c++)Ie(s,c,e[c]);for(;c<e.length;c++)Ie(s,c,w[c]),mt(e[c],s,c,i,o);s.length>e.length&&Ie(s,"length",e.length);return}for(m=new Array(d+1),c=d;c>=f;c--)p=e[c],_=o&&p?p[o]:p,u=$.get(_),m[c]=u===void 0?-1:u,$.set(_,c);for(u=f;u<=h;u++)p=s[u],_=o&&p?p[o]:p,c=$.get(_),c!==void 0&&c!==-1&&(w[c]=s[u],c=m[c],$.set(_,c));for(c=f;c<e.length;c++)c in w?(Ie(s,c,w[c]),mt(e[c],s,c,i,o)):Ie(s,c,e[c])}else for(let u=0,c=e.length;u<c;u++)mt(e[u],s,u,i,o);s.length>e.length&&Ie(s,"length",e.length);return}const l=Object.keys(e);for(let u=0,c=l.length;u<c;u++)mt(e[l[u]],s,l[u],i,o);const a=Object.keys(s);for(let u=0,c=a.length;u<c;u++)e[a[u]]===void 0&&Ie(s,a[u],void 0)}function li(e,t={}){const{merge:n,key:i="id"}=t,o=kt(e);return s=>{if(!Xe(s)||!Xe(o))return o;const r=mt(o,{[ri]:s},ri,n,i);return r===void 0?s:r}}var yt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ai={},So={};Object.defineProperty(So,"__esModule",{value:!0});var Fe={},Ws=yt&&yt.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,o){i.__proto__=o}||function(i,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(i[s]=o[s])},e(t,n)};return function(t,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n);function i(){this.constructor=t}t.prototype=n===null?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(Fe,"__esModule",{value:!0});Fe.TokenReader=Fe.TokenError=Fe.tokenizePrompt=void 0;function Vs(e){var t=[],n="",i=0,o=0,s=!1;function r(){n!==""&&(t.push([n,i]),n=""),i=o}function l(h){n+=h,o++}function a(){o++}for(var u=0,c=e.replace(/，/g,",").replace(/：/g,":").replace(/（/g,"(").replace(/）/g,")");u<c.length;u++){var f=c[u];if(s)s=!1,l(f);else switch(f){case"\\":{s=!0,l(f);break}case"(":case")":case"[":case"]":case"<":case">":case":":case",":case"|":{r(),l(f),r();break}case" ":{a(),r();break}default:l(f)}}return r(),t}Fe.tokenizePrompt=Vs;var ci=function(e){Ws(t,e);function t(n,i,o){var s=e.call(this,n)||this;return s.token=i,s.position=o,s}return t}(Error);Fe.TokenError=ci;var Ys=function(){function e(t){this.tokens=t,this.index=0}return e.prototype.position=function(){if(this.index<this.tokens.length)return this.tokens[this.index][1]},e.prototype.look=function(){if(this.index<this.tokens.length)return this.tokens[this.index][0]},e.prototype.lookMany=function(t){return this.tokens.slice(this.index,this.index+t).map(function(n){var i=n[0];return i})},e.prototype.next=function(){this.index<this.tokens.length&&this.index++},e.prototype.error=function(t){var n=this.look();if(n===void 0)throw new ci("Error happened at the end of the input: ".concat(t));var i=this.position();throw new ci("Error happened at (".concat(n,",").concat(i,"):").concat(t),n,i)},e}();Fe.TokenReader=Ys;var Pn={};Object.defineProperty(Pn,"__esModule",{value:!0});Pn.parsePrompt=void 0;var Rn=Fe;function Ao(e){return e.replace(/\\(.)/g,"$1")}function Js(e){var t=[];e:for(;;){var n=e.look();switch(n){case"(":case")":case"[":case"]":case"<":case">":case":":case",":case"|":case void 0:break e;default:t.push(n),e.next()}}if(t.length===0)e.error("Tag expected");else return{kind:"tag",name:t.map(Ao).join(" "),tokens:t}}function Xs(e){e.next();for(var t=_n(e,!1);;){var n=e.lookMany(2),i=n[0],o=n[1];if(i!==":"||!Number.isNaN(Number.parseFloat(o)))break;e.next(),t.push.apply(t,_n(e,!1))}if(e.look()===":"){e.next();var s=Po(e),r=s[0],l=s[1];return e.look()===","&&e.next(),(e.look()===")"||e.look()==="}"||e.look()===void 0)&&e.next(),{kind:"ew",weight:r,weightText:l,contents:t}}return(e.look()===")"||e.look()==="}"||e.look()===void 0)&&e.next(),{kind:"pw",contents:t}}function qs(e){e.next();var t=_n(e,!1);return(e.look()==="]"||e.look()==="}"||e.look()===void 0)&&e.next(),{kind:"nw",contents:t}}function Eo(e,t){var n=e.look();switch(n){case"(":case")":case"[":case"]":case"<":case">":case":":case",":case void 0:e.error("".concat(t," expected"));default:return Ao(n)}}function Zs(e){var t=Eo(e,"Filename");return e.next(),t}function Co(e,t){function n(c){var f=Number.parseInt(c);return!Number.isNaN(f)&&"".concat(f)===c}{var i=e.lookMany(3),o=i[0],s=i[1],r=i[2];if(n(o)&&s===","&&n(r))return e.next(),e.next(),e.next(),[Number.parseFloat("".concat(o,".").concat(r)),"".concat(o).concat(s).concat(r)]}{var l=e.lookMany(2),o=l[0],s=l[1];if(o.endsWith(".")&&n(o.substring(0,o.length-1))&&n(s))return e.next(),e.next(),[Number.parseFloat("".concat(o).concat(s)),"".concat(o," ").concat(s)]}var a=Eo(e,t),u=Number.parseFloat(a);return Number.isNaN(u)&&e.error("Incorrect ".concat(t.toLowerCase()," format: ").concat(a)),e.next(),[u,a]}function Po(e){return Co(e,"Weight")}function Qs(e){return Co(e,"Multiplier")}function er(e,t){e.next(),e.next(),e.look()!==":"&&e.error('":" expected'),e.next();var n=Zs(e);if(e.look()===":"){e.next();var i=Qs(e),o=i[0],s=i[1];if(e.look()===">")return e.next(),{kind:t,filename:n,multiplier:o,multiplierText:s}}if(e.look()===">")return e.next(),{kind:t,filename:n};e.next(),e.error('">" expected')}function tr(e,t){switch(e.look()){case"(":return Xs(e);case"[":return qs(e);case"<":{var n=e.lookMany(2)[1];switch(n){case"lora":case"hypernet":return er(e,n);default:{e.next();return}}break}case",":e.error("Prompt expected");default:{var i=Js(e);if(t&&e.look()===":"&&!Number.isNaN(Number.parseFloat(e.lookMany(2)[1]))){e.next();var o=Po(e),s=o[0],r=o[1];return{kind:"ew",weight:s,weightText:r,contents:[i]}}else return i}}}function _n(e,t){for(var n=[];;){var i=e.look();switch(i){case",":{e.next();break}case":":case")":case"]":case">":case"|":case void 0:return n;default:{var o=tr(e,t);o!==void 0&&n.push(o)}}}}function nr(e){var t,n=typeof e=="string"?new Rn.TokenReader((0,Rn.tokenizePrompt)(e)):e instanceof Array?new Rn.TokenReader(e):e,i=[],o=!1;e:for(;;){o=!1;t:for(;;)switch(n.look()){case"|":{o=!0,n.next();break}case")":case"]":case">":case":":{n.next();continue e}case void 0:return i;default:break t}var s=_n(n,!0);o||i.length===0?i.push({kind:"prompt",contents:s}):(t=i[i.length-1].contents).push.apply(t,s)}}Pn.parsePrompt=nr;var On={};Object.defineProperty(On,"__esModule",{value:!0});On.printPrompt=void 0;function ln(e){for(var t="",n=!1,i=0,o=e;i<o.length;i++){var s=o[i];switch(s.kind==="tag"&&n?t+=", ":t!==""&&(t+=" "),s.kind){case"pw":{t+="(".concat(ln(s.contents),")");break}case"nw":{t+="[".concat(ln(s.contents),"]");break}case"ew":{t+="(".concat(ln(s.contents),":").concat(s.weightText?s.weightText:s.weight,")");break}case"lora":case"hypernet":{t+="<".concat(s.kind,":").concat(s.filename,":").concat(s.multiplierText?s.multiplierText:s.multiplier,">");break}default:t+=s.name}n=s.kind==="tag"}return t}function ir(e){return ln(e.contents)}On.printPrompt=ir;var jn={};Object.defineProperty(jn,"__esModule",{value:!0});jn.evaluatePrompt=void 0;function an(e,t,n,i){for(var o,s,r=0,l=e;r<l.length;r++){var a=l[r];switch(a.kind){case"pw":{an(a.contents,t*n,n,i);break}case"nw":{an(a.contents,t/n,n,i);break}case"ew":{an(a.contents,t*a.weight,n,i);break}case"lora":{i.loras.push({filename:a.filename,multiplier:(o=a.multiplier)!==null&&o!==void 0?o:1});break}case"hypernet":{i.hypernets.push({filename:a.filename,multiplier:(s=a.multiplier)!==null&&s!==void 0?s:1});break}default:i.tags.push({tag:a.name,weight:t})}}}function or(e,t){t===void 0&&(t=1.1);var n={tags:[],loras:[],hypernets:[]};return an(e.contents,1,t,n),n}jn.evaluatePrompt=or;(function(e){var t=yt&&yt.__createBinding||(Object.create?function(i,o,s,r){r===void 0&&(r=s);var l=Object.getOwnPropertyDescriptor(o,s);(!l||("get"in l?!o.__esModule:l.writable||l.configurable))&&(l={enumerable:!0,get:function(){return o[s]}}),Object.defineProperty(i,r,l)}:function(i,o,s,r){r===void 0&&(r=s),i[r]=o[s]}),n=yt&&yt.__exportStar||function(i,o){for(var s in i)s!=="default"&&!Object.prototype.hasOwnProperty.call(o,s)&&t(o,i,s)};Object.defineProperty(e,"__esModule",{value:!0}),n(So,e),n(Fe,e),n(Pn,e),n(On,e),n(jn,e)})(ai);const Ye=e=>JSON.parse(JSON.stringify(e));var sr=C('<div class=prompt><div class=arrows><div class="arrow down"title="Move down">▼</div></div><label><input></label><div class=weight title="Click scroll wheel button to reset to 1"></div><button class=less title="Use Scroll Wheel to quickly change value">- 0.05</button><input type=range step=0.05><button class=more title="Use Scroll Wheel to quickly change value">+ 0.05</button><button class=remove title="Remove token">X</button><input type=checkbox>'),rr=C('<div class="arrow up"title="Move up">▲'),lr=C('<div class=promptTweaker><div class=buttons><button title="Use Scroll Wheel to quickly change all values">- 0.05 All</button><button title="Move all values 5% towards 1">Compress 5%</button><button title="Converts weights so they all add up to 1">Normalize</button><button title="Use Scroll Wheel to quickly change all values">+ 0.05 All</button></div><div class=promptTweakerPrompts>');const cn="🔒",un="🔏",ar=e=>{const t=n=>{var i,o;return n.kind==="pw"&&(n={kind:"ew",weight:1.1,weightText:"1.1",contents:(i=n.contents)==null?void 0:i.map(t)}),n.kind==="nw"&&(n={kind:"ew",weight:.9,weightText:"0.9",contents:(o=n.contents)==null?void 0:o.map(t)}),n};return e.map(n=>(n.contents=n.contents.flatMap(i=>{const o=t(i);return Oo(o)}),n))};function Oo(e,t=1){if(e.contents&&e.contents.length>0)return e.contents.flatMap(n=>Oo(n,t*(e.weight??1)));{const n=ui(t);return{kind:"ew",weight:n,weightText:n.toString(),contents:[e]}}}function cr(e,t,n){return e+n*(t-e)}function je(e,t){if(e){if(typeof e[t]<"u")return e[t];if(e.contents)for(const n of e.contents){const i=je(n,t);if(i!==void 0)return i}}}const ui=e=>parseFloat(e.toFixed(2)),ur=e=>{const[t,n]=Mt([]),i=()=>{e.update([{contents:t}].map(ai.printPrompt).join(", "))};Ce(()=>{const h=ai.parsePrompt(e.prompt),d=ar(h);n(d[0]?li(d[0].contents):[])});const o=ce(()=>Math.min(...t.map(h=>h.weight??1))),s=ce(()=>Math.max(...t.map(h=>h.weight??1))),r=(h,d)=>{const p=t.findIndex(k=>je(k,"name")===h),m=p+d;if(m<0)return;const _=t.length;if(m===_)return;const w=Ye(t),$=w[p],y=w[m];w[m]=$,w[p]=y,n(li(w)),i()},l=h=>{for(const[d,p]of t.entries())n(d,"weight",ui(h(p.weight??-666))),n(d,"weightText",(p.weight??-666).toString());i()},a=(h,d,p="weight")=>{var _;const m=t.findIndex(w=>je(w,"name")===h);p==="weight"?(n(m,p,ui(d(t[m][p]))),n(m,"weightText",(_=t[m].weight)==null?void 0:_.toString())):p==="name"?n(m,"contents",0,p,d(t[m][p])):alert(`Implement ${p}`),i()},u=h=>{const d=h.deltaY<0?.05:-.05;l(p=>p+d)},c=()=>{const h=t.reduce((d,p)=>d+(p.weight??0),0);l(d=>parseFloat((d/h).toFixed(3)))},f=(h,d)=>{const p=()=>je(h,"name")??"",m=()=>p().includes(cn)&&p().includes(un);return(()=>{var _=sr(),w=_.firstChild,$=w.firstChild,y=w.nextSibling,k=y.firstChild,S=y.nextSibling,j=S.nextSibling,L=j.nextSibling,D=L.nextSibling,B=D.nextSibling,X=B.nextSibling;return _.addEventListener("wheel",v=>{const N=v.deltaY<0?.05:-.05;a(p(),U=>U+N)}),z(w,(()=>{var v=rr();return v.$$click=()=>{r(p(),-1)},v})(),$),$.$$click=()=>{r(p(),1)},k.addEventListener("change",v=>{const N=v.currentTarget.value;a(p(),()=>N,"name")}),S.$$mousedown=v=>{v.which===2&&(a(p(),()=>1),i())},S.$$dblclick=()=>{document.querySelector(".comfy-queue-btn").click()},z(S,()=>(je(h,"weight")??1).toFixed(2)),j.$$click=()=>{a(p(),v=>v-.05)},L.addEventListener("change",v=>{a(p(),()=>parseFloat(v.currentTarget.value))}),L.$$input=v=>{const N=t[d()].weight;!N||N<0||N>2||a(p(),()=>parseFloat(v.currentTarget.value))},D.$$click=()=>{a(p(),v=>v+.05)},B.$$click=()=>{n(t.filter(v=>je(v,"name")!==je(h,"name"))),i()},X.addEventListener("change",()=>{m()?a(p(),()=>{var v;return(v=je(h,"name"))==null?void 0:v.replace(cn,"").replace(un,"")},"name"):a(p(),()=>cn+(je(h,"name")??"")+un,"name"),i()}),W(v=>{var N=!!m(),U=je(h,"name"),K=Math.min(o(),0),A=Math.max(s(),2),Q=m()?"Temporarily disabled token":"Click to temporarily disable token";return N!==v.e&&_.classList.toggle("tmp",v.e=N),U!==v.t&&de(k,"title",v.t=U),K!==v.a&&de(L,"min",v.a=K),A!==v.o&&de(L,"max",v.o=A),Q!==v.i&&de(X,"title",v.i=Q),v},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),W(()=>k.value=je(h,"name")),W(()=>L.value=je(h,"weight")),W(()=>X.checked=!m()),_})()};return(()=>{var h=lr(),d=h.firstChild,p=d.firstChild,m=p.nextSibling,_=m.nextSibling,w=_.nextSibling,$=d.nextSibling;return d.addEventListener("wheel",u),p.$$click=()=>{l(y=>y-.05)},m.$$click=()=>{l(y=>cr(y,1,.05))},_.$$click=c,w.$$click=()=>{l(y=>y+.05)},z($,$e(mo,{each:t,children:f})),h})()};ut(["click","dblclick","mousedown","input"]);var dr=C("<div class=settingsPopup><div class=close>❌</div><div class=header>Settings</div><div class=modalContent><div class=mapeSettings>"),fr=C("<input type=text>"),pr=C("<input type=color>"),hr=C("<input type=number>"),mr=C("<input type=checkbox>"),gr=C('<div class=mapeSetting><label class=name></label><div class=reset title="Reset to default value">♻️</div><label class=value>');const jo={nodeAlignOffsetY:{name:"Offset Y pixel amount",value:{type:"number",value:50}},nodeOrganizeSpacingInputY:{name:"Node organize input Y spacing",value:{type:"number",value:15}},nodeOrganizeSpacingOutputY:{name:"Node organize output Y spacing",value:{type:"number",value:34}},nodeOrganizeSpacingInputX:{name:"Node organize input X spacing",value:{type:"number",value:200}},nodeOrganizeSpacingOutputX:{name:"Node organize output X spacing",value:{type:"number",value:60}},alwaysPromptVariableName:{name:"Prompt for variable name",value:{type:"bool",value:!1}},collapseNodesOnOrganize:{name:"Collapse GET/SET when organizing node",value:{type:"bool",value:!0}},resizeNodeWidthOnAlignment:{name:"Resize node on left alignment",value:{type:"bool",value:!0}},showAllConnectionsOnFocus:{name:"Show connections for all nodes when focusing variable",value:{type:"bool",value:!0}},organizeSideNodes:{name:"Organize variables when dragging/selecting parent node",value:{type:"bool",value:!0}},replaceSearch:{name:"Hijack Comfy node search to allow fuzzy search (Might break)",value:{type:"bool",value:!0}},showConnectionOnNodeHover:{name:"Show connections when hovering a node",value:{type:"bool",value:!1}},showAllConnectionsOnNodeHover:{name:"Show all connections when hovering a node",value:{type:"bool",value:!1}},animateSelectedNode:{name:"Animate connections of the selected node",value:{type:"bool",value:!1}},animateAllNodes:{name:"Animate connections of all nodes",value:{type:"bool",value:!1}},selectedNodeConnectionOpacity:{name:"Opacity % of selected node connections",value:{type:"number",value:100}},nodeConnectionOpacity:{name:"Opacity % of node connections",value:{type:"number",value:10}},dblClickToRename:{name:"Double click regular node to set title",value:{type:"bool",value:!0}},setIcon:{name:"Set title icon",value:{type:"string",value:"💾 "}},setBackgroundColor:{name:"Set title background color",value:{type:"color",value:"#212121"}},getIcon:{name:"Get title icon",value:{type:"string",value:""}},getBackgroundColor:{name:"Get title background",value:{type:"color",value:"#212121"}},dblClickToRenameGroup:{name:"Double click groups to set title",value:{type:"bool",value:!0}},profileNodes:{name:"Show node runtime duration",value:{type:"bool",value:!0}},ignorePromptForExplodeHeal:{name:"Ignore prompt when splitting/healing links",value:{type:"bool",value:!1}}},[dn,gt]=Mt(JSON.parse(JSON.stringify(jo))),Mi=localStorage.mape_helpers_settings;if(Mi)try{const e=JSON.parse(Mi);for(const[t,n]of Object.entries(e))gt(t,"value","value",n)}catch{console.error("Failed to parse settings")}const ie=e=>dn[e].value.value,vr=e=>{const t=()=>{localStorage.mape_helpers_settings=JSON.stringify(Object.fromEntries(Object.entries(dn).map(([n,i])=>[n,i.value.value])))};return Ce(()=>{JSON.stringify(dn),t()}),(()=>{var n=dr(),i=n.firstChild,o=i.nextSibling,s=o.nextSibling,r=s.firstChild;return wi(i,"click",e.close,!0),z(r,()=>Object.entries(dn).map(([l,{name:a,value:u}])=>(()=>{var c=gr(),f=c.firstChild,h=f.nextSibling,d=h.nextSibling;return de(f,"for",l),z(f,a),h.$$click=()=>{gt(l,"value","value",jo[l].value.value)},z(d,$e(go,{get children(){return[$e(it,{get when(){return u.type==="string"},get children(){var p=fr();return p.$$input=m=>{gt(l,"value","value",m.currentTarget.value)},de(p,"id",l),W(()=>p.value=u.value),p}}),$e(it,{get when(){return u.type==="color"},get children(){var p=pr();return p.$$input=m=>{gt(l,"value","value",m.currentTarget.value)},de(p,"id",l),W(()=>p.value=u.value),p}}),$e(it,{get when(){return u.type==="number"},get children(){var p=hr();return p.$$input=m=>{gt(l,"value","value",parseFloat(m.currentTarget.value))},de(p,"id",l),W(()=>p.value=u.value),p}}),$e(it,{get when(){return u.type==="bool"},get children(){var p=mr();return p.addEventListener("change",m=>{gt(l,"value","value",m.currentTarget.checked)}),de(p,"id",l),W(()=>p.checked=u.value),p}})]}})),c})())),n})()};ut(["click","input"]);const $n=e=>e.toLowerCase().replace(/_./g,t=>t.replace("_","").toUpperCase()),dt=()=>graph.links??[],Ae=(e,t=dt())=>t[e],J=(e,t=0)=>{var n;if(e){if(e.widgets&&e.widgets[t])return e.widgets[t].value;if(e.widgets_values)return(n=e.widgets_values)==null?void 0:n[t]}},Ht=e=>{graph.add(e)},Ee=(e,t,n=0)=>{e.widgets_values||(e.widgets_values=[]),e.widgets_values[n]=t,e.widgets[n].value=t},Rt=e=>{graph.remove(e)},Io=(e,t=0)=>{var r,l;if(e.type!=="Reroute")return[e,t];const n=e,i=(l=(r=n.inputs)==null?void 0:r[0])==null?void 0:l.link;if(!i)return[n,t];const o=Ae(i);if(!o)return[n,t];const s=re(o.origin_id);return s?(setTimeout(()=>{Rt(n)}),Io(s,o.origin_slot)):[n,t]},No=e=>{var r,l;if(e.type!=="Reroute")return e;const t=e,n=(r=t.outputs[0])==null?void 0:r.links;if(!n)return t;const i=n[0];if(!i)return t;const o=Ae(i);if(!o)return t;const s=re(o.target_id);return s?(((l=t.outputs[0].links)==null?void 0:l.length)===1&&setTimeout(()=>{Rt(t)}),No(s)):t},To=(e,t=!1)=>{var m,_,w,$,y,k,S,j,L,D;const{type:n}=e;if(n==="*")return;let{origin_id:i,target_id:o,origin_slot:s,target_slot:r}=e,l=re(i),a=re(o);if(!l||!a)return!1;if(l.type==="Reroute"){let B=0;[l,B]=Io(l),i=l==null?void 0:l.id,s=B,(typeof s>"u"||s===-1)&&(s=0)}if(a.type==="Reroute"&&(a=No(a),o=a==null?void 0:a.id,r=a==null?void 0:a.inputs.findIndex(B=>B.type===n),(typeof r>"u"||r===-1)&&(r=0)),typeof i>"u"||typeof o>"u"||!l||!a||t&&(ae(l)||ae(a)))return!1;let u=$n(((m=a.getInputInfo(r))==null?void 0:m.name)??n.toLowerCase());u||(u=$n(((w=(_=l==null?void 0:l.outputs)==null?void 0:_[s])==null?void 0:w.name)??((y=($=l==null?void 0:l.outputs)==null?void 0:$[s])==null?void 0:y.type.toString())??`newVariable_from_${i}_to_${o}`));let c=!1,f=!1;if(ae(l))u=J(l),f=!0;else{const B=(S=(k=l.outputs)==null?void 0:k[s])==null?void 0:S.links;if(B)for(const X of B){const v=re(((j=Ae(X))==null?void 0:j.target_id)??-1);v&&ae(v)&&Se(v)&&(u=J(v),f=!0)}if(!f){for(const X of Jt()){const v=J(X);if(!(u===v&&Se(X)))continue;const U=(L=X.inputs[0])==null?void 0:L.link;((D=Ae(U))==null?void 0:D.origin_id)===l.id?f=!0:c=!0}c&&(u+=`_from_${i}_to_${o}`)}}let h;if(!f){h=LiteGraph.createNode("mape Variable");const B=l.getConnectionPos(!1,s);h.pos=[B[0]+20,B[1]],h.inputs[0].name=n,h.inputs[0].type=n,h.inputs[0].widget=a.inputs[r].widget,Ee(h,u),Ht(h),h.flags.collapsed=!0;let X=[];l.widgets?X=Object.values(l.widgets).map(v=>v.value):l.widgets_values&&(X=Ye(l.widgets_values)),l.connect(s,h,0),l.widgets_values=X,l.type==="PrimitiveNode"&&setTimeout(()=>{if(l){l.connect(s,h,0);for(const[v,N]of X.entries())Ee(l,N,v);h==null||h.setSize(h.computeSize())}})}const d=LiteGraph.createNode("mape Variable"),p=a.getConnectionPos(!0,r);d.pos=[p[0]-150,p[1]],d.outputs[0].name=n,d.outputs[0].type=n,d.outputs[0].widget=a.inputs[r].widget,Ht(d),Ee(d,u),d.flags.collapsed=!0,d==null||d.setSize(d.computeSize()),d.connect(0,a,r),!(t||!c||ie("alwaysPromptVariableName"))&&setTimeout(()=>{window.setPrompt("Variable name",graph.list_of_graphcanvas[0].last_mouse_position,B=>{Ee(d,B),h&&Ee(h,B)},u)},100)},wn=(e="valueUpdated")=>{window.dispatchEvent(new CustomEvent("mapeTweak",{detail:{message:e}}))},nt=((e="valueUpdated")=>{let t,n=0;const i=250;return()=>{Date.now()-n>i&&(n=Date.now(),wn(e)),clearTimeout(t),t=setTimeout(()=>{n=Date.now(),wn(e)},i)}})();function yr(e,t){t&&(e.save(),e.fillStyle="#000",e.fillText(t,6,-LiteGraph.NODE_TITLE_HEIGHT-2+1),e.fillStyle="#fff",e.fillText(t,5,-LiteGraph.NODE_TITLE_HEIGHT-2),e.restore())}const Hi=e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),Ri="eexxaacctt",zi=(e,t)=>t==0?"":t==1?`${e}??`:t==1/0?`${e}*?`:`${e}{0,${t}}?`;function _r(){const e={interSplit:"[^A-Za-z\\d']+",intraSplit:"[a-z][A-Z]",intraBound:"[A-Za-z]\\d|\\d[A-Za-z]|[a-z][A-Z]",interChars:".",interIns:1/0,intraChars:"[a-z\\d']",intraIns:0,intraContr:"'[a-z]{1,2}\\b"},{intraIns:t,intraContr:n,intraSplit:i,interSplit:o,intraBound:s,intraChars:r}=e,l='".+?"',a=new RegExp(l,"gi"),u=new RegExp(`(?:\\s+|^)-(?:${r}+|${l})`,"gi"),c=!!i,f=new RegExp(i,"g"),h=new RegExp(o,"g"),d=new RegExp(`^${o}|${o}$`,"g"),p=new RegExp(n,"gi"),m=y=>{const k=[];y=y.replace(a,j=>(k.push(j),Ri)),y=y.replace(d,"").toLocaleLowerCase(),c&&(y=y.replace(f,j=>`${j[0]} ${j[1]}`));let S=0;return y.split(h).filter(j=>j!="").map(j=>j===Ri?k[S++]:j)},_=y=>{let k=m(y);if(k.length==0)return[void 0];const S=Array(k.length).fill("");k=k.map((B,X)=>B.replace(p,v=>(S[X]=v,"")));const j=zi(r,t);let L=k.map((B,X)=>B[0]==='"'?Hi(B.slice(1,-1)):B.split("").join(j)+S[X]);const D=zi(e.interChars,e.interIns);return L=L.join(D),[new RegExp(L,"i")]},w=(y,k,S)=>{const[j]=_(k);if(!j)return[];const L=[];if(S!=null)for(let D=0;D<S.length;D++){const B=S[D];j.test(y[B])&&L.push(B)}else for(let D=0;D<y.length;D++)j.test(y[D])&&L.push(D.toString());return L};return(y,k)=>{let S,L=null,D=[];k=k.replace(u,X=>{let v=X.trim().slice(1);return v[0]==='"'&&(v=Hi(v.slice(1,-1))),""});const B=m(k);if(B.length==0)return[];if(B.length>1){const X=B.slice().sort((N,U)=>U.length-N.length);for(let N=0;N<X.length;N++){if((S==null?void 0:S.length)==0)return[];S=w(y,X[N],S)}if(B.length>2)return S;L=$r(B).map(N=>N.join(" ")),D.length=0;const v=new Set;for(let N=0;N<L.length;N++)if(v.size<(S==null?void 0:S.length)){const U=S==null?void 0:S.filter(A=>!v.has(A)),K=w(y,L[N],U);for(let A=0;A<K.length;A++)v.add(K[A]);D.push(K)}else D.push([])}return L==null&&(L=[k],D=[(S==null?void 0:S.length)>0?S:w(y,k)]),D.flat()}}function $r(e){e=e.slice();const t=e.length,n=[e.slice()],i=new Array(t).fill(0);let o=1,s,r;for(;o<t;)i[o]<o?(s=o%2&&i[o],r=e[o],e[o]=e[s],e[s]=r,++i[o],o=1,n.push(e.slice())):(i[o]=0,++o);return n}const wr=_r();function br(e,t){return wr([t],e).length>0}const kr=e=>{const t=J(e);return yo().find(n=>J(n)===t)};function xr(e){return .5-.5*Math.cos(Math.PI*e)}function Di(e,t,n){return n=xr(n),e+n*(t-e)}const Lo=([e,t],n)=>{const i=n.ds,o=document.body.clientWidth,s=document.body.clientHeight,r=i.scale,l=-e+o*.5/r,a=-t+s*.5/r,u=250,c=Date.now()+u,f=i.offset[0],h=i.offset[1],d=()=>{const p=c-Date.now();if(Date.now()<c)requestAnimationFrame(d);else{i.offset[0]=l,i.offset[1]=a,n.setDirty(!0,!0);return}const m=1-p/u;i.offset[0]=Di(f,l,m),i.offset[1]=Di(h,a,m),n.setDirty(!0,!0)};requestAnimationFrame(d)},bt=e=>{var r;const t=(r=e.graph)==null?void 0:r.list_of_graphcanvas[0],[n,i]=e.pos,[o,s]=e.size;Lo([n+o/2,i+s/2],t),t==null||t.selectNode(e)},bn=(e,t=!1)=>{var r,l,a;if(e.length===0)return;const n=ie("nodeOrganizeSpacingInputX"),i=ie("nodeOrganizeSpacingOutputX");if(e.filter(u=>!ae(u)).length===0)return;for(const u of e){let c=0,f=0;const h=ie("nodeOrganizeSpacingInputY"),d=ie("nodeOrganizeSpacingOutputY"),p=[];if(u.graph){for(const m of u.inputs??[]){const _=m.link;if(!_)continue;const{origin_id:w,target_slot:$}=Ae(_),y=re(w);if(!y||y.type!==Be)continue;if(y.outputs&&y.outputs[0]&&y.outputs[0].links&&y.outputs[0].links.length>1)return;const k=u.getConnectionPos(!0,$);y.pos=[k[0]-n,k[1]+15+c*h],c+=1,p.push(y),y.flags.collapsed=ie("collapseNodesOnOrganize")}for(const m of u.outputs??[])if(m.links&&u.graph)for(const _ of m.links){const{target_id:w}=Ae(_),$=re(w);if(!$){console.error("Failed",u.id,">",w);continue}if($.type!==Be)continue;const y=(l=(r=$.outputs)==null?void 0:r[0])==null?void 0:l.links;if(y&&y.length>1)return;const k=u.getConnectionPos(!1,0);$.pos=[k[0]+i,k[1]+15+f*d],f+=1,p.push($),$.flags.collapsed=ie("collapseNodesOnOrganize")}if(t&&e.length===1){const m=[u,...p];u.graph.list_of_graphcanvas[0].selectNodes(m)}}}const o=e[0];if(!o)return;((a=o.graph)==null?void 0:a.list_of_graphcanvas[0]).setDirty(!0,!0),nt()},Sr=e=>e?e.mode===0?!0:e.mode!==2:!1,Tt=(e,t=Oe(),n=dt(),i,o="",s)=>{var u,c,f,h,d,p,m,_;if(!e)return;const r=re(e.origin_id,t),l=o||((c=(u=r==null?void 0:r.outputs)==null?void 0:u[e.origin_slot])==null?void 0:c.name);if(!r)return;if(ae(r)){const w=J(r);for(const $ of t.filter(ae).filter(Se))if(J($)===w){const k=$.inputs[0];if(k.link)return Tt(n[k.link],t,n,i,l)}throw new Error("Failed to resolve virtual link")}if(r.mode===4){if(!r.inputs)return;const $=r.inputs.map(k=>n[k.link]).filter(k=>(k==null?void 0:k.type)===i).sort((k,S)=>{var D,B,X,v;const j=(B=(D=re(k.target_id,t))==null?void 0:D.outputs[k.target_slot])==null?void 0:B.name,L=(v=(X=re(S.target_id,t))==null?void 0:X.outputs[S.target_slot])==null?void 0:v.name;return j===l?-1:L===l?1:k.type===i?-1:S.type===i?1:0})[0];if($&&$.type===i)return Tt($,t,n,i,l);const y=(f=r.inputs[0])==null?void 0:f.link;return y?Tt(n[y],t,n,i,l):void 0}if(r.type==="Reroute"){const w=(h=r.inputs[0])==null?void 0:h.link;return w?Tt(n[w],t,n,i,l):void 0}if(!s&&r.outputs){const w=r.outputs.filter($=>($==null?void 0:$.type)===i);if(w.length===1&&w[0]){const $=(p=(d=w==null?void 0:w[0])==null?void 0:d.links)==null?void 0:p[0];if($){const y=Ae($,n);if(y)return{originId:y.origin_id,originIndex:y.origin_slot}}}else{const $=w.sort((y,k)=>{const S=y==null?void 0:y.name,j=k==null?void 0:k.name;return S===l?-1:j===l?1:y.type===i?-1:k.type===i?1:0});if($[0]){const y=(_=(m=$==null?void 0:$[0])==null?void 0:m.links)==null?void 0:_[0];if(y){const k=Ae(y,n);if(k)return{originId:k.origin_id,originIndex:k.origin_slot}}}}}if(e.type===i)return{originId:e.origin_id,originIndex:e.origin_slot}},Bi=(e=Oe(),t=dt())=>{const n={},i={};for(const a of e.filter(ae).filter(Se)){const u=J(a),c=a.inputs[0];if(c.link){const f=Ae(c.link,t);if(f){const h=Tt(f,e,t,f.type,void 0,!0);h?i[u]=h:i[u]={originId:f.origin_id,originIndex:f.origin_slot}}}}for(const a of e.filter(ae).filter(st)){const u=J(a);n[a.id]=u}const o={},r=e.filter(Sr).filter(ae),l=r.filter(Se);for(const a of l){o[a.id]=[];const u=J(a);for(const c of r){const f=J(c);u===f&&a.id!==c.id&&o[a.id].push(c.id)}}return{nodeSet:i,nodeGet:n,internalLinks:o}},di=(e,t)=>{const n=Oe().filter(ae);return(t==="get"?n.filter(st):n.filter(Se)).filter(o=>J(o)===e)},Mo=()=>{const e=Object.keys(Object.fromEntries(yo().map(t=>[J(t),!0])));for(const t of e){const n=di(t,"set")[0];if(!n)continue;const i=n.inputs[0].link;if(!i)continue;const{origin_id:o,origin_slot:s}=Ae(i),r=re(o);if(!r)continue;const l=di(t,"get");for(const a of l){for(const u of a.outputs)if(u.links)for(const c of u.links){const{target_id:f,target_slot:h}=Ae(c),d=re(f);try{r.connect(s,d,h)}catch(p){console.error(p)}}Rt(a)}Rt(n)}for(const t of Jt())Rt(t)};function fi(e,t,n=[]){const i=[];if(typeof e!=typeof t)return i.push(`Type mismatch at ${n.join(".")}: ${typeof e} !== ${typeof t}`),i.push(`Type mismatch at ${n.join(".")}: ${JSON.stringify(e)} !== ${JSON.stringify(t)}`),i;if(e instanceof Array&&t instanceof Array)if(e.length!==t.length)i.push(`Array length mismatch at ${n.join(".")}: ${e.length} !== ${t.length}`);else for(const[o,s]of e.entries()){const r=[...n,o.toString()];i.push(...fi(s,t[o],r))}else if(e instanceof Object&&t instanceof Object){const o=Object.keys(e),s=Object.keys(t),r=new Set([...o,...s]);for(const l of r){const a=[...n,l];l in e?l in t?i.push(...fi(e[l],t[l],a)):i.push(`Key missing in object2 at ${a.join(".")}`):i.push(`Key missing in object1 at ${a.join(".")}`)}}else e!==t&&i.push(`Value mismatch at ${n.join(".")}: ${e} !== ${t}`);return i}const pi=e=>{const t=re(e);t&&bt(t)},Ho=()=>{Object.values(dt()).filter(Boolean).sort((e,t)=>e.origin_id-t.origin_id).map(e=>{To(e,!0)}),bn(Oe())},Ar=(e,t)=>{window.run_mape_tests=async n=>{if(!localStorage.mape_internal_test)return;app.graph.list_of_graphcanvas[0].setZoom(.5),e.addEventListener("executing",d=>{pi(parseFloat(d.detail))});const i=document.querySelector("#comfy-view-queue-button");(i==null?void 0:i.innerText)==="View Queue"&&(i==null||i.click());const o=async d=>{const p={client_id:e.clientId,prompt:d.output,extra_data:{extra_pnginfo:{workflow:d.workflow}},number:Math.floor(Math.random()*1e4)},m=await e.fetchApi("/prompt",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)});if(m.status!==200)throw{response:await m.json()};return await m.json()},s=()=>new Promise(d=>{const p=()=>{!!document.querySelector(".comfy-list-items button")?setTimeout(p,50):d(!0)};setTimeout(p,50)}),l=await(await fetch("http://127.0.0.1:5823/")).json(),a=[],u=async()=>{app.loadGraphData(l.reset[0].workflow),await f(50),h(),await s(),await f(50)},c=(d,p)=>new Promise(async m=>{console.log(`${d.file}: Running`),app.loadGraphData(d.workflow),await f(50);const{originalPrompt:_}=await t(),w=await o(_);await s(),await f(50),await u(),app.loadGraphData(d.workflow),await f(50),console.log(`${d.file}: Splitting all connections`),Ho(),await f(50);const{prompt:$}=await t();await f(50);const y=await o($);await s(),await f(50),console.log(`${d.file}: Joining all connections`),Mo();const{originalPrompt:k}=await t(),S=await o(k);await s(),await f(50);for(const j of[w,y,S]){const L=Object.values(j.node_errors);if(L.length>0)throw console.error(L),new Error("Invalid response")}if(JSON.stringify(_.output)!==JSON.stringify($.output)||JSON.stringify(_.output)!==JSON.stringify(k.output)){console.log({preJson:w,postJson:y,originalPrompt:_,prompt:$}),console.log("Original",_.output),console.log("Converted",$.output);for(const j of fi(_.output,$.output))console.error(j);throw new Error("MISMATCH")}console.log(`${d.file}: Finished with matching outcome`),m(!0)}),f=d=>new Promise(p=>{setTimeout(p,d)}),h=()=>document.querySelector(".comfy-queue-btn").click();for(const d of l.regular)a.push({file:d.file,cb:()=>c(d)});(async()=>{await u();for(const d of a)(!n||n&&d.file.match(new RegExp(n,"i")))&&await d.cb();console.log("Finished tests...")})()}},zn=(e,t)=>{var s,r,l;const n=(s=app.canvas)==null?void 0:s.default_connection_color_byType,i=(r=e.inputs)==null?void 0:r[0],o=(l=e.outputs)==null?void 0:l[0];i&&(i.name=t,i.type=t,i.color_on=n[t]),o&&(o.name=t,o.type=t,o.color_on=n[t])},Fi=e=>{const t=(n,i=!1,o=s=>{})=>{if(!e.graph)return;const s=Object.values(dt()).filter(Boolean).find(l=>l.id===n);if(!s)return;if(i){const l=re(s.origin_id);if(!l)return;const a=l.outputs[s.origin_slot].type.toString();zn(e,a),o(a);return}if(!s){zn(e,Cs);return}const r=s.type;zn(e,r),o(r)};setTimeout(()=>{var n,i,o,s,r,l;if(Se(e)){const a=(i=(n=e.inputs)==null?void 0:n[0])==null?void 0:i.link;if(!a)return;t(a,!0,u=>{const c=J(e);localStorage[`mape_tweak_${c}`]&&(localStorage[`mape_tweak_${c}`]=u)})}else if(st(e)){const a=(r=(s=(o=e.outputs)==null?void 0:o[0])==null?void 0:s.links)==null?void 0:r[0];a&&t(a)}if(Se(e)){const a=J(e);(l=e.widgets)!=null&&l[1]||e.addWidget("toggle","tweak",!!localStorage[`mape_tweak_${a}`],u=>{var h,d;const c=(d=(h=e.inputs)==null?void 0:h[0])==null?void 0:d.type,f=J(e);u?localStorage[`mape_tweak_${f}`]=c:delete localStorage[`mape_tweak_${f}`],nt()}),e.setProperty("tweak",!!localStorage[`mape_tweak_${a}`])}})},Dn="",Er=async()=>{const{app:e}=await _t(()=>import(`${Dn}/scripts/app.js`),__vite__mapDeps([]));let t;e.registerExtension({name:"cg.customnodes.mape_helpers_boostrap",async init(){const d=e.graph.onConfigure;e.graph.onConfigure=function(...p){[t]=p,d.apply(this,p)}}});const{api:n}=await _t(()=>import(`${Dn}/scripts/api.js`),__vite__mapDeps([])),{setWidgetConfig:i}=await _t(()=>import(`${Dn}/extensions/core/widgetInputs.js`),__vite__mapDeps([]));let o;async function s(){const d=Ye(await o.apply(e)),p=Ye(await o.apply(e)),{nodeGet:m,nodeSet:_}=Bi(p.workflow.nodes,Object.fromEntries(p.workflow.links.map(([$,y,k,S,j,L])=>[$,{id:$,origin_id:y,origin_slot:k,target_id:S,target_slot:j,type:L}])));p.output=Object.fromEntries(Object.entries(p.output).filter(([$,y])=>y.class_type!==Be).map(([$,y])=>(y.inputs=Object.fromEntries(Object.entries(y.inputs).map(([k,S])=>{if(Array.isArray(S)){const[j,L]=S,D=m[j],B=_[D];if(!D||!B)return[k,S];const X=re(B.originId);if(!X)return[k,S];if(X.type==="PrimitiveNode")return[k,J(X)];if(X.updateLink){const v=X.updateLink({origin_id:B.originId,origin_slot:B.originIndex});if(v)return[k,[v.origin_id,v.origin_slot]]}return[k,[B.originId.toString(),B.originIndex]]}else return[k,S]})),[$,y])));const w=new RegExp(`${cn}.*?${un}`,"g");return p.output=Object.fromEntries(Object.entries(p.output).map(([$,y])=>(y.inputs=Object.fromEntries(Object.entries(y.inputs).map(([k,S])=>Array.isArray(S)?[k,S]:typeof S=="string"?[k,S.replaceAll(w,"").replace(/\(:\d+\.?\d+?\)/g,"")]:[k,S])),[$,y])).filter(Boolean)),localStorage.debugOutput&&console.info(JSON.stringify(p,null,"  ")),{prompt:p,originalPrompt:d}}let r=!1,l=!1,a;const u=LGraphCanvas.prototype.showLinkMenu,c=function(d,p){return p.shiftKey?(To(d),!1):(u.apply(this,[d,p]),!1)},f=d=>{setTimeout(()=>{for(const p of d.nodes){if(p.type!=="PrimitiveNode")continue;const m=re(p.id);if(m)for(const[_,w]of(p.widgets_values??[]).entries())m.widgets&&m.widgets[_]&&Ee(m,w,_)}e.graph.setDirtyCanvas(!0,!0),nt()})},h={name:"cg.customnodes.mape_helpers",async beforeRegisterNodeDef(d,p){for(const _ of["onAdded","onConnectInput","onConnectionsChange","onConnectOutput","onRemoved","onSelected","onDeselected","onPropertyChanged","onWidgetChanged","onMouseMove"]){const w=d.prototype[_];d.prototype[_]=function(...$){nt(),w==null||w.apply(this,$)}}if(p.display_name!==Be){const _=d.prototype.onDblClick;d.prototype.onDblClick=function(...$){_==null||_.apply(this,$);const y=$[1],[,k]=y;if(!ie("dblClickToRename")||k>0)return;const S=prompt("Name",this.title);S&&(this.title=S)};const w=d.prototype.onDrawForeground;d.prototype.onDrawForeground=function(...$){if(ie("profileNodes")){const[y]=$;yr(y,this.executionDuration||"")}return w==null?void 0:w.apply(this,$)};return}typeof window.graph>"u"&&(window.graph=e.graph),typeof window.app>"u"&&(window.app=e);const m=d.prototype.onConnectionsChange;d.prototype.onConnectionsChange=function(..._){const[w]=_,$=this;if((w===2?"output":"input")==="output"){if(Se($)){$.disconnectOutput(0);return}}else if(st($)){$.disconnectInput(0);return}ae($)&&w==1&&Fi($),m==null||m.apply($,_)},d.prototype.getTitle=function(){const _=this,w=Se(_),$=ie(w?"setIcon":"getIcon");d.title_color=ie(w?"setBackgroundColor":"getBackgroundColor");const y=J(_);return y?`${$}${y}`:_.title},d.prototype.onSelected=function(){r=!0},d.prototype.onMouseEnter=function(){a=this,l=!0},d.prototype.onMouseLeave=function(){a=void 0,l=!1},d.prototype.onDeselected=()=>{r=!1},d.prototype.onRemoved=()=>{r=!1},d.prototype.onDblClick=function(){const _=this;_.flags.collapsed=!_.flags.collapsed}},async nodeCreated(d){const p=d;if(p.IS_MAPE_VARIABLE=ae(d),!p.IS_MAPE_VARIABLE)return;d.onGraphConfigured=()=>{};const m=d.configure;d.configure=function(..._){m.apply(this,_);const w={FLOAT:{min:Number.MIN_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER,step:.1,round:.01},INT:{min:Number.MIN_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER},STRING:{default:""}};d.inputs=Ye(_[0].inputs).map($=>(i($,[$.type,w[$.type]]),$)),Fi(d)}},async setup(){var X;o=e.graphToPrompt,t&&f(t);const d=e.graph.onConfigure;e.graph.onConfigure=function(...v){f(v[0]),d.apply(this,v)},ie("replaceSearch")&&(String.prototype.__indexOf=String.prototype.indexOf,String.prototype.indexOf=function(v,N){var K;const U=this;return(K=new Error().stack)!=null&&K.match(/refreshHelper/)?br(v,U)?1:-1:this.__indexOf(v,N)}),document.addEventListener("keydown",v=>{v.key==="z"&&v.ctrlKey&&v.preventDefault()});let p=!0;e.graphToPrompt=async function(){return p&&Jt().length>0?(await s()).prompt:o.apply(e)};for(const v of["status","reconnecting","reconnected","executing","executed","execution_start","execution_error","b_preview","progress"])n.addEventListener(v,nt);const m=new Map;let _=0;for(const v of["executing"])n.addEventListener(v,N=>{var Q;const U=((Q=N==null?void 0:N.detail)==null?void 0:Q.node)??(N==null?void 0:N.detail),K=re(U);K&&(K.executionDuration="");const A=m.get(_);if(m.delete(_),_&&A){const q=Date.now()-A,V=re(_);V&&(V.executionDuration=`${(q/1e3).toFixed(2)}s`)}_=U,m.set(U,Date.now())});let w;n.addEventListener("progress",v=>{clearTimeout(w);const{value:N,max:U,node:K}=v.detail,A=re(K);N&&U&&K&&(document.title=`${A&&A.title?`${A.title}: `:""}${N}/${U} (${(N/U*100).toFixed(0)}%)`,N===U&&(document.title="Completed!",w=setTimeout(()=>{document.title="ComfyUI"},2e3))),nt()});const $=e.ui.dialog.show;window.mapeErrors=[],e.ui.dialog.show=function(...v){setTimeout(()=>{if(e.lastNodeErrors){for(const[N,U]of Object.entries(e.lastNodeErrors)){const K=re(parseFloat(N));for(const A of U.errors)window.mapeErrors.push({text:A.message,type:A.details,node:K})}nt(),window.showWarnings(!0)}}),$.apply(this,v)};const y=document.getElementById("comfy-save-button");if(y){const v=y.onclick;y.onclick=function(N){p=!1,v(N),p=!0}}const k=document.getElementById("comfy-dev-save-api-button");if(k){const v=k.onclick;k.onclick=function(N){p=!1,v(N),p=!0}}const S=LGraphCanvas.prototype.drawFrontCanvas;LGraphCanvas.prototype.drawFrontCanvas=function(...v){var q,V;if(S.apply(this,v),!r&&!l)return;let N=Ps();if(!N&&a&&ie("showAllConnectionsOnNodeHover")&&(N=a),!N&&a&&ie("showConnectionOnNodeHover")&&(st(a)?N=kr(a):N=a),!N||!e.canvas)return;const U=!r&&l&&!ie("showAllConnectionsOnNodeHover")&&ie("showConnectionOnNodeHover"),K=this.ctx,{nodeSet:A,internalLinks:Q}=Bi();for(const G of Oe().filter(R=>ae(R))){const R=G;if(U&&G.id!==N.id||(G.id,R.id,st(G)))continue;const ne=Q[R.id];if(!ne)continue;const ee=window.innerWidth,g=window.innerHeight;for(const b of ne){const I=re(b);if(!I){console.error("failed",R.id,b);continue}const x=J(N),P=J(I);let O=!0;const E=(V=(q=I.outputs)==null?void 0:q[0])==null?void 0:V.links;if(E)for(const nn of E){const Ai=Ae(nn);if(Ai){const Ei=re(Ai.target_id);Ei&&Ei.mode!==4&&(O=!1)}}if(O||!ie("showAllConnectionsOnFocus")&&x!==P)continue;let H=R,Z=0;if(A[P]&&A[P].originId!==R.id){const nn=re(A[P].originId);nn&&(H=nn,Z=A[P].originIndex)}const te=!1,M=!0,Y=H.getConnectionPos(te,Z),F=I.getConnectionPos(M,0),T=e.canvas.ds.scale,oe=e.canvas.ds.offset;Y[0]=Y[0]*T+oe[0]*T,Y[1]=Y[1]*T+oe[1]*T,F[0]=F[0]*T+oe[0]*T,F[1]=F[1]*T+oe[1]*T;const ge=F[0]-Y[0],we=F[1]-Y[1],Ne=LiteGraph.LEFT,Me=Math.abs(we)>Math.abs(ge)?we>0?LiteGraph.DOWN:LiteGraph.UP:ge<0?LiteGraph.LEFT:LiteGraph.RIGHT,ft=Y[0]>0&&Y[1]>0&&Y[0]<ee&&Y[1]<g,pt=F[0]>0&&F[1]>0&&F[0]<ee&&F[1]<g;if(!ft&&!pt)continue;K.save(),K.shadowColor="#000",K.shadowBlur=15,K.lineCap="round";const tn=x===P,Ln=ie("animateAllNodes")||tn&&ie("animateSelectedNode")||!1;e.canvas.renderLink(K,Y,F,void 0,!0,Ln,tn?`rgba(255,244,53,${ie("selectedNodeConnectionOpacity")/100})`:`rgba(255,255,255,${ie("nodeConnectionOpacity")/100})`,Me,Ne),K.restore()}}},LGraphCanvas.prototype.showLinkMenu=c;const j=LGraphCanvas.prototype.showConnectionMenu;LGraphCanvas.prototype.showConnectionMenu=function(...v){L||(this.use_original_menu=!0,j.apply(this,v),this.use_original_menu=!1)};let L=!1,D=!1;document.addEventListener("keydown",v=>{D=v.ctrlKey,L=v.shiftKey}),e.canvas._mousemove_callback=()=>{if(!ie("organizeSideNodes"))return;const v=tt();bn(v)},document.addEventListener("keyup",v=>{var K;const N=document.activeElement;if(N.tagName==="INPUT"&&(N.type==="text"||N.type==="number")||N.tagName==="TEXTAREA")return;if(v.key==="A"&&v.shiftKey){document.querySelector(".comfy-queue-btn").click();return}if(v.key==="ArrowLeft"&&v.shiftKey){const A=tt(),Q=Math.min(...A.map(V=>V.pos[0])),q=Math.max(...A.map(V=>V.size[0]));for(const V of A)V.pos=[Q,V.pos[1]],ie("resizeNodeWidthOnAlignment")&&(V.size=[q,V.size[1]]);return}if(v.key==="ArrowDown"&&v.shiftKey){const A=tt().filter(G=>!ae(G)),Q=Math.min(...A.map(G=>G.pos[1])),q=ie("nodeAlignOffsetY");let V=0;for(const G of A.sort((R,ne)=>R.pos[1]-ne.pos[1])){G.pos=[G.pos[0],Q+V];const R=G.size[1]+q;V+=R}return}if(v.key==="ArrowUp"&&v.shiftKey){const A=tt(),Q=Math.min(...A.map(q=>q.pos[1]));for(const q of A)q.pos=[q.pos[0],Q];return}if(v.key==="O"&&v.shiftKey){const A=tt();bn(A,!0)}const U=tt()[0];if(!(!U||!U.type||U.type!==Be)){if(v.key==="w"){const A=J(U);setTimeout(()=>{var Q,q,V;window.setPrompt("Variable name",((V=(q=(Q=U.graph)==null?void 0:Q.list_of_graphcanvas)==null?void 0:q[0])==null?void 0:V.last_mouse_position)??[document.body.clientWidth/2,document.body.clientHeight/2],G=>{if(G){localStorage[`mape_tweak_${A}`]&&(localStorage[`mape_tweak_${G}`]=localStorage[`mape_tweak_${A}`],delete localStorage[`mape_tweak_${A}`]),localStorage[`${Ve}${A}`]&&(localStorage[`${Ve}${G}`]=localStorage[`${Ve}${A}`],delete localStorage[`${Ve}${A}`]);for(const R of graph._nodes)J(R)===A&&Ee(R,G);wn("rename")}},A)})}if(v.key==="s"){const A=J(U);for(const Q of graph._nodes)J(Q)===A&&(K=Q.inputs)!=null&&K[0].link&&bt(Q)}if(v.key==="ArrowLeft"||v.key==="ArrowRight"){const A=v.key==="ArrowLeft"?-1:1,Q=U,q=J(Q);let V=graph._nodes.filter(g=>J(g)===q);const G=V.find(Se);if(!G)return;V=V.sort((g,b)=>{const I=oi(G.pos[0],G.pos[1],g.pos[0],g.pos[1]),x=oi(G.pos[0],G.pos[1],b.pos[0],b.pos[1]);return I-x});const ne=V.findIndex(g=>g.id===Q.id)+A,ee=V.length;if(ne>ee-1||ne<0)return;bt(V[ne])}if(v.key.match(/^\d+$/)){const A=parseFloat(v.key)-1,q=J(U),G=graph._nodes.filter(R=>J(R)===q)[A];G&&bt(G)}}}),document.body.addEventListener("keyup",()=>{D=!1,L=!1});let B=(X=e.canvas)==null?void 0:X.allow_searchbox;Object.defineProperty(e.canvas,"allow_searchbox",{get:function(){var U;const v=this.graph.getGroupOnPos(...this.canvas_mouse),N=this.connecting_node&&ae(this.connecting_node);if(!L||N)return B;if(this.connecting_input){const K=$n((U=this.connecting_input.name)==null?void 0:U.toLowerCase()),A=LiteGraph.createNode("mape Variable");A.pos=[this.canvas_mouse[0]+10,this.canvas_mouse[1]],Ht(A);const Q=this.connecting_input.slot_index;return Ee(A,K),A.connect(0,this.connecting_node,Q),A.flags.collapsed=!0,A.setSize(A.computeSize()),setTimeout(()=>{var q,V;window.setPrompt("Variable name",((V=(q=graph.list_of_graphcanvas)==null?void 0:q[0])==null?void 0:V.last_mouse_position)??[document.body.clientWidth/2,document.body.clientHeight/2],G=>{Ee(A,G)},K)}),!1}else if(this.connecting_output){const K=$n(this.connecting_output.name??this.connecting_output.type),A=LiteGraph.createNode("mape Variable");A.pos=[this.canvas_mouse[0]+10,this.canvas_mouse[1]],Ht(A);const Q=this.connecting_output.slot_index;if(Ee(A,K),this.connecting_node.connect(Q,A,0),A.flags.collapsed=!0,A.setSize(A.computeSize()),!D)return setTimeout(()=>{var V,G;window.setPrompt("Variable name",((G=(V=graph.list_of_graphcanvas)==null?void 0:V[0])==null?void 0:G.last_mouse_position)??[document.body.clientWidth/2,document.body.clientHeight/2],R=>{Ee(A,R)},K)}),!1;const q=LiteGraph.createNode("mape Variable");return q.pos=[this.canvas_mouse[0]+10,this.canvas_mouse[1]+50],Ht(q),Ee(q,K),q.flags.collapsed=!0,q.setSize(q.computeSize()),setTimeout(()=>{var V,G;window.setPrompt("Variable name",((G=(V=graph.list_of_graphcanvas)==null?void 0:V[0])==null?void 0:G.last_mouse_position)??[document.body.clientWidth/2,document.body.clientHeight/2],R=>{Ee(A,R),Ee(q,R)},K)}),!1}return v&&L&&ie("dblClickToRenameGroup")?(L=!1,setTimeout(()=>{const K=prompt("Change group name",v.title);K&&(v.title=K,e.graph.setDirtyCanvas(!0,!0))},100),!1):!0},set:function(v){B=v}}),Ar(n,s)}};e.registerExtension(h)},Cr=Object.freeze(Object.defineProperty({__proto__:null,registerPlugin:Er},Symbol.toStringTag,{value:"Module"})),Bn=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function Fn(e,t,n,i){e.addEventListener?e.addEventListener(t,n,i):e.attachEvent&&e.attachEvent("on".concat(t),n)}function Pt(e,t,n,i){e.removeEventListener?e.removeEventListener(t,n,i):e.deachEvent&&e.deachEvent("on".concat(t),n)}function Ro(e,t){const n=t.slice(0,t.length-1);for(let i=0;i<n.length;i++)n[i]=e[n[i].toLowerCase()];return n}function zo(e){typeof e!="string"&&(e=""),e=e.replace(/\s/g,"");const t=e.split(",");let n=t.lastIndexOf("");for(;n>=0;)t[n-1]+=",",t.splice(n,1),n=t.lastIndexOf("");return t}function Pr(e,t){const n=e.length>=t.length?e:t,i=e.length>=t.length?t:e;let o=!0;for(let s=0;s<n.length;s++)i.indexOf(n[s])===-1&&(o=!1);return o}const Ut={backspace:8,"⌫":8,tab:9,clear:12,enter:13,"↩":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"⇪":20,",":188,".":190,"/":191,"`":192,"-":Bn?173:189,"=":Bn?61:187,";":Bn?59:186,"'":222,"[":219,"]":221,"\\":220},Le={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,cmd:91,command:91},hi={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},be={16:!1,18:!1,17:!1,91:!1},he={};for(let e=1;e<20;e++)Ut["f".concat(e)]=111+e;let le=[],zt=null,Do="all";const He=new Map,Xt=e=>Ut[e.toLowerCase()]||Le[e.toLowerCase()]||e.toUpperCase().charCodeAt(0),Or=e=>Object.keys(Ut).find(t=>Ut[t]===e),jr=e=>Object.keys(Le).find(t=>Le[t]===e);function Bo(e){Do=e||"all"}function Gt(){return Do||"all"}function Ir(){return le.slice(0)}function Nr(){return le.map(e=>Or(e)||jr(e)||String.fromCharCode(e))}function Tr(){const e=[];return Object.keys(he).forEach(t=>{he[t].forEach(n=>{let{key:i,scope:o,mods:s,shortcut:r}=n;e.push({scope:o,shortcut:r,mods:s,keys:i.split("+").map(l=>Xt(l))})})}),e}function Lr(e){const t=e.target||e.srcElement,{tagName:n}=t;let i=!0;return(t.isContentEditable||(n==="INPUT"||n==="TEXTAREA"||n==="SELECT")&&!t.readOnly)&&(i=!1),i}function Mr(e){return typeof e=="string"&&(e=Xt(e)),le.indexOf(e)!==-1}function Hr(e,t){let n,i;e||(e=Gt());for(const o in he)if(Object.prototype.hasOwnProperty.call(he,o))for(n=he[o],i=0;i<n.length;)n[i].scope===e?n.splice(i,1).forEach(r=>{let{element:l}=r;return bi(l)}):i++;Gt()===e&&Bo(t||"all")}function Rr(e){let t=e.keyCode||e.which||e.charCode;const n=le.indexOf(t);if(n>=0&&le.splice(n,1),e.key&&e.key.toLowerCase()==="meta"&&le.splice(0,le.length),(t===93||t===224)&&(t=91),t in be){be[t]=!1;for(const i in Le)Le[i]===t&&(fe[i]=!1)}}function Fo(e){if(typeof e>"u")Object.keys(he).forEach(o=>{Array.isArray(he[o])&&he[o].forEach(s=>sn(s)),delete he[o]}),bi(null);else if(Array.isArray(e))e.forEach(o=>{o.key&&sn(o)});else if(typeof e=="object")e.key&&sn(e);else if(typeof e=="string"){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];let[o,s]=n;typeof o=="function"&&(s=o,o=""),sn({key:e,scope:o,method:s,splitKey:"+"})}}const sn=e=>{let{key:t,scope:n,method:i,splitKey:o="+"}=e;zo(t).forEach(r=>{const l=r.split(o),a=l.length,u=l[a-1],c=u==="*"?"*":Xt(u);if(!he[c])return;n||(n=Gt());const f=a>1?Ro(Le,l):[],h=[];he[c]=he[c].filter(d=>{const m=(i?d.method===i:!0)&&d.scope===n&&Pr(d.mods,f);return m&&h.push(d.element),!m}),h.forEach(d=>bi(d))})};function Ui(e,t,n,i){if(t.element!==i)return;let o;if(t.scope===n||t.scope==="all"){o=t.mods.length>0;for(const s in be)Object.prototype.hasOwnProperty.call(be,s)&&(!be[s]&&t.mods.indexOf(+s)>-1||be[s]&&t.mods.indexOf(+s)===-1)&&(o=!1);(t.mods.length===0&&!be[16]&&!be[18]&&!be[17]&&!be[91]||o||t.shortcut==="*")&&(t.keys=[],t.keys=t.keys.concat(le),t.method(e,t)===!1&&(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.cancelBubble&&(e.cancelBubble=!0)))}}function Gi(e,t){const n=he["*"];let i=e.keyCode||e.which||e.charCode;if(!fe.filter.call(this,e))return;if((i===93||i===224)&&(i=91),le.indexOf(i)===-1&&i!==229&&le.push(i),["ctrlKey","altKey","shiftKey","metaKey"].forEach(l=>{const a=hi[l];e[l]&&le.indexOf(a)===-1?le.push(a):!e[l]&&le.indexOf(a)>-1?le.splice(le.indexOf(a),1):l==="metaKey"&&e[l]&&le.length===3&&(e.ctrlKey||e.shiftKey||e.altKey||(le=le.slice(le.indexOf(a))))}),i in be){be[i]=!0;for(const l in Le)Le[l]===i&&(fe[l]=!0);if(!n)return}for(const l in be)Object.prototype.hasOwnProperty.call(be,l)&&(be[l]=e[hi[l]]);e.getModifierState&&!(e.altKey&&!e.ctrlKey)&&e.getModifierState("AltGraph")&&(le.indexOf(17)===-1&&le.push(17),le.indexOf(18)===-1&&le.push(18),be[17]=!0,be[18]=!0);const o=Gt();if(n)for(let l=0;l<n.length;l++)n[l].scope===o&&(e.type==="keydown"&&n[l].keydown||e.type==="keyup"&&n[l].keyup)&&Ui(e,n[l],o,t);if(!(i in he))return;const s=he[i],r=s.length;for(let l=0;l<r;l++)if((e.type==="keydown"&&s[l].keydown||e.type==="keyup"&&s[l].keyup)&&s[l].key){const a=s[l],{splitKey:u}=a,c=a.key.split(u),f=[];for(let h=0;h<c.length;h++)f.push(Xt(c[h]));f.sort().join("")===le.sort().join("")&&Ui(e,a,o,t)}}function fe(e,t,n){le=[];const i=zo(e);let o=[],s="all",r=document,l=0,a=!1,u=!0,c="+",f=!1,h=!1;for(n===void 0&&typeof t=="function"&&(n=t),Object.prototype.toString.call(t)==="[object Object]"&&(t.scope&&(s=t.scope),t.element&&(r=t.element),t.keyup&&(a=t.keyup),t.keydown!==void 0&&(u=t.keydown),t.capture!==void 0&&(f=t.capture),typeof t.splitKey=="string"&&(c=t.splitKey),t.single===!0&&(h=!0)),typeof t=="string"&&(s=t),h&&Fo(e,s);l<i.length;l++)e=i[l].split(c),o=[],e.length>1&&(o=Ro(Le,e)),e=e[e.length-1],e=e==="*"?"*":Xt(e),e in he||(he[e]=[]),he[e].push({keyup:a,keydown:u,scope:s,mods:o,shortcut:i[l],method:n,key:i[l],splitKey:c,element:r});if(typeof r<"u"&&window){if(!He.has(r)){const d=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;return Gi(m,r)},p=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;Gi(m,r),Rr(m)};He.set(r,{keydownListener:d,keyupListenr:p,capture:f}),Fn(r,"keydown",d,f),Fn(r,"keyup",p,f)}if(!zt){const d=()=>{le=[]};zt={listener:d,capture:f},Fn(window,"focus",d,f)}}}function zr(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"all";Object.keys(he).forEach(n=>{he[n].filter(o=>o.scope===t&&o.shortcut===e).forEach(o=>{o&&o.method&&o.method()})})}function bi(e){const t=Object.values(he).flat();if(t.findIndex(i=>{let{element:o}=i;return o===e})<0){const{keydownListener:i,keyupListenr:o,capture:s}=He.get(e)||{};i&&o&&(Pt(e,"keyup",o,s),Pt(e,"keydown",i,s),He.delete(e))}if((t.length<=0||He.size<=0)&&(Object.keys(He).forEach(o=>{const{keydownListener:s,keyupListenr:r,capture:l}=He.get(o)||{};s&&r&&(Pt(o,"keyup",r,l),Pt(o,"keydown",s,l),He.delete(o))}),He.clear(),Object.keys(he).forEach(o=>delete he[o]),zt)){const{listener:o,capture:s}=zt;Pt(window,"focus",o,s),zt=null}}const Un={getPressedKeyString:Nr,setScope:Bo,getScope:Gt,deleteScope:Hr,getPressedKeyCodes:Ir,getAllKeyCodes:Tr,isPressed:Mr,filter:Lr,trigger:zr,unbind:Fo,keyMap:Ut,modifier:Le,modifierMap:hi};for(const e in Un)Object.prototype.hasOwnProperty.call(Un,e)&&(fe[e]=Un[e]);if(typeof window<"u"){const e=window.hotkeys;fe.noConflict=t=>(t&&window.hotkeys===fe&&(window.hotkeys=e),fe),window.hotkeys=fe}const fn=window,ki=fn.ShadowRoot&&(fn.ShadyCSS===void 0||fn.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,xi=Symbol(),Ki=new WeakMap;let Uo=class{constructor(t,n,i){if(this._$cssResult$=!0,i!==xi)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t,this.t=n}get styleSheet(){let t=this.o;const n=this.t;if(ki&&t===void 0){const i=n!==void 0&&n.length===1;i&&(t=Ki.get(n)),t===void 0&&((this.o=t=new CSSStyleSheet).replaceSync(this.cssText),i&&Ki.set(n,t))}return t}toString(){return this.cssText}};const Dr=e=>new Uo(typeof e=="string"?e:e+"",void 0,xi),In=(e,...t)=>{const n=e.length===1?e[0]:t.reduce((i,o,s)=>i+(r=>{if(r._$cssResult$===!0)return r.cssText;if(typeof r=="number")return r;throw Error("Value passed to 'css' function must be a 'css' function result: "+r+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(o)+e[s+1],e[0]);return new Uo(n,e,xi)},Br=(e,t)=>{ki?e.adoptedStyleSheets=t.map(n=>n instanceof CSSStyleSheet?n:n.styleSheet):t.forEach(n=>{const i=document.createElement("style"),o=fn.litNonce;o!==void 0&&i.setAttribute("nonce",o),i.textContent=n.cssText,e.appendChild(i)})},Wi=ki?e=>e:e=>e instanceof CSSStyleSheet?(t=>{let n="";for(const i of t.cssRules)n+=i.cssText;return Dr(n)})(e):e;var Gn;const kn=window,Vi=kn.trustedTypes,Fr=Vi?Vi.emptyScript:"",Yi=kn.reactiveElementPolyfillSupport,mi={toAttribute(e,t){switch(t){case Boolean:e=e?Fr:null;break;case Object:case Array:e=e==null?e:JSON.stringify(e)}return e},fromAttribute(e,t){let n=e;switch(t){case Boolean:n=e!==null;break;case Number:n=e===null?null:Number(e);break;case Object:case Array:try{n=JSON.parse(e)}catch{n=null}}return n}},Go=(e,t)=>t!==e&&(t==t||e==e),Kn={attribute:!0,type:String,converter:mi,reflect:!1,hasChanged:Go},gi="finalized";let vt=class extends HTMLElement{constructor(){super(),this._$Ei=new Map,this.isUpdatePending=!1,this.hasUpdated=!1,this._$El=null,this._$Eu()}static addInitializer(t){var n;this.finalize(),((n=this.h)!==null&&n!==void 0?n:this.h=[]).push(t)}static get observedAttributes(){this.finalize();const t=[];return this.elementProperties.forEach((n,i)=>{const o=this._$Ep(i,n);o!==void 0&&(this._$Ev.set(o,i),t.push(o))}),t}static createProperty(t,n=Kn){if(n.state&&(n.attribute=!1),this.finalize(),this.elementProperties.set(t,n),!n.noAccessor&&!this.prototype.hasOwnProperty(t)){const i=typeof t=="symbol"?Symbol():"__"+t,o=this.getPropertyDescriptor(t,i,n);o!==void 0&&Object.defineProperty(this.prototype,t,o)}}static getPropertyDescriptor(t,n,i){return{get(){return this[n]},set(o){const s=this[t];this[n]=o,this.requestUpdate(t,s,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)||Kn}static finalize(){if(this.hasOwnProperty(gi))return!1;this[gi]=!0;const t=Object.getPrototypeOf(this);if(t.finalize(),t.h!==void 0&&(this.h=[...t.h]),this.elementProperties=new Map(t.elementProperties),this._$Ev=new Map,this.hasOwnProperty("properties")){const n=this.properties,i=[...Object.getOwnPropertyNames(n),...Object.getOwnPropertySymbols(n)];for(const o of i)this.createProperty(o,n[o])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(t){const n=[];if(Array.isArray(t)){const i=new Set(t.flat(1/0).reverse());for(const o of i)n.unshift(Wi(o))}else t!==void 0&&n.push(Wi(t));return n}static _$Ep(t,n){const i=n.attribute;return i===!1?void 0:typeof i=="string"?i:typeof t=="string"?t.toLowerCase():void 0}_$Eu(){var t;this._$E_=new Promise(n=>this.enableUpdating=n),this._$AL=new Map,this._$Eg(),this.requestUpdate(),(t=this.constructor.h)===null||t===void 0||t.forEach(n=>n(this))}addController(t){var n,i;((n=this._$ES)!==null&&n!==void 0?n:this._$ES=[]).push(t),this.renderRoot!==void 0&&this.isConnected&&((i=t.hostConnected)===null||i===void 0||i.call(t))}removeController(t){var n;(n=this._$ES)===null||n===void 0||n.splice(this._$ES.indexOf(t)>>>0,1)}_$Eg(){this.constructor.elementProperties.forEach((t,n)=>{this.hasOwnProperty(n)&&(this._$Ei.set(n,this[n]),delete this[n])})}createRenderRoot(){var t;const n=(t=this.shadowRoot)!==null&&t!==void 0?t:this.attachShadow(this.constructor.shadowRootOptions);return Br(n,this.constructor.elementStyles),n}connectedCallback(){var t;this.renderRoot===void 0&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(t=this._$ES)===null||t===void 0||t.forEach(n=>{var i;return(i=n.hostConnected)===null||i===void 0?void 0:i.call(n)})}enableUpdating(t){}disconnectedCallback(){var t;(t=this._$ES)===null||t===void 0||t.forEach(n=>{var i;return(i=n.hostDisconnected)===null||i===void 0?void 0:i.call(n)})}attributeChangedCallback(t,n,i){this._$AK(t,i)}_$EO(t,n,i=Kn){var o;const s=this.constructor._$Ep(t,i);if(s!==void 0&&i.reflect===!0){const r=(((o=i.converter)===null||o===void 0?void 0:o.toAttribute)!==void 0?i.converter:mi).toAttribute(n,i.type);this._$El=t,r==null?this.removeAttribute(s):this.setAttribute(s,r),this._$El=null}}_$AK(t,n){var i;const o=this.constructor,s=o._$Ev.get(t);if(s!==void 0&&this._$El!==s){const r=o.getPropertyOptions(s),l=typeof r.converter=="function"?{fromAttribute:r.converter}:((i=r.converter)===null||i===void 0?void 0:i.fromAttribute)!==void 0?r.converter:mi;this._$El=s,this[s]=l.fromAttribute(n,r.type),this._$El=null}}requestUpdate(t,n,i){let o=!0;t!==void 0&&(((i=i||this.constructor.getPropertyOptions(t)).hasChanged||Go)(this[t],n)?(this._$AL.has(t)||this._$AL.set(t,n),i.reflect===!0&&this._$El!==t&&(this._$EC===void 0&&(this._$EC=new Map),this._$EC.set(t,i))):o=!1),!this.isUpdatePending&&o&&(this._$E_=this._$Ej())}async _$Ej(){this.isUpdatePending=!0;try{await this._$E_}catch(n){Promise.reject(n)}const t=this.scheduleUpdate();return t!=null&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var t;if(!this.isUpdatePending)return;this.hasUpdated,this._$Ei&&(this._$Ei.forEach((o,s)=>this[s]=o),this._$Ei=void 0);let n=!1;const i=this._$AL;try{n=this.shouldUpdate(i),n?(this.willUpdate(i),(t=this._$ES)===null||t===void 0||t.forEach(o=>{var s;return(s=o.hostUpdate)===null||s===void 0?void 0:s.call(o)}),this.update(i)):this._$Ek()}catch(o){throw n=!1,this._$Ek(),o}n&&this._$AE(i)}willUpdate(t){}_$AE(t){var n;(n=this._$ES)===null||n===void 0||n.forEach(i=>{var o;return(o=i.hostUpdated)===null||o===void 0?void 0:o.call(i)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$Ek(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$E_}shouldUpdate(t){return!0}update(t){this._$EC!==void 0&&(this._$EC.forEach((n,i)=>this._$EO(i,this[i],n)),this._$EC=void 0),this._$Ek()}updated(t){}firstUpdated(t){}};vt[gi]=!0,vt.elementProperties=new Map,vt.elementStyles=[],vt.shadowRootOptions={mode:"open"},Yi==null||Yi({ReactiveElement:vt}),((Gn=kn.reactiveElementVersions)!==null&&Gn!==void 0?Gn:kn.reactiveElementVersions=[]).push("1.6.3");var Wn;const xn=window,xt=xn.trustedTypes,Ji=xt?xt.createPolicy("lit-html",{createHTML:e=>e}):void 0,Sn="$lit$",ze=`lit$${(Math.random()+"").slice(9)}$`,Si="?"+ze,Ur=`<${Si}>`,lt=document,Kt=()=>lt.createComment(""),Wt=e=>e===null||typeof e!="object"&&typeof e!="function",Ko=Array.isArray,Wo=e=>Ko(e)||typeof(e==null?void 0:e[Symbol.iterator])=="function",Vn=`[ 	
\f\r]`,Ot=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,Xi=/-->/g,qi=/>/g,Qe=RegExp(`>|${Vn}(?:([^\\s"'>=/]+)(${Vn}*=${Vn}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),Zi=/'/g,Qi=/"/g,Vo=/^(?:script|style|textarea|title)$/i,Gr=e=>(t,...n)=>({_$litType$:e,strings:t,values:n}),ke=Gr(1),Pe=Symbol.for("lit-noChange"),pe=Symbol.for("lit-nothing"),eo=new WeakMap,ot=lt.createTreeWalker(lt,129,null,!1);function Yo(e,t){if(!Array.isArray(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return Ji!==void 0?Ji.createHTML(t):t}const Jo=(e,t)=>{const n=e.length-1,i=[];let o,s=t===2?"<svg>":"",r=Ot;for(let l=0;l<n;l++){const a=e[l];let u,c,f=-1,h=0;for(;h<a.length&&(r.lastIndex=h,c=r.exec(a),c!==null);)h=r.lastIndex,r===Ot?c[1]==="!--"?r=Xi:c[1]!==void 0?r=qi:c[2]!==void 0?(Vo.test(c[2])&&(o=RegExp("</"+c[2],"g")),r=Qe):c[3]!==void 0&&(r=Qe):r===Qe?c[0]===">"?(r=o??Ot,f=-1):c[1]===void 0?f=-2:(f=r.lastIndex-c[2].length,u=c[1],r=c[3]===void 0?Qe:c[3]==='"'?Qi:Zi):r===Qi||r===Zi?r=Qe:r===Xi||r===qi?r=Ot:(r=Qe,o=void 0);const d=r===Qe&&e[l+1].startsWith("/>")?" ":"";s+=r===Ot?a+Ur:f>=0?(i.push(u),a.slice(0,f)+Sn+a.slice(f)+ze+d):a+ze+(f===-2?(i.push(void 0),l):d)}return[Yo(e,s+(e[n]||"<?>")+(t===2?"</svg>":"")),i]};class Vt{constructor({strings:t,_$litType$:n},i){let o;this.parts=[];let s=0,r=0;const l=t.length-1,a=this.parts,[u,c]=Jo(t,n);if(this.el=Vt.createElement(u,i),ot.currentNode=this.el.content,n===2){const f=this.el.content,h=f.firstChild;h.remove(),f.append(...h.childNodes)}for(;(o=ot.nextNode())!==null&&a.length<l;){if(o.nodeType===1){if(o.hasAttributes()){const f=[];for(const h of o.getAttributeNames())if(h.endsWith(Sn)||h.startsWith(ze)){const d=c[r++];if(f.push(h),d!==void 0){const p=o.getAttribute(d.toLowerCase()+Sn).split(ze),m=/([.?@])?(.*)/.exec(d);a.push({type:1,index:s,name:m[2],strings:p,ctor:m[1]==="."?qo:m[1]==="?"?Zo:m[1]==="@"?Qo:qt})}else a.push({type:6,index:s})}for(const h of f)o.removeAttribute(h)}if(Vo.test(o.tagName)){const f=o.textContent.split(ze),h=f.length-1;if(h>0){o.textContent=xt?xt.emptyScript:"";for(let d=0;d<h;d++)o.append(f[d],Kt()),ot.nextNode(),a.push({type:2,index:++s});o.append(f[h],Kt())}}}else if(o.nodeType===8)if(o.data===Si)a.push({type:2,index:s});else{let f=-1;for(;(f=o.data.indexOf(ze,f+1))!==-1;)a.push({type:7,index:s}),f+=ze.length-1}s++}}static createElement(t,n){const i=lt.createElement("template");return i.innerHTML=t,i}}function at(e,t,n=e,i){var o,s,r,l;if(t===Pe)return t;let a=i!==void 0?(o=n._$Co)===null||o===void 0?void 0:o[i]:n._$Cl;const u=Wt(t)?void 0:t._$litDirective$;return(a==null?void 0:a.constructor)!==u&&((s=a==null?void 0:a._$AO)===null||s===void 0||s.call(a,!1),u===void 0?a=void 0:(a=new u(e),a._$AT(e,n,i)),i!==void 0?((r=(l=n)._$Co)!==null&&r!==void 0?r:l._$Co=[])[i]=a:n._$Cl=a),a!==void 0&&(t=at(e,a._$AS(e,t.values),a,i)),t}class Xo{constructor(t,n){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=n}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){var n;const{el:{content:i},parts:o}=this._$AD,s=((n=t==null?void 0:t.creationScope)!==null&&n!==void 0?n:lt).importNode(i,!0);ot.currentNode=s;let r=ot.nextNode(),l=0,a=0,u=o[0];for(;u!==void 0;){if(l===u.index){let c;u.type===2?c=new Et(r,r.nextSibling,this,t):u.type===1?c=new u.ctor(r,u.name,u.strings,this,t):u.type===6&&(c=new es(r,this,t)),this._$AV.push(c),u=o[++a]}l!==(u==null?void 0:u.index)&&(r=ot.nextNode(),l++)}return ot.currentNode=lt,s}v(t){let n=0;for(const i of this._$AV)i!==void 0&&(i.strings!==void 0?(i._$AI(t,i,n),n+=i.strings.length-2):i._$AI(t[n])),n++}}class Et{constructor(t,n,i,o){var s;this.type=2,this._$AH=pe,this._$AN=void 0,this._$AA=t,this._$AB=n,this._$AM=i,this.options=o,this._$Cp=(s=o==null?void 0:o.isConnected)===null||s===void 0||s}get _$AU(){var t,n;return(n=(t=this._$AM)===null||t===void 0?void 0:t._$AU)!==null&&n!==void 0?n:this._$Cp}get parentNode(){let t=this._$AA.parentNode;const n=this._$AM;return n!==void 0&&(t==null?void 0:t.nodeType)===11&&(t=n.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,n=this){t=at(this,t,n),Wt(t)?t===pe||t==null||t===""?(this._$AH!==pe&&this._$AR(),this._$AH=pe):t!==this._$AH&&t!==Pe&&this._(t):t._$litType$!==void 0?this.g(t):t.nodeType!==void 0?this.$(t):Wo(t)?this.T(t):this._(t)}k(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}$(t){this._$AH!==t&&(this._$AR(),this._$AH=this.k(t))}_(t){this._$AH!==pe&&Wt(this._$AH)?this._$AA.nextSibling.data=t:this.$(lt.createTextNode(t)),this._$AH=t}g(t){var n;const{values:i,_$litType$:o}=t,s=typeof o=="number"?this._$AC(t):(o.el===void 0&&(o.el=Vt.createElement(Yo(o.h,o.h[0]),this.options)),o);if(((n=this._$AH)===null||n===void 0?void 0:n._$AD)===s)this._$AH.v(i);else{const r=new Xo(s,this),l=r.u(this.options);r.v(i),this.$(l),this._$AH=r}}_$AC(t){let n=eo.get(t.strings);return n===void 0&&eo.set(t.strings,n=new Vt(t)),n}T(t){Ko(this._$AH)||(this._$AH=[],this._$AR());const n=this._$AH;let i,o=0;for(const s of t)o===n.length?n.push(i=new Et(this.k(Kt()),this.k(Kt()),this,this.options)):i=n[o],i._$AI(s),o++;o<n.length&&(this._$AR(i&&i._$AB.nextSibling,o),n.length=o)}_$AR(t=this._$AA.nextSibling,n){var i;for((i=this._$AP)===null||i===void 0||i.call(this,!1,!0,n);t&&t!==this._$AB;){const o=t.nextSibling;t.remove(),t=o}}setConnected(t){var n;this._$AM===void 0&&(this._$Cp=t,(n=this._$AP)===null||n===void 0||n.call(this,t))}}class qt{constructor(t,n,i,o,s){this.type=1,this._$AH=pe,this._$AN=void 0,this.element=t,this.name=n,this._$AM=o,this.options=s,i.length>2||i[0]!==""||i[1]!==""?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=pe}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(t,n=this,i,o){const s=this.strings;let r=!1;if(s===void 0)t=at(this,t,n,0),r=!Wt(t)||t!==this._$AH&&t!==Pe,r&&(this._$AH=t);else{const l=t;let a,u;for(t=s[0],a=0;a<s.length-1;a++)u=at(this,l[i+a],n,a),u===Pe&&(u=this._$AH[a]),r||(r=!Wt(u)||u!==this._$AH[a]),u===pe?t=pe:t!==pe&&(t+=(u??"")+s[a+1]),this._$AH[a]=u}r&&!o&&this.j(t)}j(t){t===pe?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??"")}}class qo extends qt{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===pe?void 0:t}}const Kr=xt?xt.emptyScript:"";class Zo extends qt{constructor(){super(...arguments),this.type=4}j(t){t&&t!==pe?this.element.setAttribute(this.name,Kr):this.element.removeAttribute(this.name)}}class Qo extends qt{constructor(t,n,i,o,s){super(t,n,i,o,s),this.type=5}_$AI(t,n=this){var i;if((t=(i=at(this,t,n,0))!==null&&i!==void 0?i:pe)===Pe)return;const o=this._$AH,s=t===pe&&o!==pe||t.capture!==o.capture||t.once!==o.once||t.passive!==o.passive,r=t!==pe&&(o===pe||s);s&&this.element.removeEventListener(this.name,this,o),r&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){var n,i;typeof this._$AH=="function"?this._$AH.call((i=(n=this.options)===null||n===void 0?void 0:n.host)!==null&&i!==void 0?i:this.element,t):this._$AH.handleEvent(t)}}class es{constructor(t,n,i){this.element=t,this.type=6,this._$AN=void 0,this._$AM=n,this.options=i}get _$AU(){return this._$AM._$AU}_$AI(t){at(this,t)}}const Wr={O:Sn,P:ze,A:Si,C:1,M:Jo,L:Xo,R:Wo,D:at,I:Et,V:qt,H:Zo,N:Qo,U:qo,F:es},to=xn.litHtmlPolyfillSupport;to==null||to(Vt,Et),((Wn=xn.litHtmlVersions)!==null&&Wn!==void 0?Wn:xn.litHtmlVersions=[]).push("2.8.0");const Vr=(e,t,n)=>{var i,o;const s=(i=n==null?void 0:n.renderBefore)!==null&&i!==void 0?i:t;let r=s._$litPart$;if(r===void 0){const l=(o=n==null?void 0:n.renderBefore)!==null&&o!==void 0?o:null;s._$litPart$=r=new Et(t.insertBefore(Kt(),l),l,void 0,n??{})}return r._$AI(e),r};var Yn,Jn;let Je=class extends vt{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var t,n;const i=super.createRenderRoot();return(t=(n=this.renderOptions).renderBefore)!==null&&t!==void 0||(n.renderBefore=i.firstChild),i}update(t){const n=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this._$Do=Vr(n,this.renderRoot,this.renderOptions)}connectedCallback(){var t;super.connectedCallback(),(t=this._$Do)===null||t===void 0||t.setConnected(!0)}disconnectedCallback(){var t;super.disconnectedCallback(),(t=this._$Do)===null||t===void 0||t.setConnected(!1)}render(){return Pe}};Je.finalized=!0,Je._$litElement$=!0,(Yn=globalThis.litElementHydrateSupport)===null||Yn===void 0||Yn.call(globalThis,{LitElement:Je});const no=globalThis.litElementPolyfillSupport;no==null||no({LitElement:Je});((Jn=globalThis.litElementVersions)!==null&&Jn!==void 0?Jn:globalThis.litElementVersions=[]).push("3.3.3");const Nn=e=>t=>typeof t=="function"?((n,i)=>(customElements.define(n,i),i))(e,t):((n,i)=>{const{kind:o,elements:s}=i;return{kind:o,elements:s,finisher(r){customElements.define(n,r)}}})(e,t);const Yr=(e,t)=>t.kind==="method"&&t.descriptor&&!("value"in t.descriptor)?{...t,finisher(n){n.createProperty(t.key,e)}}:{kind:"field",key:Symbol(),placement:"own",descriptor:{},originalKey:t.key,initializer(){typeof t.initializer=="function"&&(this[t.key]=t.initializer.call(this))},finisher(n){n.createProperty(t.key,e)}},Jr=(e,t,n)=>{t.constructor.createProperty(n,e)};function _e(e){return(t,n)=>n!==void 0?Jr(e,t,n):Yr(e,t)}function Ze(e){return _e({...e,state:!0})}var Xn;((Xn=window.HTMLSlotElement)===null||Xn===void 0?void 0:Xn.prototype.assignedElements)!=null;const Te={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4,EVENT:5,ELEMENT:6},Zt=e=>(...t)=>({_$litDirective$:e,values:t});class Qt{constructor(t){}get _$AU(){return this._$AM._$AU}_$AT(t,n,i){this._$Ct=t,this._$AM=n,this._$Ci=i}_$AS(t,n){return this.update(t,n)}update(t,n){return this.render(...n)}}const{I:Xr}=Wr,ts=e=>e.strings===void 0,io=()=>document.createComment(""),jt=(e,t,n)=>{var i;const o=e._$AA.parentNode,s=t===void 0?e._$AB:t._$AA;if(n===void 0){const r=o.insertBefore(io(),s),l=o.insertBefore(io(),s);n=new Xr(r,l,e,e.options)}else{const r=n._$AB.nextSibling,l=n._$AM,a=l!==e;if(a){let u;(i=n._$AQ)===null||i===void 0||i.call(n,e),n._$AM=e,n._$AP!==void 0&&(u=e._$AU)!==l._$AU&&n._$AP(u)}if(r!==s||a){let u=n._$AA;for(;u!==r;){const c=u.nextSibling;o.insertBefore(u,s),u=c}}}return n},et=(e,t,n=e)=>(e._$AI(t,n),e),qr={},ns=(e,t=qr)=>e._$AH=t,Zr=e=>e._$AH,qn=e=>{var t;(t=e._$AP)===null||t===void 0||t.call(e,!1,!0);let n=e._$AA;const i=e._$AB.nextSibling;for(;n!==i;){const o=n.nextSibling;n.remove(),n=o}};const oo=(e,t,n)=>{const i=new Map;for(let o=t;o<=n;o++)i.set(e[o],o);return i},Qr=Zt(class extends Qt{constructor(e){if(super(e),e.type!==Te.CHILD)throw Error("repeat() can only be used in text expressions")}ct(e,t,n){let i;n===void 0?n=t:t!==void 0&&(i=t);const o=[],s=[];let r=0;for(const l of e)o[r]=i?i(l,r):r,s[r]=n(l,r),r++;return{values:s,keys:o}}render(e,t,n){return this.ct(e,t,n).values}update(e,[t,n,i]){var o;const s=Zr(e),{values:r,keys:l}=this.ct(t,n,i);if(!Array.isArray(s))return this.ut=l,r;const a=(o=this.ut)!==null&&o!==void 0?o:this.ut=[],u=[];let c,f,h=0,d=s.length-1,p=0,m=r.length-1;for(;h<=d&&p<=m;)if(s[h]===null)h++;else if(s[d]===null)d--;else if(a[h]===l[p])u[p]=et(s[h],r[p]),h++,p++;else if(a[d]===l[m])u[m]=et(s[d],r[m]),d--,m--;else if(a[h]===l[m])u[m]=et(s[h],r[m]),jt(e,u[m+1],s[h]),h++,m--;else if(a[d]===l[p])u[p]=et(s[d],r[p]),jt(e,s[h],s[d]),d--,p++;else if(c===void 0&&(c=oo(l,p,m),f=oo(a,h,d)),c.has(a[h]))if(c.has(a[d])){const _=f.get(l[p]),w=_!==void 0?s[_]:null;if(w===null){const $=jt(e,s[h]);et($,r[p]),u[p]=$}else u[p]=et(w,r[p]),jt(e,s[h],w),s[_]=null;p++}else qn(s[d]),d--;else qn(s[h]),h++;for(;p<=m;){const _=jt(e,u[m+1]);et(_,r[p]),u[p++]=_}for(;h<=d;){const _=s[h++];_!==null&&qn(_)}return this.ut=l,ns(e,u),Pe}});const el=Zt(class extends Qt{constructor(e){if(super(e),e.type!==Te.PROPERTY&&e.type!==Te.ATTRIBUTE&&e.type!==Te.BOOLEAN_ATTRIBUTE)throw Error("The `live` directive is not allowed on child or event bindings");if(!ts(e))throw Error("`live` bindings can only contain a single expression")}render(e){return e}update(e,[t]){if(t===Pe||t===pe)return t;const n=e.element,i=e.name;if(e.type===Te.PROPERTY){if(t===n[i])return Pe}else if(e.type===Te.BOOLEAN_ATTRIBUTE){if(!!t===n.hasAttribute(i))return Pe}else if(e.type===Te.ATTRIBUTE&&n.getAttribute(i)===t+"")return Pe;return ns(e),t}});const Dt=(e,t)=>{var n,i;const o=e._$AN;if(o===void 0)return!1;for(const s of o)(i=(n=s)._$AO)===null||i===void 0||i.call(n,t,!1),Dt(s,t);return!0},An=e=>{let t,n;do{if((t=e._$AM)===void 0)break;n=t._$AN,n.delete(e),e=t}while((n==null?void 0:n.size)===0)},is=e=>{for(let t;t=e._$AM;e=t){let n=t._$AN;if(n===void 0)t._$AN=n=new Set;else if(n.has(e))break;n.add(e),il(t)}};function tl(e){this._$AN!==void 0?(An(this),this._$AM=e,is(this)):this._$AM=e}function nl(e,t=!1,n=0){const i=this._$AH,o=this._$AN;if(o!==void 0&&o.size!==0)if(t)if(Array.isArray(i))for(let s=n;s<i.length;s++)Dt(i[s],!1),An(i[s]);else i!=null&&(Dt(i,!1),An(i));else Dt(this,e)}const il=e=>{var t,n,i,o;e.type==Te.CHILD&&((t=(i=e)._$AP)!==null&&t!==void 0||(i._$AP=nl),(n=(o=e)._$AQ)!==null&&n!==void 0||(o._$AQ=tl))};class ol extends Qt{constructor(){super(...arguments),this._$AN=void 0}_$AT(t,n,i){super._$AT(t,n,i),is(this),this.isConnected=t._$AU}_$AO(t,n=!0){var i,o;t!==this.isConnected&&(this.isConnected=t,t?(i=this.reconnected)===null||i===void 0||i.call(this):(o=this.disconnected)===null||o===void 0||o.call(this)),n&&(Dt(this,t),An(this))}setValue(t){if(ts(this._$Ct))this._$Ct._$AI(t,this);else{const n=[...this._$Ct._$AH];n[this._$Ci]=t,this._$Ct._$AI(n,this,0)}}disconnected(){}reconnected(){}}const os=()=>new sl;let sl=class{};const Zn=new WeakMap,ss=Zt(class extends ol{render(e){return pe}update(e,[t]){var n;const i=t!==this.G;return i&&this.G!==void 0&&this.ot(void 0),(i||this.rt!==this.lt)&&(this.G=t,this.dt=(n=e.options)===null||n===void 0?void 0:n.host,this.ot(this.lt=e.element)),pe}ot(e){var t;if(typeof this.G=="function"){const n=(t=this.dt)!==null&&t!==void 0?t:globalThis;let i=Zn.get(n);i===void 0&&(i=new WeakMap,Zn.set(n,i)),i.get(this.G)!==void 0&&this.G.call(this.dt,void 0),i.set(this.G,e),e!==void 0&&this.G.call(this.dt,e)}else this.G.value=e}get rt(){var e,t,n;return typeof this.G=="function"?(t=Zn.get((e=this.dt)!==null&&e!==void 0?e:globalThis))===null||t===void 0?void 0:t.get(this.G):(n=this.G)===null||n===void 0?void 0:n.value}disconnected(){this.rt===this.lt&&this.ot(void 0)}reconnected(){this.ot(this.lt)}});const vi=Zt(class extends Qt{constructor(e){var t;if(super(e),e.type!==Te.ATTRIBUTE||e.name!=="class"||((t=e.strings)===null||t===void 0?void 0:t.length)>2)throw Error("`classMap()` can only be used in the `class` attribute and must be the only part in the attribute.")}render(e){return" "+Object.keys(e).filter(t=>e[t]).join(" ")+" "}update(e,[t]){var n,i;if(this.it===void 0){this.it=new Set,e.strings!==void 0&&(this.nt=new Set(e.strings.join(" ").split(/\s/).filter(s=>s!=="")));for(const s in t)t[s]&&!(!((n=this.nt)===null||n===void 0)&&n.has(s))&&this.it.add(s);return this.render(t)}const o=e.element.classList;this.it.forEach(s=>{s in t||(o.remove(s),this.it.delete(s))});for(const s in t){const r=!!t[s];r===this.it.has(s)||!((i=this.nt)===null||i===void 0)&&i.has(s)||(r?(o.add(s),this.it.add(s)):(o.remove(s),this.it.delete(s)))}return Pe}});var en=function(e,t,n,i){var o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,n):i,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,t,n,i);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(s=(o<3?r(s):o>3?r(t,n,s):r(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s};let ct=class extends Je{constructor(){super(...arguments),this.placeholder="",this.hideBreadcrumbs=!1,this.breadcrumbHome="Home",this.breadcrumbs=[],this._inputRef=os()}render(){let t="";if(!this.hideBreadcrumbs){const n=[];for(const i of this.breadcrumbs)n.push(ke`<button tabindex="-1" @click="${()=>this.selectParent(i)}" class="breadcrumb">${i}</button>`);t=ke`<div class="breadcrumb-list"><button tabindex="-1" @click="${()=>this.selectParent()}" class="breadcrumb">${this.breadcrumbHome}</button> ${n}</div>`}return ke`${t}<div part="ninja-input-wrapper" class="search-wrapper"><input part="ninja-input" type="text" id="search" spellcheck="false" autocomplete="off" @input="${this._handleInput}" ${ss(this._inputRef)} placeholder="${this.placeholder}" class="search"></div>`}setSearch(t){this._inputRef.value&&(this._inputRef.value.value=t)}focusSearch(){requestAnimationFrame(()=>this._inputRef.value.focus())}_handleInput(t){const n=t.target;this.dispatchEvent(new CustomEvent("change",{detail:{search:n.value},bubbles:!1,composed:!1}))}selectParent(t){this.dispatchEvent(new CustomEvent("setParent",{detail:{parent:t},bubbles:!0,composed:!0}))}firstUpdated(){this.focusSearch()}_close(){this.dispatchEvent(new CustomEvent("close",{bubbles:!0,composed:!0}))}};ct.styles=In`:host{flex:1;position:relative}.search{padding:1.25em;flex-grow:1;flex-shrink:0;margin:0;border:none;appearance:none;font-size:1.125em;background:0 0;caret-color:var(--ninja-accent-color);color:var(--ninja-text-color);outline:0;font-family:var(--ninja-font-family)}.search::placeholder{color:var(--ninja-placeholder-color)}.breadcrumb-list{padding:1em 4em 0 1em;display:flex;flex-direction:row;align-items:stretch;justify-content:flex-start;flex:initial}.breadcrumb{background:var(--ninja-secondary-background-color);text-align:center;line-height:1.2em;border-radius:var(--ninja-key-border-radius);border:0;cursor:pointer;padding:.1em .5em;color:var(--ninja-secondary-text-color);margin-right:.5em;outline:0;font-family:var(--ninja-font-family)}.search-wrapper{display:flex;border-bottom:var(--ninja-separate-border)}`;en([_e()],ct.prototype,"placeholder",void 0);en([_e({type:Boolean})],ct.prototype,"hideBreadcrumbs",void 0);en([_e()],ct.prototype,"breadcrumbHome",void 0);en([_e({type:Array})],ct.prototype,"breadcrumbs",void 0);ct=en([Nn("ninja-header")],ct);class yi extends Qt{constructor(t){if(super(t),this.et=pe,t.type!==Te.CHILD)throw Error(this.constructor.directiveName+"() can only be used in child bindings")}render(t){if(t===pe||t==null)return this.ft=void 0,this.et=t;if(t===Pe)return t;if(typeof t!="string")throw Error(this.constructor.directiveName+"() called with a non-string value");if(t===this.et)return this.ft;this.et=t;const n=[t];return n.raw=n,this.ft={_$litType$:this.constructor.resultType,strings:n,values:[]}}}yi.directiveName="unsafeHTML",yi.resultType=1;const rl=Zt(yi);function*ll(e,t){const n=typeof t=="function";if(e!==void 0){let i=-1;for(const o of e)i>-1&&(yield n?t(i):t),i++,yield o}}function al(e,t,n,i){var o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,n):i,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,t,n,i);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(s=(o<3?r(s):o>3?r(t,n,s):r(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s}const cl=In`:host{font-family:var(--mdc-icon-font, "Material Icons");font-weight:400;font-style:normal;font-size:var(--mdc-icon-size,24px);line-height:1;letter-spacing:normal;text-transform:none;display:inline-block;white-space:nowrap;word-wrap:normal;direction:ltr;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;-moz-osx-font-smoothing:grayscale;font-feature-settings:"liga"}`;let _i=class extends Je{render(){return ke`<span><slot></slot></span>`}};_i.styles=[cl];_i=al([Nn("mwc-icon")],_i);var Tn=function(e,t,n,i){var o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,n):i,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,t,n,i);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(s=(o<3?r(s):o>3?r(t,n,s):r(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s};let St=class extends Je{constructor(){super(),this.selected=!1,this.hotKeysJoinedView=!0,this.addEventListener("click",this.click)}ensureInView(){requestAnimationFrame(()=>this.scrollIntoView({block:"nearest"}))}click(){this.dispatchEvent(new CustomEvent("actionsSelected",{detail:this.action,bubbles:!0,composed:!0}))}updated(t){t.has("selected")&&this.selected&&this.ensureInView()}render(){let t;this.action.mdIcon?t=ke`<mwc-icon part="ninja-icon" class="ninja-icon">${this.action.mdIcon}</mwc-icon>`:this.action.icon&&(t=rl(this.action.icon||""));let n;this.action.hotkey&&(this.hotKeysJoinedView?n=this.action.hotkey.split(",").map(o=>{const s=o.split("+"),r=ke`${ll(s.map(l=>ke`<kbd>${l}</kbd>`),"+")}`;return ke`<div class="ninja-hotkey ninja-hotkeys">${r}</div>`}):n=this.action.hotkey.split(",").map(o=>{const r=o.split("+").map(l=>ke`<kbd class="ninja-hotkey">${l}</kbd>`);return ke`<kbd class="ninja-hotkeys">${r}</kbd>`}));const i={selected:this.selected,"ninja-action":!0};return ke`<div class="ninja-action" part="ninja-action ${this.selected?"ninja-selected":""}" class="${vi(i)}">${t}<div class="ninja-title">${this.action.title}</div>${n}</div>`}};St.styles=In`:host{display:flex;width:100%}.ninja-action{padding:.75em 1em;display:flex;border-left:2px solid transparent;align-items:center;justify-content:start;outline:0;transition:color 0s ease 0s;width:100%}.ninja-action.selected{cursor:pointer;color:var(--ninja-selected-text-color);background-color:var(--ninja-selected-background);border-left:2px solid var(--ninja-accent-color);outline:0}.ninja-action.selected .ninja-icon{color:var(--ninja-selected-text-color)}.ninja-icon{font-size:var(--ninja-icon-size);max-width:var(--ninja-icon-size);max-height:var(--ninja-icon-size);margin-right:1em;color:var(--ninja-icon-color);margin-right:1em;position:relative}.ninja-title{flex-shrink:.01;margin-right:.5em;flex-grow:1;font-size:.8125em;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.ninja-hotkeys{flex-shrink:0;width:min-content;display:flex}.ninja-hotkeys kbd{font-family:inherit}.ninja-hotkey{background:var(--ninja-secondary-background-color);padding:.06em .25em;border-radius:var(--ninja-key-border-radius);text-transform:capitalize;color:var(--ninja-secondary-text-color);font-size:.75em;font-family:inherit}.ninja-hotkey+.ninja-hotkey{margin-left:.5em}.ninja-hotkeys+.ninja-hotkeys{margin-left:1em}`;Tn([_e({type:Object})],St.prototype,"action",void 0);Tn([_e({type:Boolean})],St.prototype,"selected",void 0);Tn([_e({type:Boolean})],St.prototype,"hotKeysJoinedView",void 0);St=Tn([Nn("ninja-action")],St);const ul=ke`<div class="modal-footer" slot="footer"><span class="help"><svg version="1.0" class="ninja-examplekey" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1280 1280"><path d="M1013 376c0 73.4-.4 113.3-1.1 120.2a159.9 159.9 0 0 1-90.2 127.3c-20 9.6-36.7 14-59.2 15.5-7.1.5-121.9.9-255 1h-242l95.5-95.5 95.5-95.5-38.3-38.2-38.2-38.3-160 160c-88 88-160 160.4-160 161 0 .6 72 73 160 161l160 160 38.2-38.3 38.3-38.2-95.5-95.5-95.5-95.5h251.1c252.9 0 259.8-.1 281.4-3.6 72.1-11.8 136.9-54.1 178.5-116.4 8.6-12.9 22.6-40.5 28-55.4 4.4-12 10.7-36.1 13.1-50.6 1.6-9.6 1.8-21 2.1-132.8l.4-122.2H1013v110z"/></svg> to select </span><span class="help"><svg xmlns="http://www.w3.org/2000/svg" class="ninja-examplekey" viewBox="0 0 24 24"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M20 12l-1.41-1.41L13 16.17V4h-2v12.17l-5.58-5.59L4 12l8 8 8-8z"/></svg> <svg xmlns="http://www.w3.org/2000/svg" class="ninja-examplekey" viewBox="0 0 24 24"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M4 12l1.41 1.41L11 7.83V20h2V7.83l5.58 5.59L20 12l-8-8-8 8z"/></svg> to navigate </span><span class="help"><span class="ninja-examplekey esc">esc</span> to close </span><span class="help"><svg xmlns="http://www.w3.org/2000/svg" class="ninja-examplekey backspace" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M6.707 4.879A3 3 0 018.828 4H15a3 3 0 013 3v6a3 3 0 01-3 3H8.828a3 3 0 01-2.12-.879l-4.415-4.414a1 1 0 010-1.414l4.414-4.414zm4 2.414a1 1 0 00-1.414 1.414L10.586 10l-1.293 1.293a1 1 0 101.414 1.414L12 11.414l1.293 1.293a1 1 0 001.414-1.414L13.414 10l1.293-1.293a1 1 0 00-1.414-1.414L12 8.586l-1.293-1.293z" clip-rule="evenodd"/></svg> move to parent</span></div>`,dl=In`:host{--ninja-width:640px;--ninja-backdrop-filter:none;--ninja-overflow-background:rgba(255, 255, 255, 0.5);--ninja-text-color:rgb(60, 65, 73);--ninja-font-size:16px;--ninja-top:20%;--ninja-key-border-radius:0.25em;--ninja-accent-color:rgb(110, 94, 210);--ninja-secondary-background-color:rgb(239, 241, 244);--ninja-secondary-text-color:rgb(107, 111, 118);--ninja-selected-background:rgb(248, 249, 251);--ninja-icon-color:var(--ninja-secondary-text-color);--ninja-icon-size:1.2em;--ninja-separate-border:1px solid var(--ninja-secondary-background-color);--ninja-modal-background:#fff;--ninja-modal-shadow:rgb(0 0 0 / 50%) 0px 16px 70px;--ninja-actions-height:300px;--ninja-group-text-color:rgb(144, 149, 157);--ninja-footer-background:rgba(242, 242, 242, 0.4);--ninja-placeholder-color:#8e8e8e;font-size:var(--ninja-font-size);--ninja-z-index:1}:host(.dark){--ninja-backdrop-filter:none;--ninja-overflow-background:rgba(0, 0, 0, 0.7);--ninja-text-color:#7d7d7d;--ninja-modal-background:rgba(17, 17, 17, 0.85);--ninja-accent-color:rgb(110, 94, 210);--ninja-secondary-background-color:rgba(51, 51, 51, 0.44);--ninja-secondary-text-color:#888;--ninja-selected-text-color:#eaeaea;--ninja-selected-background:rgba(51, 51, 51, 0.44);--ninja-icon-color:var(--ninja-secondary-text-color);--ninja-separate-border:1px solid var(--ninja-secondary-background-color);--ninja-modal-shadow:0 16px 70px rgba(0, 0, 0, 0.2);--ninja-group-text-color:rgb(144, 149, 157);--ninja-footer-background:rgba(30, 30, 30, 85%)}.modal{display:none;position:fixed;z-index:var(--ninja-z-index);left:0;top:0;width:100%;height:100%;overflow:auto;background:var(--ninja-overflow-background);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-backdrop-filter:var(--ninja-backdrop-filter);backdrop-filter:var(--ninja-backdrop-filter);text-align:left;color:var(--ninja-text-color);font-family:var(--ninja-font-family)}.modal.visible{display:block}.modal-content{position:relative;top:var(--ninja-top);margin:auto;padding:0;display:flex;flex-direction:column;flex-shrink:1;-webkit-box-flex:1;flex-grow:1;min-width:0;will-change:transform;background:var(--ninja-modal-background);border-radius:.5em;box-shadow:var(--ninja-modal-shadow);max-width:var(--ninja-width);overflow:hidden}.bump{animation:zoom-in-zoom-out .2s ease}@keyframes zoom-in-zoom-out{0%{transform:scale(.99)}50%{transform:scale(1.01,1.01)}100%{transform:scale(1,1)}}.ninja-github{color:var(--ninja-keys-text-color);font-weight:400;text-decoration:none}.actions-list{max-height:var(--ninja-actions-height);overflow:auto;scroll-behavior:smooth;position:relative;margin:0;padding:.5em 0;list-style:none;scroll-behavior:smooth}.group-header{height:1.375em;line-height:1.375em;padding-left:1.25em;padding-top:.5em;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;font-size:.75em;line-height:1em;color:var(--ninja-group-text-color);margin:1px 0}.modal-footer{background:var(--ninja-footer-background);padding:.5em 1em;display:flex;border-top:var(--ninja-separate-border);color:var(--ninja-secondary-text-color)}.modal-footer .help{display:flex;margin-right:1em;align-items:center;font-size:.75em}.ninja-examplekey{background:var(--ninja-secondary-background-color);padding:.06em .25em;border-radius:var(--ninja-key-border-radius);color:var(--ninja-secondary-text-color);width:1em;height:1em;margin-right:.5em;font-size:1.25em;fill:currentColor}.ninja-examplekey.esc{width:auto;height:auto;font-size:1.1em}.ninja-examplekey.backspace{opacity:.7}`;var ye=function(e,t,n,i){var o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,n):i,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,t,n,i);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(s=(o<3?r(s):o>3?r(t,n,s):r(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s};let me=class extends Je{constructor(){super(...arguments),this.placeholder="Type a command or search...",this.disableHotkeys=!1,this.hideBreadcrumbs=!1,this.openHotkey="cmd+k,ctrl+k",this.navigationUpHotkey="up,shift+tab",this.navigationDownHotkey="down,tab",this.closeHotkey="esc",this.goBackHotkey="backspace",this.selectHotkey="enter",this.hotKeysJoinedView=!1,this.noAutoLoadMdIcons=!1,this.data=[],this.visible=!1,this._bump=!0,this._actionMatches=[],this._search="",this._flatData=[],this._headerRef=os()}open(t={}){this._bump=!0,this.visible=!0,this._headerRef.value.focusSearch(),this._actionMatches.length>0&&(this._selected=this._actionMatches[0]),this.setParent(t.parent)}close(){this._bump=!1,this.visible=!1}setParent(t){t?this._currentRoot=t:this._currentRoot=void 0,this._selected=void 0,this._search="",this._headerRef.value.setSearch("")}get breadcrumbs(){var t;const n=[];let i=(t=this._selected)===null||t===void 0?void 0:t.parent;if(i)for(n.push(i);i;){const o=this._flatData.find(s=>s.id===i);o!=null&&o.parent&&n.push(o.parent),i=o?o.parent:void 0}return n.reverse()}connectedCallback(){super.connectedCallback(),this.noAutoLoadMdIcons||document.fonts.load("24px Material Icons","apps").then(()=>{}),this._registerInternalHotkeys()}disconnectedCallback(){super.disconnectedCallback(),this._unregisterInternalHotkeys()}_flattern(t,n){let i=[];return t||(t=[]),t.map(o=>{const s=o.children&&o.children.some(l=>typeof l=="string"),r={...o,parent:o.parent||n};return s||(r.children&&r.children.length&&(n=o.id,i=[...i,...r.children]),r.children=r.children?r.children.map(l=>l.id):[]),r}).concat(i.length?this._flattern(i,n):i)}update(t){t.has("data")&&!this.disableHotkeys&&(this._flatData=this._flattern(this.data),this._flatData.filter(n=>!!n.hotkey).forEach(n=>{fe(n.hotkey,i=>{i.preventDefault(),n.handler&&n.handler(n)})})),super.update(t)}_registerInternalHotkeys(){this.openHotkey&&fe(this.openHotkey,t=>{t.preventDefault(),this.visible?this.close():this.open()}),this.selectHotkey&&fe(this.selectHotkey,t=>{this.visible&&(t.preventDefault(),this._actionSelected(this._actionMatches[this._selectedIndex]))}),this.goBackHotkey&&fe(this.goBackHotkey,t=>{this.visible&&(this._search||(t.preventDefault(),this._goBack()))}),this.navigationDownHotkey&&fe(this.navigationDownHotkey,t=>{this.visible&&(t.preventDefault(),this._selectedIndex>=this._actionMatches.length-1?this._selected=this._actionMatches[0]:this._selected=this._actionMatches[this._selectedIndex+1])}),this.navigationUpHotkey&&fe(this.navigationUpHotkey,t=>{this.visible&&(t.preventDefault(),this._selectedIndex===0?this._selected=this._actionMatches[this._actionMatches.length-1]:this._selected=this._actionMatches[this._selectedIndex-1])}),this.closeHotkey&&fe(this.closeHotkey,()=>{this.visible&&this.close()})}_unregisterInternalHotkeys(){this.openHotkey&&fe.unbind(this.openHotkey),this.selectHotkey&&fe.unbind(this.selectHotkey),this.goBackHotkey&&fe.unbind(this.goBackHotkey),this.navigationDownHotkey&&fe.unbind(this.navigationDownHotkey),this.navigationUpHotkey&&fe.unbind(this.navigationUpHotkey),this.closeHotkey&&fe.unbind(this.closeHotkey)}_actionFocused(t,n){this._selected=t,n.target.ensureInView()}_onTransitionEnd(){this._bump=!1}_goBack(){const t=this.breadcrumbs.length>1?this.breadcrumbs[this.breadcrumbs.length-2]:void 0;this.setParent(t)}render(){const t={bump:this._bump,"modal-content":!0},n={visible:this.visible,modal:!0},o=this._flatData.filter(l=>{var a;const u=new RegExp(this._search,"gi"),c=l.title.match(u)||((a=l.keywords)===null||a===void 0?void 0:a.match(u));return(!this._currentRoot&&this._search||l.parent===this._currentRoot)&&c}).reduce((l,a)=>l.set(a.section,[...l.get(a.section)||[],a]),new Map);this._actionMatches=[...o.values()].flat(),this._actionMatches.length>0&&this._selectedIndex===-1&&(this._selected=this._actionMatches[0]),this._actionMatches.length===0&&(this._selected=void 0);const s=l=>ke`${Qr(l,a=>a.id,a=>{var u;return ke`<ninja-action exportparts="ninja-action,ninja-selected,ninja-icon" .selected="${el(a.id===((u=this._selected)===null||u===void 0?void 0:u.id))}" .hotKeysJoinedView="${this.hotKeysJoinedView}" @mouseover="${c=>this._actionFocused(a,c)}" @actionsSelected="${c=>this._actionSelected(c.detail)}" .action="${a}"></ninja-action>`})}`,r=[];return o.forEach((l,a)=>{const u=a?ke`<div class="group-header">${a}</div>`:void 0;r.push(ke`${u}${s(l)}`)}),ke`<div @click="${this._overlayClick}" class="${vi(n)}"><div class="${vi(t)}" @animationend="${this._onTransitionEnd}"><ninja-header exportparts="ninja-input,ninja-input-wrapper" ${ss(this._headerRef)} .placeholder="${this.placeholder}" .hideBreadcrumbs="${this.hideBreadcrumbs}" .breadcrumbs="${this.breadcrumbs}" @change="${this._handleInput}" @setParent="${l=>this.setParent(l.detail.parent)}" @close="${this.close}"></ninja-header><div class="modal-body"><div class="actions-list" part="actions-list">${r}</div></div><slot name="footer">${ul}</slot></div></div>`}get _selectedIndex(){return this._selected?this._actionMatches.indexOf(this._selected):-1}_actionSelected(t){var n;if(this.dispatchEvent(new CustomEvent("selected",{detail:{search:this._search,action:t},bubbles:!0,composed:!0})),!!t){if(t.children&&((n=t.children)===null||n===void 0?void 0:n.length)>0&&(this._currentRoot=t.id,this._search=""),this._headerRef.value.setSearch(""),this._headerRef.value.focusSearch(),t.handler){const i=t.handler(t);i!=null&&i.keepOpen||this.close()}this._bump=!0}}async _handleInput(t){this._search=t.detail.search,await this.updateComplete,this.dispatchEvent(new CustomEvent("change",{detail:{search:this._search,actions:this._actionMatches},bubbles:!0,composed:!0}))}_overlayClick(t){var n;!((n=t.target)===null||n===void 0)&&n.classList.contains("modal")&&this.close()}};me.styles=[dl];ye([_e({type:String})],me.prototype,"placeholder",void 0);ye([_e({type:Boolean})],me.prototype,"disableHotkeys",void 0);ye([_e({type:Boolean})],me.prototype,"hideBreadcrumbs",void 0);ye([_e()],me.prototype,"openHotkey",void 0);ye([_e()],me.prototype,"navigationUpHotkey",void 0);ye([_e()],me.prototype,"navigationDownHotkey",void 0);ye([_e()],me.prototype,"closeHotkey",void 0);ye([_e()],me.prototype,"goBackHotkey",void 0);ye([_e()],me.prototype,"selectHotkey",void 0);ye([_e({type:Boolean})],me.prototype,"hotKeysJoinedView",void 0);ye([_e({type:Boolean})],me.prototype,"noAutoLoadMdIcons",void 0);ye([_e({type:Array,hasChanged(){return!0}})],me.prototype,"data",void 0);ye([Ze()],me.prototype,"visible",void 0);ye([Ze()],me.prototype,"_bump",void 0);ye([Ze()],me.prototype,"_actionMatches",void 0);ye([Ze()],me.prototype,"_search",void 0);ye([Ze()],me.prototype,"_currentRoot",void 0);ye([Ze()],me.prototype,"_flatData",void 0);ye([Ze()],me.prototype,"breadcrumbs",null);ye([Ze()],me.prototype,"_selected",void 0);me=ye([Nn("ninja-keys")],me);var fl=C("<ninja-keys>",!0,!1);const pl=e=>(()=>{var t=fl();return t._$owner=ds(),W(n=>{var i=e.hotkeys,o=e.placeholder,s=e.disableHotkeys,r=e.hideBreadcrumbs,l=e.openHotkey,a=e.navigationUpHotkey,u=e.navigationDownHotkey,c=e.closeHotkey,f=e.goBackHotkey,h=e.selectHotkey,d=e.hotKeysJoinedView,p=e.noAutoLoadMdIcons,m=e.isDark?"dark":"light";return i!==n.e&&(t.data=n.e=i),o!==n.t&&(t.placeholder=n.t=o),s!==n.a&&(t.disablehotkeys=n.a=s),r!==n.o&&(t.hidebreadcrumbs=n.o=r),l!==n.i&&(t.openhotkey=n.i=l),a!==n.n&&(t.navigationuphotkey=n.n=a),u!==n.s&&(t.navigationdownhotkey=n.s=u),c!==n.h&&(t.closehotkey=n.h=c),f!==n.r&&(t.gobackhotkey=n.r=f),h!==n.d&&(t.selecthotkey=n.d=h),d!==n.l&&(t.hotkeysjoinedview=n.l=d),p!==n.u&&(t.noautoloadmdicons=n.u=p),m!==n.c&&ks(t,n.c=m),n},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0,l:void 0,u:void 0,c:void 0}),t})(),hl=pl;function ml(){let e;return Ke(()=>{e=document.querySelector("ninja-keys")}),{open:o=>{e==null||e.open(o?{parent:o}:void 0)},close:()=>{e==null||e.close()},setParent:o=>{e==null||e.setParent(o)}}}var gl=C("<p>Click <code>Shift</code> + <code>Left Mouse Button</code> to split a link into <code>💾Set</code> / <code>Get</code>."),vl=C("<p>Or <code>Shift + Drag</code> to create a <code>💾Set</code> / <code>Get</code> node."),so=C("<p>Select a <code>💾Set</code> node and enable tweak."),yl=C("<p>Make sure the <code>Get</code> node is assigned to a <code>Preview Image</code> or <code>Save Image</code> node."),_l=C("<p>Select a node and press <code>W</code> to rename all instances."),$l=C("<p>Convert the text input into a separate node.<br>Assign that node to a <code>💾Set</code> node and enable tweak."),wl=C("<p>You can use your scroll wheel to increase/decrease the weight for a token or all tokens."),bl=C("<p>Click the pin icon to cause the prompt tweak window to float."),kl=C("<p>The position in the graph will dictate it's position in the bar."),xl=C("<p>You can use the scroll wheel to change numerical values."),Sl=C("<p>Press <code>Shift</code> + <code>P</code> to access command palette"),Al=C("<p>Select a <code>Get</code> node and press <code>S</code> to jump to it's setter position."),El=C("<p>Select a <code>💾Set</code> or <code>Get</code> node and press <code>Arrow Left</code>/<code>Arrow Right</code> to jump to it's siblings."),Cl=C("<p>Enable the checkbox next to the token you want to temporarily disable."),Pl=C("<p><code>Double Click</code> the node title to rename it."),Ol=C("<p>Note that this doesn't work on some special nodes."),jl=C("<p>This extension overrides the default ComfyUi search allowing you to be more flexible with your search."),Il=C("<p>For example <code>lo mo onl</code> will match the <code>LoraLoaderModelOnly</code> node."),Nl=C("<p><code>Shift</code> + <code>Double Click</code> the group title to rename it."),Tl=C("<p>When an error is detected, you can open the Warning panel and navigate directly to the affected node."),Ll=C("<p>After a node completes execution, you can view its execution time."),Ml=C("<p><code>Shift</code> + <code>Arrow Up</code> aligns nodes to the top."),Hl=C("<p><code>Shift</code> + <code>Arrow Left</code> aligns nodes to the left."),Rl=C("<p><code>Shift</code> + <code>Arrow Down</code> stacks the nodes with an even spacing downwards."),zl=C("<p>If you select a <code>💾Set</code> or <code>Get</code> node it will show all connections."),Dl=C("<p>Optionally you can change settings so that it shows connections as you hover a node. <br>Either the specific link, or all."),Bl=C("<div class=helpPopup><div class=close>❌</div><div class=header>Get Started</div><div class=modalContent><div class=help><div class=info><div class=title></div><div class=text></div></div></div><ul class=menu>"),Fl=C("<video class=video>"),Ul=C("<li class=help>");const Gl=e=>{const[t,n]=se(0),i=[{name:"Assign Variables",text:[gl(),vl()],video:"https://comfyui.ma.pe/help/assign.mp4"},{name:"Add image to image preview window",text:[so(),yl()],video:"https://comfyui.ma.pe/help/imagePreview.mp4"},{name:"Rename Variables",text:_l(),video:"https://comfyui.ma.pe/help/rename.mp4"},{name:"Make prompt tweakable",text:[$l(),wl()],video:"https://comfyui.ma.pe/help/prompt.mp4"},{name:"Floating prompt tweak window",text:bl(),video:"https://comfyui.ma.pe/help/pinPromptTweak.mp4"},{name:"Add variables to top bar",text:[so(),kl(),xl()],video:"https://comfyui.ma.pe/help/tweak.mp4"},{name:"Access command palette",text:Sl(),video:"https://comfyui.ma.pe/help/command.mp4"},{name:"Jump to Set node",text:Al(),video:"https://comfyui.ma.pe/help/jump.mp4"},{name:"Jump to sibling nodes",text:El(),video:"https://comfyui.ma.pe/help/jumpSiblings.mp4"},{name:"Temporarily disable tokens",text:Cl(),video:"https://comfyui.ma.pe/help/tmpPrompt.mp4"},{name:"Rename Node",text:[Pl(),Ol()],video:"https://comfyui.ma.pe/help/renameNode.mp4"},{name:"Fuzzy Search",text:[jl(),Il()],video:"https://comfyui.ma.pe/help/fuzzySearch.mp4"},{name:"Rename Group",text:Nl(),video:"https://comfyui.ma.pe/help/renameGroup.mp4"},{name:"Warnings",text:Tl(),video:"https://comfyui.ma.pe/help/warnings.mp4"},{name:"Node runtime",text:Ll(),video:"https://comfyui.ma.pe/help/duration.mp4"},{name:"Organize nodes",text:[Ml(),Hl(),Rl()],video:"https://comfyui.ma.pe/help/organize.mp4"},{name:"Show connections",text:[zl(),Dl()],video:"https://comfyui.ma.pe/help/connections.mp4"}],o=()=>i[t()];return(()=>{var s=Bl(),r=s.firstChild,l=r.nextSibling,a=l.nextSibling,u=a.firstChild,c=u.firstChild,f=c.firstChild,h=f.nextSibling,d=u.nextSibling;return wi(r,"click",e.close,!0),z(u,(()=>{var p=ce(()=>!!o().video);return()=>p()?(()=>{var m=Fl();return m.muted=!0,m.loop=!0,m.autoplay=!0,m.controls=!0,W(()=>de(m,"src",o().video)),m})():null})(),c),z(f,()=>o().name),z(h,()=>o().text),z(d,()=>i.map((p,m)=>(()=>{var _=Ul();return _.$$click=()=>{n(m)},z(_,()=>p.name),W(()=>_.classList.toggle("active",m===t())),_})())),s})()};ut(["click"]);function Kl(e,t){let n=t;for(;n!==null;){if(n===e)return!0;n=n.parentElement}return!1}function Wl(e){return e.filter((t,n,i)=>i.indexOf(t)===n)}var Vl=C("<div class=mapeConfirmPrompt><div class=title></div><input type=text><div class=suggestions>"),Yl=C("<div class=suggestion>");const Jl=({title:e,position:t,callback:n,exit:i,fallback:o})=>{const[s,r]=se(-1);let l,a;Ke(()=>{a.focus(),a.select()});const[u,c]=se(""),[f]=se(Wl(Jt().map(m=>J(m,0)))),h=m=>{Kl(l,m.target)||i()},d=m=>{if(m.key==="ArrowUp"||m.key==="ArrowDown"){m.preventDefault(),m.key==="ArrowUp"&&r(s()-1),m.key==="ArrowDown"&&r(s()+1),s()<0&&r(0),s()>f().length-1&&r(f().length-1),a.select();return}if(m.key==="Enter"){s()!==-1&&c(f().filter(p)[s()]),n((u()||o)??"");return}if(m.key==="Escape"){i();return}r(-1)};Ke(()=>{document.body.addEventListener("click",h),document.body.addEventListener("keyup",d)}),Bt(()=>{document.body.removeEventListener("click",h),document.body.removeEventListener("keyup",d)});const p=m=>u().trim()===""?!0:m.match(new RegExp(u(),"i"));return(()=>{var m=Vl(),_=m.firstChild,w=_.nextSibling,$=w.nextSibling,y=l;typeof y=="function"?$t(y,m):l=m,z(_,e),w.$$keyup=S=>{S.key!=="Shift"&&c(S.currentTarget.value)};var k=a;return typeof k=="function"?$t(k,w):a=w,de(w,"placeholder",o),z($,()=>f().filter(p).map((S,j)=>(()=>{var L=Yl();return L.$$click=()=>{n(S)},z(L,S),W(()=>L.classList.toggle("selected",s()===j)),L})())),W(S=>{var j=`${t.x}px`,L=`${t.y}px`;return j!==S.e&&((S.e=j)!=null?m.style.setProperty("left",j):m.style.removeProperty("left")),L!==S.t&&((S.t=L)!=null?m.style.setProperty("top",L):m.style.removeProperty("top")),S},{e:void 0,t:void 0}),W(()=>w.value=u()),m})()};ut(["keyup","click"]);const Qn=()=>{const e=document.activeElement;return e.tagName==="INPUT"&&(e.type==="text"||e.type==="number")||e.tagName==="TEXTAREA"},Xl=e=>{var s,r;const t=(r=(s=e.inputs)==null?void 0:s[0])==null?void 0:r.link;if(!e.graph||!t)return;const n=Ae(t);if(!n)return;const i=n.origin_id;return re(i)},ql=e=>{var o,s,r,l,a;let t,n,i;for(const u of graph._nodes){if(u.type!==Be||J(u)!==e||!u.graph)continue;const c=(s=(o=u.inputs)==null?void 0:o[0])==null?void 0:s.link;if(!c)continue;const f=Ae(c);if(typeof f>"u")continue;const h=f.origin_id;if(typeof h>"u")continue;const d=f.origin_slot;if(typeof d>"u")continue;const p=u.graph.getNodeById(h);if(!p)continue;if(p.outputs[d]&&p.outputs[d].type==="IMAGE"){let _;for(const w of Oe()){if(!ae(w)||J(w)!==e||Se(w))continue;const $=(l=(r=w.outputs)==null?void 0:r[0].links)==null?void 0:l[0];if(typeof $>"u")continue;const y=Ae($);if(!y)continue;const k=y.target_id,S=u.graph.getNodeById(k);if(!S||!((a=S.type)!=null&&a.match(/(PreviewImage|SaveImage)/)))continue;const j=app.nodeOutputs[S.id];j&&j.images?_=Ye(j.images):_=S.images}return n=p.id,t=_,i=u.id,[_,n,i]}if(typeof p>"u"||!p.widgets)continue;const m=p.widgets[d];typeof m>"u"||(n=p.id,i=u.id,t=m.value)}return[t,n,i]},Zl=e=>{const t=_o().find(n=>n.title===e);t&&Lo([t.pos[0]+t.size[0]/2,t.pos[1]+t.size[1]/2],graph.list_of_graphcanvas[0])},It=e=>{for(const t of Oe())t.type!==Be||!Se(t)||J(t)!==e||bt(t)},Ql=()=>{const e=Ye(Object.values(dt()).filter(Boolean)),t={},n={};for(const i of Oe().filter(ae)){const o=J(i);if(i.inputs[0].link){const r=e.find(c=>{const{target_id:f}=c;return f===i.id});if(!r)continue;const{id:l,origin_id:a,origin_slot:u}=r;n[o]={id:l,originId:a,originSlot:u};continue}else{t[o]||(t[o]=[]);const r=e.find(c=>{const{origin_id:f}=c;return f===i.id});if(!r)continue;const{id:l,target_id:a,target_slot:u}=r;t[o].push({id:l,targetId:a,targetSlot:u})}}return{nodeSet:n,nodeGet:t}},ea=()=>{var u;let e=[];const t=[],n={},i={},o={},s=Ql(),r=dt();for(const c of Oe().filter(f=>!ae(f))){n[c.id]=c;let f=0;if(c.inputs)for(let h=0,d=c.inputs.length;h<d;h++)c.inputs[h]&&c.inputs[h].link!=null&&(f+=1);f==0?t.push(c):o[c.id]=f}let l=!1;for(;!l;){if(t.length==0){l=!0;break}const c=t.shift();if(e.push(c),delete n[c.id],!!c.outputs)for(let f=0;f<c.outputs.length;f++){const h=c.outputs[f],d=(u=h.links)==null?void 0:u.flatMap(m=>{const _=r[m],w=re(_.target_id);if(!w)return m;if(ae(w)){const $=J(w);return s.nodeGet[$]?s.nodeGet[$].map(k=>k.id):m}return m});if(!(!h||!d||h==null||d==null||d.length==0))for(let m=0;m<d.length;m++){const _=d[m],w=r[_];if(!w||i[w.id])continue;const y=re(w.target_id);if(y==null){i[w.id]=!0;continue}i[w.id]=!0,o[y.id]-=1,o[y.id]===0&&t.push(y)}}}for(const c in n)e.push(n[c]);const a=e.length;for(let c=0;c<a;++c)e[c].order=c;e=e.sort((c,f)=>{const h=c.constructor.priority||c.priority||0,d=f.constructor.priority||f.priority||0;return h===d?c.order-f.order:h-d});for(let c=0;c<a;++c)e[c].order=c;return e},ta=()=>{const e=ea();let t=50;for(const s of e)s.pos=[700,t],t+=10;const n=Math.min(...e.map(s=>s.pos[1])),i=ie("nodeAlignOffsetY");let o=0;for(const s of e.sort((r,l)=>r.pos[1]-l.pos[1])){s.pos=[s.pos[0],n+o];const r=s.size[1]+i;o+=r}bn(e,!1),app.graph.setDirtyCanvas(!0,!0)},ro=e=>{const[t,n,i]=e.split(".").map(parseFloat);return{major:t,minor:n,patch:i}},na=(e,t)=>{const n=ro(e),i=ro(t);return i.major>n.major||i.minor>n.minor||i.patch>n.patch},ia=e=>{const t=document.createElement("style");return t.appendChild(document.createTextNode(e)),t},Ge=(e,t)=>{var n,i,o;for(const s of graph._nodes){if(s.type!==Be||J(s)!==e||!s.inputs[0])continue;const r=(i=(n=s.inputs)==null?void 0:n[0])==null?void 0:i.link;if(r===null)continue;const l=Ae(r);if(typeof l>"u")continue;const a=l.origin_id;if(typeof a>"u")continue;const u=l.origin_slot;if(typeof u>"u"||!s.graph)continue;const c=s.graph.getNodeById(a);if(typeof c>"u")continue;const f=(o=c.widgets)==null?void 0:o[u];typeof f>"u"||(f.options&&f.options.setValue?typeof t=="function"?f.options.setValue(t(f.value)):f.options.setValue(t):typeof t=="function"?f.value=t(f.value):f.value=t,app.graph.setDirtyCanvas(!0,!0),wn())}};var oa=C("<div class=warningsPopup><div class=close>❌</div><div class=header>Warnings</div><div class=modalContent><div class=mapeSettings>"),sa=C("<div class=mapeSetting><label class=name><small></small></label><button>Jump to node");const ra=e=>(()=>{var t=oa(),n=t.firstChild,i=n.nextSibling,o=i.nextSibling,s=o.firstChild;return wi(n,"click",e.close,!0),z(s,()=>e.warnings.map(r=>(()=>{var l=sa(),a=l.firstChild,u=a.firstChild,c=a.nextSibling;return z(a,(()=>{var f=ce(()=>!!ae(r.node));return()=>{var h,d;return f()?J(r.node):`${((h=r.node)==null?void 0:h.title)??((d=r.node)==null?void 0:d.type)}: ${r.type}`}})(),u),z(u,()=>r.text),c.$$click=()=>{bt(r.node)},l})())),t})();ut(["click"]);var la=C('<div class="tweak numberWrapper"><label></label><div class=value><input type=number step=1>'),aa=C('<div class="tweak numberWrapper"><label></label><div class=value><input type=number step=0.1>'),ca=C('<div class="tweak stringContainer"><label class=interactable></label><div class=value>'),ua=C("<div class=moveBar><div class=moveArea><div class=name></div></div><div class=toggleFloating>📌"),da=C("<textarea>"),fa=C("<input type=text>"),pa=C('<div class="tweak imageContainer"><label>'),ha=C("<div class=thumbnails>"),ma=C("<img class=fullImage>"),ga=C("<div class=thumb><img class=smallImage>"),va=C("<div class=missing>"),ya=C("<div class=value>"),_a=C("<div class=missingImage>?"),$a=C("<div class=image>"),wa=C('<div class="tweak defaultContainer"><label>'),ba=C('<div class=mapeRoot><div class=mapeBar><div class=logo title=https://twitter.com/mape></div><div class=tweaks></div><div class=options><div class=warnings title="Organize workflow (Hold Shift-key to skip prompt)">✨</div><div class=warnings>💥</div><div class=warnings>🩹</div><div class=imagePreview title="Open separate window for image previews">🖥️<small>🎨</small></div><div class=clear title="Clear favourites">❌</div><div class=settings title=Settings>⚙️</div><div class=help title=Help>❔</div></div></div><div>'),ka=C("<div class=tweakHighlight>"),xa=C('<div class="warnings blink"title="Show potentially broken nodes">⚠️'),Sa=C('<div class="warnings blink">🆕');const Aa=()=>{const[e,t]=se([]),[n,i]=Mt({}),[o,s]=Mt({}),[r,l]=Mt({}),a=()=>{const g=window.innerHeight-200,b=window.innerWidth-200;try{for(const I of Object.keys(localStorage))if(I.match(new RegExp(Ve))){const x=localStorage[I],P=I.replace(Ve,""),O=JSON.parse(x);O.position.x=Math.min(b,O.position.x),O.position.y=Math.min(g,O.position.y),l(P,O)}}catch{}};a(),Ce(()=>{for(const[g,b]of Object.entries(r))localStorage[`${Ve}${g}`]=JSON.stringify(b)});const[u,c]=se([]),[f,h]=se(!1),[d,p]=se(!1),[m,_]=se(!1),[w,$]=se(""),y=()=>{const g=[],b={},I=Oe().filter(ae);for(const x of I.filter(Se)){const P=J(x);b[P]||(b[P]=0),b[P]+=1;const O=Xl(x);if(O&&ae(O)){const E=J(O);P===E&&g.push({node:x,text:"Can't point a set to a get of itself"})}}for(const x of I.filter(st)){const P=J(x);P&&typeof b[P]>"u"&&g.push({node:x,text:"Missing set node"})}for(const x of I.filter(Se)){const P=J(x);b[P]&&b[P]>1&&g.push({text:"Can't have multiple set nodes of the same name",node:x})}c([...window.mapeErrors??[],...g])};Ce(()=>{u().length===0&&_(!1)});const k=setInterval(y,1e3);Bt(()=>{clearInterval(k)});const S=()=>{i(li(Object.fromEntries(Object.entries(localStorage).filter(([g])=>g.startsWith(on)).map(([g,b])=>{const I=g.replace(on,""),[x,P,O]=ql(I),E=re(O);if(!E)return null;const H=E!=null&&E.pos?[E==null?void 0:E.pos[0],E==null?void 0:E.pos[1]]:[Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER];return[I,{name:I,type:b,value:x,pos:H}]}).filter(Boolean)))),localStorage[Lt]=JSON.stringify(Object.fromEntries(Object.entries(n).filter(([,g])=>g.type==="IMAGE")))};Ke(S),Ke(async()=>{const b=(await(await fetch(`https://comfyui.ma.pe/VERSION?c=${Date.now()}`)).text()).trim();na("0.3.0",b)&&$(`New version ${b} is available.`)}),window.addEventListener("mapeTweak",g=>{var b;S(),((b=g.detail)==null?void 0:b.message)==="rename"&&a()});const j=g=>{const b=(g??0).toString().length*6+35;return`${Math.max(55,b)}px`},L={INT:g=>(()=>{var b=la(),I=b.firstChild,x=I.nextSibling,P=x.firstChild;return b.addEventListener("wheel",O=>{const E=O.deltaY>0?-1:1;Ge(g.name,H=>H+E)}),b.$$click=O=>{if(O.shiftKey)return It(g.name)},z(I,()=>g.name),P.$$input=O=>{const E=parseInt(O.currentTarget.value,10);i(g.name,"value",E),Ge(g.name,E)},W(()=>j(g.value)!=null?x.style.setProperty("width",j(g.value)):x.style.removeProperty("width")),W(()=>P.value=g.value),b})(),FLOAT:g=>{const b=I=>typeof I<"u"?parseFloat(parseFloat(I.toString()).toFixed(3)):0;return(()=>{var I=aa(),x=I.firstChild,P=x.nextSibling,O=P.firstChild;return I.addEventListener("wheel",E=>{const H=E.deltaY>0?-.1:.1;Ge(g.name,g.value+H)}),I.$$click=E=>{if(E.shiftKey)return It(g.name)},z(x,()=>g.name),O.$$input=E=>{const H=parseFloat(E.currentTarget.value);i(g.name,"value",H),Ge(g.name,H)},W(()=>j(b(g.value))!=null?P.style.setProperty("width",j(b(g.value))):P.style.removeProperty("width")),W(()=>O.value=b(g.value)),I})()},STRING:g=>{const[b,I]=se(o[g.name]??!1),x=E=>{const H=E.currentTarget.value;i(g.name,"value",H),Ge(g.name,H)};let P;Ke(()=>{});let O;return Ce(()=>{if(!r[g.name]||!P)return;const E=()=>{clearTimeout(O),O=setTimeout(()=>{r[g.name]&&l(g.name,"height",P.offsetHeight)},100)};new MutationObserver(E).observe(P,{attributes:!0,attributeFilter:["style"]})}),(()=>{var E=ca(),H=E.firstChild,Z=H.nextSibling;return H.$$click=te=>{if(te.shiftKey)return It(g.name);I(!b())},z(H,()=>g.name),z(Z,(()=>{var te=ce(()=>!!(b()||r[g.name]));return()=>te()?[(()=>{var M=ua(),Y=M.firstChild,F=Y.firstChild,T=Y.nextSibling;return Y.$$mousedown=oe=>{const ge={x:oe.clientX,y:oe.clientY},we=Ye(r[g.name].position),Ne=ft=>{const pt={x:ft.clientX,y:ft.clientY},Ct={x:pt.x-ge.x,y:pt.y-ge.y};l(g.name,"position",{x:we.x+Ct.x,y:we.y+Ct.y})},Me=()=>{document.removeEventListener("mousemove",Ne),document.removeEventListener("mouseup",Me)};document.addEventListener("mousemove",Ne),document.addEventListener("mouseup",Me)},z(F,()=>g.name),T.$$click=()=>{r[g.name]?(l(g.name,void 0),delete localStorage[`${Ve}${g.name}`],I(!1)):l(g.name,{position:{x:10,y:40},height:60})},W(()=>de(T,"title",r[g.name]?"Pin the window to top bar":"Unpin the window")),M})(),(()=>{var M=da();M.$$input=x;var Y=P;return typeof Y=="function"?$t(Y,M):P=M,W(F=>Ii(M,r[g.name]?{height:`${r[g.name].height}px`}:{},F)),W(()=>M.value=g.value),M})(),$e(ur,{get prompt(){return g.value},update:M=>{Ge(g.name,M)}})]:(()=>{var M=fa();return M.$$input=x,M.addEventListener("focus",()=>{I(!0)}),W(()=>M.value=g.value),M})()})()),W(te=>{var M=!!(b()||r[g.name]),Y=!!r[g.name],F=r[g.name]?{position:"fixed",top:`${r[g.name].position.y}px`,left:`${r[g.name].position.x}px`}:{};return M!==te.e&&E.classList.toggle("focused",te.e=M),Y!==te.t&&E.classList.toggle("floating",te.t=Y),te.a=Ii(E,F,te.a),te},{e:void 0,t:void 0,a:void 0}),E})()},IMAGE:g=>{const[b,I]=se(!1),[x,P]=se(0);Ce(()=>{const Z=document.querySelector(".comfy-menu");Z&&(b()?Z.style.display="none":Z.style.display="block")});const O=()=>`mape_tweak_image_cache_${g.name}`;Ce(()=>{g.value&&(sessionStorage[O()]=JSON.stringify(g.value))});const E=()=>`Connect "${g.name}" variable to a Preview Image node or Regenerate the image`,H=()=>g.value??(sessionStorage[O()]?JSON.parse(sessionStorage[O()]):void 0);return(()=>{var Z=pa(),te=Z.firstChild;return Z.$$click=M=>{if(M.shiftKey)return It(g.name);M.target.tagName==="IMG"||M.target.className==="thumbnails"||M.target.className==="thumb"||(I(!b()),b()||P(0))},z(te,()=>g.name),z(Z,(()=>{var M=ce(()=>!!b());return()=>M()?(()=>{var Y=ce(()=>!!H());return()=>Y()?[(()=>{var F=ha();return z(F,()=>(H()??[]).map((T,oe)=>(()=>{var ge=ga(),we=ge.firstChild;return ge.$$click=()=>{P(oe)},W(()=>de(we,"src",We(T))),ge})())),F})(),(()=>{var F=ma();return W(()=>{var T;return de(F,"src",We((T=H())==null?void 0:T[x()]))}),F})()]:(()=>{var F=va();return z(F,E),F})()})():(()=>{var Y=ya();return z(Y,(()=>{var F=ce(()=>!!H());return()=>F()?"":(()=>{var T=_a();return W(()=>de(T,"title",E())),T})()})(),null),z(Y,()=>(H()??[]).map(F=>{const T=`url("${We(F)}")`;return(()=>{var oe=$a();return T!=null?oe.style.setProperty("background-image",T):oe.style.removeProperty("background-image"),oe})()}),null),Y})()})(),null),W(M=>{var Y=!!b(),F=(H()??[]).length>1;return Y!==M.e&&Z.classList.toggle("focused",M.e=Y),F!==M.t&&Z.classList.toggle("hasMultiple",M.t=F),M},{e:void 0,t:void 0}),Z})()},DEFAULT:g=>(()=>{var b=wa(),I=b.firstChild;return b.$$click=x=>{if(x.shiftKey)return It(g.name)},z(I,()=>g.name),W(()=>de(b,"title",JSON.stringify(g,null,"  "))),b})()},[D,B]=se([]),{open:X}=ml();Ke(()=>{const g=document.querySelector("ninja-keys");g&&g.shadowRoot.appendChild(ia(`
			* {
				will-change: unset !important;
				&::-webkit-scrollbar {
					width: 5px;
					height: 5px;
					background: linear-gradient(to right, #111, #222);
				}
				&::-webkit-scrollbar-thumb {
					background: linear-gradient(to bottom, #fff, #aaa);
					border: 1px solid #fff;
					border-radius: 10px;
				}
			}
			`))});const v=g=>{if(g.key==="P"&&g.shiftKey){if(Qn())return;X(),B([...Oe().filter(b=>{var I,x;return b.type!=="mape Variable"||b.type==="mape Variable"&&((x=(I=b.inputs)==null?void 0:I[0])==null?void 0:x.type)!=="*"}).map(b=>b.type==="mape Variable"?{id:b.id,title:`Jump to variable: ${J(b)??b.title??b.type} (${b.id})`,mdIcon:"timeline",handler:()=>{pi(b.id)}}:{id:b.id,title:`Jump to node: ${b.title??b.type} (${b.id}) ${b.widgets_values&&Array.isArray(b.widgets_values)?` - ${b.widgets_values.join(", ")}`:""}`.slice(0,90),mdIcon:"circle",handler:()=>{pi(b.id)}}),..._o().map(b=>({title:`Jump to group: ${b.title}`,mdIcon:"workspaces",handler:()=>{Zl(b.title)}}))])}},N=[],[U,K]=se({1:!1,2:!1,3:!1,4:!1,5:!1,6:!1,7:!1,8:!1,9:!1}),A=g=>Object.fromEntries(Object.keys(U()).map((b,I)=>[b,g===I]));Ke(()=>{document.body.addEventListener("keydown",v);for(const g of[1,2,3,4,5,6,7,8,9])for(const b of["up","down"]){const I=`${g}+${b}`;fe(I,()=>{if(Qn())return;const x=ne()[g-1];if(!x)return;const P=x.type;if(P==="INT"){const O=b==="up"?1:-1;Ge(x.name,x.value+O)}if(P==="FLOAT"){const O=b==="up"?.1:-.1;Ge(x.name,x.value+O)}}),N.push(()=>{fe.unbind(I)})}});const Q=g=>{if(Qn())return;const b=g.key.match(/^\d+$/);if(b){const I=ne()[parseInt(b[0],10)-1];if(!I)return;I.type==="STRING"?s(I.name,!o[I.name]):K(A(parseFloat(g.key)-1))}},q=g=>{g.key.match(/^\d+$/)&&K(A(-1))};document.body.addEventListener("keypress",Q),document.body.addEventListener("keyup",q),Bt(()=>{document.body.addEventListener("keydown",v);for(const g of N)g();document.body.removeEventListener("keypress",Q),document.body.removeEventListener("keyup",q)});const[V,G]=se([]);window.setPrompt=(g,b,I,x)=>{const P=Math.random(),O=()=>{G(V().filter(E=>E.id!==P))};G([...V(),{callback:E=>(I(E),O(),setTimeout(()=>{app.graph.setDirtyCanvas(!0,!0)}),!0),exit:()=>{O()},position:{x:b[0],y:b[1]},title:g,id:P,fallback:x}])};const R=ce(()=>Object.values(U()).filter(Boolean).length>0),ne=ce(()=>Object.values(n).sort($o(n))),ee=()=>{const g=window.open("","_blank","width=1280,height=720,location=no,toolbar=no,menubar=no");if(g.document.write(`
		<!DOCTYPE html>
		<html lang="en">
			<head>
				<meta charset="UTF-8" />
				<title>mape's Helpers - Image Preview</title>
			</head>
			<body>
				<script>
					window.standaloneImagePreview = true;
					import('/extensions/ComfyUI-mape-Helpers/tweak/mape-helpers.js');
				<\/script>
			</body>
		</html>
		`),g){let b=!0;g.addEventListener("unload",()=>{if(b){b=!1;return}t([...e().filter(I=>I!==g)])}),t([...e(),g])}else console.error("Failed to open a new window.")};return window.showWarnings=(g=!0)=>{_(g)},(()=>{var g=ba(),b=g.firstChild,I=b.firstChild,x=I.nextSibling,P=x.nextSibling,O=P.firstChild,E=O.nextSibling,H=E.nextSibling,Z=H.nextSibling,te=Z.nextSibling,M=te.nextSibling,Y=M.nextSibling,F=b.nextSibling;return I.$$click=S,z(x,$e(mo,{get each(){return ne()},children:(T,oe)=>(()=>{var ge=ka();return z(ge,(()=>{var we=ce(()=>!!(L[T.type]&&typeof T.value<"u"));return()=>we()?L[T.type](T):L.DEFAULT(T)})()),W(we=>{var Ne=!!U()[oe()+1],Me=!!R();return Ne!==we.e&&ge.classList.toggle("active",we.e=Ne),Me!==we.t&&ge.classList.toggle("siblingActive",we.t=Me),we},{e:void 0,t:void 0}),ge})()})),z(P,(()=>{var T=ce(()=>u().length>0);return()=>T()?(()=>{var oe=xa();return oe.$$click=()=>{_(!m())},oe})():null})(),O),z(P,(()=>{var T=ce(()=>!!w());return()=>T()?(()=>{var oe=Sa();return oe.$$click=()=>{$("")},W(()=>de(oe,"title",w())),oe})():null})(),O),O.$$click=T=>{(T.shiftKey||confirm("Do you want to organize workflow?"))&&ta()},E.$$click=T=>{(ie("ignorePromptForExplodeHeal")||T.shiftKey||confirm("Do you want to convert all links to set/get nodes?"))&&Ho()},H.$$click=T=>{(ie("ignorePromptForExplodeHeal")||T.shiftKey||confirm(`Do you want to convert all set/get nodes to connections?
This is finicky with PrimitiveNodes...`))&&Mo()},Z.$$click=()=>{ee()},te.$$click=()=>{if(confirm("Clear all favourites?")){for(const T of Object.keys(localStorage))if(T.startsWith(on)){const oe=T.replace(on,"");for(const ge of di(oe,"set"))Ee(ge,!1,1);delete localStorage[T]}S()}},M.$$click=()=>{p(!d()),d()&&h(!1)},Y.$$click=()=>{h(!f()),f()&&p(!1)},F.style.setProperty("--ninja-font-family","Arial"),F.style.setProperty("position","relative"),F.style.setProperty("z-index","10000000"),z(F,$e(hl,{isDark:!0,get hotkeys(){return D()}})),z(g,()=>V().map(T=>$e(Jl,T)),null),z(g,(()=>{var T=ce(()=>!!d());return()=>T()?$e(vr,{close:()=>{p(!1)}}):null})(),null),z(g,(()=>{var T=ce(()=>!!f());return()=>T()?$e(Gl,{close:()=>{h(!1)}}):null})(),null),z(g,(()=>{var T=ce(()=>!!m());return()=>T()?$e(ra,{get warnings(){return u()},close:()=>{window.mapeErrors=[],_(!1)}}):null})(),null),W(T=>{var oe=`Convert links to set/get ${ie("ignorePromptForExplodeHeal")?"":"(Hold Shift-key to skip prompt)"}`,ge=`Convert set/get to links ${ie("ignorePromptForExplodeHeal")?"":"(Hold Shift-key to skip prompt)"}`;return oe!==T.e&&de(E,"title",T.e=oe),ge!==T.t&&de(H,"title",T.t=ge),T},{e:void 0,t:void 0}),g})()};ut(["click","input","mousedown"]);const Ea=Object.freeze(Object.defineProperty({__proto__:null,MapeTweak:Aa},Symbol.toStringTag,{value:"Module"}));
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
//# sourceMappingURL=mape-helpers.js.map
(function(){"use strict";try{if(typeof document<"u"){var e=document.createElement("style");e.appendChild(document.createTextNode('@import"https://fonts.googleapis.com/css?family=Material+Icons&display=block";.imagePreviews{background:repeating-radial-gradient(#181818 0,#181818 4px,#1f1f1f 5px,#1f1f1f 5px);font-family:arial;color:#fff;position:fixed;top:0;left:0;right:0;bottom:0;z-index:1000;margin:0;background-size:10px 10px;display:flex;flex-direction:column}.imagePreviews .content{display:flex;height:100%}.imagePreviews .image{position:absolute;top:0;left:0;right:0;bottom:0;width:100%;height:100%}.imagePreviews .imagePreviewTweaks{display:flex;background:#111;padding:10px;justify-content:space-around;border-bottom:1px solid rgba(255,255,255,.1);box-shadow:0 0 10px inset #00000080;gap:10px}.imagePreviews .imagePreviewTweaks .button{flex:auto;vertical-align:top;border:0;text-transform:uppercase;text-shadow:2px 2px 1px #000000;-webkit-user-select:none;user-select:none;position:relative;display:inline-block;color:#fff;border-top:1px solid #0f0f12;background:#0f0f0f;margin:2px;border-radius:4px;cursor:pointer;line-height:1;transition:color 1s;outline:none;text-align:center;opacity:.5;padding:8px 10px}.imagePreviews .imagePreviewTweaks .button.active{background:#490000}.imagePreviews .imagePreviewTweaks .button:before{position:absolute;top:0;right:0;bottom:0;left:0;border-radius:4px;background:linear-gradient(to bottom,#ffffff17,#ffffff0a);box-shadow:inset 0 1px #ffffff0d,inset 0 0 1px #fff3;content:"";pointer-events:none}.imagePreviews .imagePreviewTweaks .button:hover:before{background:linear-gradient(to bottom,#ffffff1f,#ffffff0f)}.imagePreviews .imagePreviewTweaks .button:active:before{box-shadow:inset 0 1px 3px #0000004d;background:linear-gradient(to bottom,#ffffff0f,#fff0)}.imagePreviews .imagePreviewTweaks .button:active{transform:translate(1px,1px)}.imagePreviews .imagePreviewTweaks .button.active{opacity:1}.imagePreviews .imagePreviewTweaks label{text-transform:uppercase;padding:8px 10px;color:#ffffff80;line-height:21px}.imagePreviews .value{width:50px}.imagePreviews .value{position:static}.imagePreviews .bigPreview{width:100%;height:100%;overflow:hidden;position:relative;cursor:move}.imagePreviews .fullImage{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);max-width:98%;max-height:calc(100vh - 80px);border:1px solid rgba(255,255,255,.2);box-shadow:0 0 60px #0000004d,0 0 30px #0000004d;transform-origin:top left}.imagePreviews .thumbnails{display:flex;left:0;right:0;bottom:0;background:#111;padding:10px;justify-content:flex-start;border-bottom:1px solid rgba(255,255,255,.1);box-shadow:0 0 10px inset #00000080;flex-direction:column;max-width:100px;gap:10px;width:100px}.imagePreviews .thumbnails .thumb{width:100%;opacity:.2;cursor:pointer;position:relative;height:100%}.imagePreviews .thumbnails .thumb:hover{opacity:.7}.imagePreviews .thumbnails .thumb.active{opacity:1}.imagePreviews .thumbnails .thumb img{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);border-radius:10px}.imagePreviews .thumbnails .smallImage{border-radius:5px;max-width:100%;max-height:100%;margin:0 auto;display:block}.imagePreviews .mosaicGrid{width:100%;height:100%;position:absolute;top:50%;left:50%;transform-origin:top left}.imagePreviews .mosaicGrid .inner{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;display:flex;flex-direction:row;align-content:center;flex-wrap:wrap;justify-content:center}.imagePreviews .mosaicGrid .mosaicImage{display:inline-block;transform:none;box-shadow:0 0 60px #0000004d,0 0 30px #0000004d}.imagePreviews .mosaicGrid .mosaicImage img{width:100%;height:100%}.imagePreviews .zoom{font-size:20px;font-weight:700;position:absolute;top:16px;right:15px;text-shadow:2px 2px 4px rgba(0,0,0,.7);cursor:pointer!important;cursor:pointer}.imagePreviews .zoom:hover{transform:scale(1.1);filter:saturate(1)}.imagePreviews .zoom:active{transform:scale(.9)}.imagePreviews .flipbookFps{font-size:20px;font-weight:700;position:absolute;top:15px;right:100px;text-shadow:2px 2px 4px rgba(0,0,0,.7);cursor:pointer!important}.imagePreviews .flipbookFps label{margin-right:10px}.imagePreviews .flipbookFps input{background:transparent;color:#fff;border:0;background:#0003;padding:5px 3px;border-radius:5px;border:1px solid rgba(255,255,255,.1);box-shadow:0 0 10px #0000004d inset;border-right:0;font-size:11px;color:#fff9;line-height:10px;width:40px;position:relative;font-size:16px;top:-1px;margin-right:20px}.imagePreviews .flipbookFps input[type=checkbox]{vertical-align:top;min-width:15px;max-width:15px;min-height:15px;max-height:15px;background-color:#0003;display:inline-block;margin-right:.8vh;border-radius:100%;margin-top:.45vh;box-shadow:0 0 0 .1vh #fff3;padding:.5vh;-webkit-appearance:none;outline:none;position:relative;top:3px}.imagePreviews .flipbookFps input[type=checkbox]:hover{background-color:#ffffff1a}.imagePreviews .flipbookFps input[type=checkbox]:checked{background:#fff}.imagePreviews .flipbookFps input[type=checkbox]:disabled{opacity:.2}.imagePreviews .imagePreviewHelp{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;background:#0003;padding:5px 3px;border-radius:5px;border:1px solid rgba(255,255,255,.1);box-shadow:0 0 10px #0000004d inset}.imagePreviews .imagePreviewHelp p{padding:0 20px}.imagePreviews .imagePreviewHelp video{max-width:90vw;max-height:calc(90vh - 50px);float:left}.mapeBar .tweaks .promptTweaker{background:#333;padding:5px 0 10px;border-radius:0 0 5px 5px;position:relative;top:-5px}.mapeBar .tweaks .promptTweaker *{box-sizing:border-box}.mapeBar .tweaks .promptTweaker .promptTweakerPrompts{max-height:calc(100vh - 310px);overflow:auto}.mapeBar .tweaks .promptTweaker .buttons{display:flex;padding:0 10px 10px}.mapeBar .tweaks .promptTweaker button{flex:auto;vertical-align:top;border:0;text-transform:uppercase;text-shadow:2px 2px 1px #000000;-webkit-user-select:none;user-select:none;position:relative;display:inline-block;color:#fff;border-top:1px solid #0f0f12;background:#0f0f0f;margin:2px;border-radius:4px;cursor:pointer;line-height:1;transition:color 1s;outline:none;white-space:nowrap;font-size:11px;height:23px;padding:5px 8px}.mapeBar .tweaks .promptTweaker button.active{background:#490000}.mapeBar .tweaks .promptTweaker button:before{position:absolute;top:0;right:0;bottom:0;left:0;border-radius:4px;background:linear-gradient(to bottom,#ffffff17,#ffffff0a);box-shadow:inset 0 1px #ffffff0d,inset 0 0 1px #fff3;content:"";pointer-events:none}.mapeBar .tweaks .promptTweaker button:hover:before{background:linear-gradient(to bottom,#ffffff1f,#ffffff0f)}.mapeBar .tweaks .promptTweaker button:active:before{box-shadow:inset 0 1px 3px #0000004d;background:linear-gradient(to bottom,#ffffff0f,#fff0)}.mapeBar .tweaks .promptTweaker button:active{transform:translate(1px,1px)}.mapeBar .tweaks .promptTweaker button.remove{width:25px;padding:5px 8px}.mapeBar .tweaks .promptTweaker .prompt{display:flex;padding:0 5px}.mapeBar .tweaks .promptTweaker .prompt label{max-width:130px;min-width:130px;height:auto;line-height:1.5;padding:2px;border-radius:5px}.mapeBar .tweaks .promptTweaker .prompt .weight{padding:0 10px;line-height:26px;min-width:43px;max-width:43px}.mapeBar .tweaks .promptTweaker .prompt input[type=range]{-moz-appearance:none;appearance:none;-webkit-appearance:none}.mapeBar .tweaks .promptTweaker .prompt input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;height:10px;width:10px;border-radius:50%;background:#fff;margin-top:-3px;box-shadow:1px 1px 2px #00000080;cursor:pointer}.mapeBar .tweaks .promptTweaker .prompt input[type=range]::-webkit-slider-runnable-track{width:60%;height:5px;background:#fff3;border-radius:3rem;transition:all .5s;cursor:pointer}.mapeBar .tweaks .promptTweaker .prompt input[type=range]:hover::-webkit-slider-runnable-track{background:#ffffff4d}.mapeBar .tweaks .promptTweaker .prompt.tmp{opacity:.5}.mapeBar .tweaks .promptTweaker .prompt input[type=checkbox]{vertical-align:top;min-width:15px;max-width:15px;min-height:15px;max-height:15px;background-color:#0003;display:inline-block;margin-right:.8vh;border-radius:100%;margin-top:.45vh;box-shadow:0 0 0 .1vh #fff3;padding:.5vh;-webkit-appearance:none;outline:none}.mapeBar .tweaks .promptTweaker .prompt input[type=checkbox]:hover{background-color:#ffffff1a}.mapeBar .tweaks .promptTweaker .prompt input[type=checkbox]:checked{background:#fff}.mapeBar .tweaks .promptTweaker .prompt input[type=checkbox]:disabled{opacity:.2}.mapeBar .tweaks .promptTweaker .prompt .arrows{padding:3px 5px 3px 0;position:relative;top:0}.mapeBar .tweaks .promptTweaker .prompt .arrows .arrow{color:#fff3;font-size:12px;line-height:10px}.mapeBar .tweaks .promptTweaker .prompt .arrows .arrow.disabled{pointer-events:none;opacity:0}.mapeBar .tweaks .promptTweaker .prompt .arrows .arrow:hover{cursor:pointer;color:#ffffffe6}.settingsPopup{position:fixed;background:#333;top:30px;right:0;color:#fff;font-family:arial;min-width:500px;z-index:1111111111;box-shadow:0 10px 20px #0000004d;border:1px solid #444}.settingsPopup .close{cursor:pointer;position:absolute;top:10px;right:10px;filter:saturate(0)}.settingsPopup .close:hover{transform:scale(1.1);filter:saturate(1)}.settingsPopup .close:active{transform:scale(.9)}.settingsPopup .header{background:#0000004d;border-bottom:1px solid rgba(255,255,255,.1);font-size:20px;padding:10px 15px;text-transform:uppercase}.settingsPopup .modalContent{max-height:calc(100vh - 100px);overflow:auto}.settingsPopup .mapeSetting{display:flex;position:relative;padding:1px 0;margin:0 3px;z-index:1}.settingsPopup .mapeSetting .name{background:#0003;padding:8px 10px;border-radius:5px 0 0 5px;border:1px solid rgba(255,255,255,.1);box-shadow:0 0 10px #0000004d inset;border-right:0;font-size:11px;color:#fff9;line-height:10px;min-width:400px;line-height:1.5}.settingsPopup .mapeSetting input{padding:5px;height:22px;color:#fff;font-size:11px;width:100%;border:0;background:transparent;resize:none;font-family:monospace}.settingsPopup .mapeSetting input:focus,.settingsPopup .mapeSetting input:active{outline:1px solid transparent}.settingsPopup .mapeSetting input[type=checkbox]{vertical-align:top;min-width:15px;max-width:15px;min-height:15px;max-height:15px;background-color:#0003;display:inline-block;margin-right:.8vh;border-radius:100%;margin-top:.45vh;box-shadow:0 0 0 .1vh #fff3;padding:.5vh;-webkit-appearance:none;outline:none;margin:0 auto;display:block}.settingsPopup .mapeSetting input[type=checkbox]:hover{background-color:#ffffff1a}.settingsPopup .mapeSetting input[type=checkbox]:checked{background:#fff}.settingsPopup .mapeSetting input[type=checkbox]:disabled{opacity:.2}.settingsPopup .mapeSetting input:focus{color:#ffa}.settingsPopup .mapeSetting input[type=color]{margin:-15px 0 -10px;height:36px;position:relative;top:4px}.settingsPopup .mapeSetting .reset{padding:5px;filter:saturate(0)}.settingsPopup .mapeSetting .reset:hover{filter:saturate(1)}.settingsPopup .mapeSetting .value{width:100%;position:relative;border:1px solid rgba(255,255,255,.1);box-shadow:0 0 10px #0000004d inset;background:#222;border-radius:0 5px 5px 0;padding:8px 10px}.helpPopup{position:fixed;background:#333;top:30px;right:0;color:#fff;font-family:arial;min-width:500px;z-index:1111111111;box-shadow:0 10px 20px #0000004d;border:1px solid #444}.helpPopup .close{cursor:pointer;position:absolute;top:10px;right:10px;filter:saturate(0)}.helpPopup .close:hover{transform:scale(1.1);filter:saturate(1)}.helpPopup .close:active{transform:scale(.9)}.helpPopup .header{background:#0000004d;border-bottom:1px solid rgba(255,255,255,.1);font-size:20px;padding:10px 15px;text-transform:uppercase}.helpPopup .modalContent{max-height:calc(100vh - 100px);overflow:auto}.helpPopup .modalContent{display:flex}.helpPopup .modalContent .help{padding:15px}.helpPopup .modalContent .help .video,.helpPopup .modalContent .help .image{width:720px;border:1px solid rgba(255,255,255,.1);box-shadow:0 0 20px #0009;background:#000c}.helpPopup .modalContent .help .info{border:1px solid rgba(255,255,255,.1);background:#0000001a;margin:10px 0;border-radius:10px;overflow:hidden}.helpPopup .modalContent .help .title{font-size:25px;padding:15px 20px;font-weight:700;text-transform:uppercase;background:#0003;border-bottom:1px solid rgba(255,255,255,.1)}.helpPopup .modalContent .help .text{max-width:720px;font-size:15px;padding:20px 0;font-size:17px;color:#fffc;white-space:pre-wrap}.helpPopup .modalContent .help .text p{margin:0;padding:0 20px 1em;line-height:1.5}.helpPopup .modalContent .help .text p:last-child{padding-bottom:0}.helpPopup .modalContent .help .text code{outline:1px solid rgba(0,0,0,.3);background:#0000001a;border-radius:5px;padding:5px;margin:0 .2em}.helpPopup .modalContent .menu{background-color:#222;margin:0;padding:0}.helpPopup .modalContent .menu li{background:linear-gradient(to right,#0000001a,#0000 20%,#0000);border-left:1px solid #555;padding:10px 15px;list-style:none;color:#ffffff80;border-bottom:1px solid rgba(0,0,0,.2)}.helpPopup .modalContent .menu li:nth-child(odd){background:linear-gradient(to right,#0003,#0000001a 20%,#0000001a);border-bottom:1px solid rgba(0,0,0,.1)}.helpPopup .modalContent .menu li:hover{color:#fff;cursor:pointer}.helpPopup .modalContent .menu li.active{background:#333;color:#fff;box-shadow:6px 2px 6px #0003;border-left:1px solid transparent;border-top:1px solid rgba(255,255,255,.1);border-bottom:1px solid rgba(0,0,0,.1);background:linear-gradient(to right,#333,#424242 20%,#333)}.helpPopup .modalContent .menu li.active:first-child{border-top:0}.mapeConfirmPrompt{font-family:arial;position:fixed;padding:10px;background:#333;border-bottom:1px solid #444;font-size:13px;z-index:111;border-radius:10px;border:2px solid #555;box-shadow:0 0 20px #0003;transform:translate(-50%,-50%)}.mapeConfirmPrompt *{box-sizing:border-box}.mapeConfirmPrompt .title{white-space:nowrap;text-transform:uppercase;padding:0 0 5px;text-align:center}.mapeConfirmPrompt input{position:relative;border:1px solid rgba(255,255,255,.1);box-shadow:0 0 10px #0000004d inset;background:#222;color:#fff;border-radius:5px;padding:8px 10px;width:100%}.mapeConfirmPrompt input:focus,.mapeConfirmPrompt input:active{outline:1px solid transparent}.mapeConfirmPrompt .suggestions{background:#333;border-bottom:1px solid #444;font-size:13px;z-index:111;border:2px solid #555;box-shadow:0 0 20px #0003;position:absolute;top:100%;left:0;right:0;border-radius:5px}.mapeConfirmPrompt .suggestions .suggestion{padding:5px}.mapeConfirmPrompt .suggestions .suggestion:nth-child(odd){background:#0000001a}.mapeConfirmPrompt .suggestions .suggestion:hover,.mapeConfirmPrompt .suggestions .suggestion.selected{color:#ffa;background:#0000004d;cursor:pointer}.warningsPopup{position:fixed;background:#333;top:30px;right:0;color:#fff;font-family:arial;min-width:500px;z-index:1111111111;box-shadow:0 10px 20px #0000004d;border:1px solid #444}.warningsPopup .close{cursor:pointer;position:absolute;top:10px;right:10px;filter:saturate(0)}.warningsPopup .close:hover{transform:scale(1.1);filter:saturate(1)}.warningsPopup .close:active{transform:scale(.9)}.warningsPopup .header{background:#0000004d;border-bottom:1px solid rgba(255,255,255,.1);font-size:20px;padding:10px 15px;text-transform:uppercase}.warningsPopup .modalContent{max-height:calc(100vh - 100px);overflow:auto}.warningsPopup .mapeSetting{display:flex;position:relative;padding:4px 0;margin:0 3px;z-index:1}.warningsPopup .mapeSetting .name{background:#0003;padding:8px 10px;border-radius:5px 0 0 5px;border:1px solid rgba(255,255,255,.1);box-shadow:0 0 10px #0000004d inset;border-right:0;font-size:11px;color:#fff;line-height:10px;line-height:1.5;width:100%;font-size:16px}.warningsPopup .mapeSetting .name small{padding:0 10px;color:#fff9}.warningsPopup .mapeSetting button{flex:auto;vertical-align:top;border:0;text-transform:uppercase;text-shadow:2px 2px 1px #000000;-webkit-user-select:none;user-select:none;position:relative;display:inline-block;color:#fff;border-top:1px solid #0f0f12;background:#0f0f0f;margin:2px;border-radius:4px;cursor:pointer;line-height:1;transition:color 1s;outline:none;padding:0 10px;white-space:nowrap}.warningsPopup .mapeSetting button.active{background:#490000}.warningsPopup .mapeSetting button:before{position:absolute;top:0;right:0;bottom:0;left:0;border-radius:4px;background:linear-gradient(to bottom,#ffffff17,#ffffff0a);box-shadow:inset 0 1px #ffffff0d,inset 0 0 1px #fff3;content:"";pointer-events:none}.warningsPopup .mapeSetting button:hover:before{background:linear-gradient(to bottom,#ffffff1f,#ffffff0f)}.warningsPopup .mapeSetting button:active:before{box-shadow:inset 0 1px 3px #0000004d;background:linear-gradient(to bottom,#ffffff0f,#fff0)}.warningsPopup .mapeSetting button:active{transform:translate(1px,1px)}@media only screen and (max-height: 850px){html body .comfy-menu{top:30px!important}}.mapeRoot *{box-sizing:border-box;font-family:arial;-webkit-user-select:none;user-select:none}.mapeRoot *::-webkit-scrollbar{width:5px;height:5px;background:linear-gradient(to right,#111,#222)}.mapeRoot *::-webkit-scrollbar-thumb{background:linear-gradient(to bottom,#fff,#aaa);border:1px solid #fff;border-radius:10px}.mapeBar{position:fixed;top:0;left:0;right:0;height:30px;background:#333;border-bottom:1px solid #444;display:flex;font-size:13px;z-index:1111111;border-top:1px solid rgba(255,255,255,.1);background:linear-gradient(to bottom,#353535,#313131 30%,#333)}.mapeBar:after{content:"";display:block;position:absolute;top:100%;left:0;right:0;height:20px;background:linear-gradient(to bottom,#0000002f,#0000);border-top:2px solid rgba(0,0,0,.3);pointer-events:none}.mapeBar .logo{background:url(https://comfyui.ma.pe/logo.svg);background-size:contain;background-repeat:no-repeat;min-width:26px;max-width:26px;margin:8px;cursor:pointer}.mapeBar .logo:hover{transform:scale(1.1);filter:saturate(1)}.mapeBar .logo:active{transform:scale(.9)}.mapeBar .tweakHighlight{position:relative}.mapeBar .tweakHighlight.siblingActive{opacity:.1}.mapeBar .tweakHighlight.active{opacity:1}.mapeBar .tweaks{display:flex}.mapeBar .tweaks .tweak{display:flex;position:relative;padding:4px 0;margin:0 3px;z-index:1}.mapeBar .tweaks .tweak label{background:#0003;padding:5px 8px;height:22px;border-radius:5px 0 0 5px;border:1px solid rgba(255,255,255,.1);box-shadow:0 0 10px #0000004d inset;border-right:0;font-size:11px;color:#fff9;line-height:10px}.mapeBar .tweaks .tweak label.interactable{cursor:pointer}.mapeBar .tweaks .tweak label.interactable:hover{color:#fff}.mapeBar .tweaks .tweak.defaultContainer label{border-radius:5px}.mapeBar .tweaks .tweak input,.mapeBar .tweaks .tweak textarea{padding:5px;height:22px;color:#fff;font-size:11px;width:100%;border:0;background:transparent;resize:none;font-family:monospace}.mapeBar .tweaks .tweak input:focus,.mapeBar .tweaks .tweak textarea:focus,.mapeBar .tweaks .tweak input:active,.mapeBar .tweaks .tweak textarea:active{outline:1px solid transparent}.mapeBar .tweaks .tweak input:focus{color:#ffa}.mapeBar .tweaks .tweak .image{position:absolute;top:0;left:0;width:50px;height:50px;border-radius:5px;background:#000;background-size:contain;background-repeat:no-repeat;background-position:center center}.mapeBar .tweaks .tweak .value{width:70px;position:relative;border:1px solid rgba(255,255,255,.1);box-shadow:0 0 10px #0000004d inset;background:#222;height:22px;border-radius:0 5px 5px 0}.mapeBar .tweaks .tweak.stringContainer.focused .value{width:450px}.mapeBar .tweaks .tweak.stringContainer.focused textarea{height:150px;padding:10px;line-height:1.5;border:1px solid rgba(255,255,255,.1);box-shadow:0 0 10px #0000004d inset;background:#222}.mapeBar .tweaks .tweak.imageContainer{cursor:pointer}.mapeBar .tweaks .tweak.imageContainer .value{width:50px}.mapeBar .tweaks .tweak.imageContainer .missingImage{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#ffffff80;width:50px;text-align:center}.mapeBar .tweaks .tweak.imageContainer .missing{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:20px}.mapeBar .tweaks .tweak.imageContainer.focused{display:block;background:repeating-radial-gradient(#181818 0,#181818 4px,#1f1f1f 5px,#1f1f1f 5px);position:fixed;top:0;left:0;right:0;bottom:0;z-index:1000;margin:0;background-size:10px 10px}.mapeBar .tweaks .tweak.imageContainer.focused label{display:none}.mapeBar .tweaks .tweak.imageContainer.focused .value{position:static}.mapeBar .tweaks .tweak.imageContainer.focused .image{position:absolute;top:0;left:0;right:0;bottom:0;width:100%;height:100%}.mapeBar .tweaks .tweak.imageContainer.focused.hasMultiple{top:150px}.mapeBar .tweaks .tweak.imageContainer .fullImage{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);max-width:98%;max-height:98%;border:1px solid rgba(255,255,255,.2);box-shadow:0 0 60px #0000004d,0 0 30px #0000004d}.mapeBar .tweaks .tweak.imageContainer .thumbnails{display:flex;position:absolute;height:150px;left:0;right:0;bottom:100%;background:#111;padding:10px;justify-content:space-around;border-bottom:1px solid rgba(255,255,255,.1);box-shadow:0 0 10px inset #00000080}.mapeBar .tweaks .tweak.imageContainer .thumbnails .thumb{width:100%}.mapeBar .tweaks .tweak.imageContainer .thumbnails .smallImage{border-radius:5px;max-width:100%;max-height:100%;margin:0 auto;display:block}.mapeBar button{width:100px}.mapeBar .options{position:absolute;top:0;font-weight:900;color:#fff;line-height:28px;font-size:18px;background:linear-gradient(to bottom,#353535,#313131 30%,#333);display:flex;right:5px;height:29px;gap:5px;padding:0 5px;z-index:9}.mapeBar .options div{filter:saturate(.8);cursor:pointer}.mapeBar .options div:hover{transform:scale(1.1);filter:saturate(1)}.mapeBar .options div:active{transform:scale(.9)}.mapeBar .options div small{position:absolute;top:6px;left:12px;font-size:62%}@keyframes fadeInOut{0%{opacity:.5}50%{opacity:1}to{opacity:.5}}.mapeBar .options .blink{animation:fadeInOut 1s ease-in-out infinite}.mapeBar .tweak.floating{display:block;box-shadow:0 0 20px #00000080;padding:0}.mapeBar .tweak.floating .promptTweaker{margin:0 0 -5px;border-radius:0}.mapeBar .tweak.floating>label{display:none}.mapeBar .tweak.floating .moveArea{cursor:move}.mapeBar .tweak.floating .moveArea .name{display:block}.mapeBar .tweak.floating textarea{resize:vertical}.mapeBar .tweak.floating .value{height:auto;border-radius:0}.mapeBar .moveBar{position:relative;height:20px;background:repeating-linear-gradient(45deg,#0000004d,#0000004d 2px,#0003 2px,#0003 9px)}.mapeBar .moveBar .moveArea{position:absolute;top:0;left:0;bottom:0;right:30px}.mapeBar .moveBar .moveArea .name{font-size:11px;padding:4px 6px;display:none}.mapeBar .moveBar .toggleFloating{position:absolute;top:-1px;right:5px;filter:saturate(0);cursor:pointer;font-size:15px}.mapeBar .moveBar .toggleFloating:hover{filter:saturate(1)}')),document.head.appendChild(e)}}catch(t){console.error("vite-plugin-css-injected-by-js",t)}})();
